<!-- dialogs (now ain't visible) -->
<div id="delete-confirmation" style="display: none;" title="{{_('Delete shortcut')}}">
  {{_('Do you want to delete this shortcut?')}}
</div>

<div id="bookmark-confirmation" style="display: none;" title="{{_('Send to dashboard')}}">
  {{_('Do you want to send this shortcut to the dashboard?')}}
</div>

<div id="share-dialog" style="display: none;" title="{{_('Shortcut sharing')}}">
    <p>{{_('What user do you want to share this shortcut with?')}}</p>
    <select id="users-to-share-with"></select>
</div>

<div>
    {% for sc in shortcuts %}
    <div class="sp_shortcut" sc_id="{{sc.id}}" sc_parent="{{sc.parent}}"
        style="{% if loop.index % 2 == 0 %}background-color: white;{%endif%}">
        
        {#
        <!--
        <div style="float: left;">
            <input type="checkbox"/>
        </div>
        -->
        #}
        
    {% if sc.action_type %}
        {% if sc.action_type == 'list' %}
        <div class="sp_shortcut_title">
            <a href="{{tg.url('/list', cls=sc.cls, came_from='/?sc_parent=%d' % sc.parent)}}">
                {{sc.title}}</a>
        </div>
        
        <!-- actions over "list" shortcuts -->
        
        <!-- insertion order -->
        <div class="sp_shortcut_insertion_order">
            <a href="{{tg.url('/ins_order', cls=sc.cls, came_from='/?sc_parent=%d' % sc.parent)}}">
                {{_('Insertion order')}}
            </a>
        </div>
        
        <!-- reference order -->
        <div class="sp_shortcut_reference_order">
            <a href="{{tg.url('/ref_order', cls=sc.cls, came_from='/?sc_parent=%d' % sc.parent)}}">
                {{_('Reference order')}}
            </a>
        </div>
        {% else %}
        <div class="sp_shortcut_title">
            <a href="{{tg.url(sc.url)}}">{{sc.title}}</a>
        </div>
        {% endif %}
    {% else %}
        {# This is a group #}
        <div class="sp_shortcut_title">
            <a href="{{tg.url('/', sc_parent=sc.id)}}">{{sc.title}}</a>
        </div>
    {% endif %}
        <!-- general actions over shortcuts -->
    
        <!-- Edit -->
        <div style="float: left;">
            <form method="post" action="/sc/edit">
            <input type="hidden" name="id" value="{{sc.id}}"/>
            <input type="hidden" name="came_from" value="{{'/?sc_parent=%d' % sc.parent}}"/>
            <input class="sp_button" style="width: 50px; float: left;"
                title="{{_('Edit this shortcut')}}" 
                type="submit" value="{{_('Edit')}}"/>
            </form>
        </div>
        
        <!-- Delete -->
        <div style="float: left;">
            <input class="sp_button sc_delete_button" 
                style="width: 50px; float: left;"
                title="{{_('Remove this shortcut')}}" 
                type="button" value="{{_('Delete')}}"/>
        </div>
    
        <!-- To dashboard -->
        <div style="float: left;">
            <input class="sp_button sc_bookmark_button" 
                style="width: 105px;"
                title="{{_('Put this shortcut on the dashboard')}}"
                type="button" value="{{_('Send to dashboard')}}"/>
        </div>

        <!-- Share -->        
        <div>
            <input class="sp_button sc_share_button" 
                style="width: 60px;"
                title=""
                type="button" value="{{_('Share')}}"/>
        </div>
        
    </div>
    {% endfor %}
</div>

<script type="text/javascript">
    $(document).ready(function() {
        
        $('#shortcut_actions').change(function() {
            var action = $(this).find('option:selected').val();
            
            if (action == 'edit') {
            }
            else if (action == 'delete') {
            }
            else if (action == 'send-to') {
            }
            else if (action == 'share') {
            }
            
            // select first option again
            $(this).find('option:first').attr('selected', true);
        });
        
        // delete
        $('.sc_delete_button').click(function() {
            var sc = $(this).parent().parent();
            var sc_id = sc.attr('sc_id');
            
            $('#delete-confirmation').
            dialog({
                resizable: false,
                height: 150,
                width: 300,
                modal: true,
                buttons: {
                    "{{_('Ok')}}": function() {
                        $.ajax({
                            url: "{{tg.url('/sc/delete')}}",
                            type: 'post',
                            dataType: 'json',
                            data: {
                                id: sc_id,
                            },
                            success: function(res) {
                                sc.fadeOut();
                                $('#delete-confirmation').dialog('close');
                            },
                            error: function() {
                                alert('Error!');
                                $('#delete-confirmation').dialog('close');
                            }
                        });
                    },
                    "{{_('Cancel')}}": function() {
                        $('#delete-confirmation').dialog('close');
                    }
                }
            });
        });
        
        // bookmark
        $('.sc_bookmark_button').click(function() {
            var sc = $(this).parent().parent();
            var sc_id = sc.attr('sc_id');
            
            $('#bookmark-confirmation').dialog({
                resizable: false,
                height: 150,
                width: 300,
                modal: true,
                buttons: {
                    "Ok": function() { 
                        $.ajax({
                            url: "{{tg.url('/sc/bookmark')}}",
                            type: 'post',
                            dataType: 'json',
                            data: {
                                id: sc_id,
                            },
                            success: function(res) {
                                if (res.status) {
                                    sc.effect('highlight', {color: 'red'}, 400);
                                }
                                else {
                                    alert('Error!');
                                }
                                
                                $('#bookmark-confirmation').dialog('close');
                            },
                            error: function() {
                                alert('Error!');
                                $('#bookmark-confirmation').dialog('close');
                            }
                        });
                    },
                    "Cancel": function() { 
                        $('#bookmark-confirmation').dialog('close');
                    }
                }
            });
        });
        
        <!-- load list of users -->
        $.ajax({
        	url: "{{tg.url('/users/all')}}",
        	type: 'get',
        	dataType: 'json',
        	success: function(res) {
        		var users = res.users;
        		var options = '';
        		for (var i=0; i<users.length; i++) {
        			options += '<option value="' + users[i].id +'">' + 
        			    users[i].display_name + ' [' + users[i].user_name + ']</option>';
        		}
        		
        		$('#users-to-share-with').append(options);
        	},
        	error: function() {
        		alert('Error!');
        	}
        });
        
        // share
        $('.sc_share_button').click(function() {
            var sc = $(this).parent().parent();
            var sc_id = sc.attr('sc_id');
        
            $('#share-dialog').dialog({
                resizable: false,
                height: 180,
                width: 450,
                modal: true,
                buttons: {
                    "Ok": function() {
                    	
                    	var user_id = $('#users-to-share-with').find('option:selected').val();
                    	
                        $.ajax({
                            url: "{{tg.url('/sc/share')}}",
                            type: 'post',
                            dataType: 'json',
                            data: {
                                id_sc: sc_id,
                                id_user: user_id
                            },
                            success: function(res) {
                                if (res.status) {
                                    sc.effect('highlight', {color: 'red'}, 400);
                                }
                                else {
                                    alert('Error!');
                                }
                                
                                $('#users-to-share-with').find('option:first').attr('selected', true);
                                $('#share-dialog').dialog('close');
                            },
                            error: function() {
                                alert('Error!');
                                $('#users-to-share-with').find('option:first').attr('selected', true);
                                $('#share-dialog').dialog('close');
                            }
                        });
                    },
                    "Cancel": function() {
                    	$('#users-to-share-with').find('option:first').attr('selected', true);
                        $('#share-dialog').dialog('close');
                    }
                }
            });
        });
    });
</script>