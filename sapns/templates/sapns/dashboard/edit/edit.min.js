"{% import 'sapns/dashboard/datefield.js' as df %}";
$(document).ready(function(){$("#sp-back").hide();
$("#back-button").click(function(){$("#form_back").submit()});$(".sp-edit-field:first").find("input:first").focus();
$("#save-button").click(function(){$(".ui-tooltip").remove();var n={id:"{{id}}",};
var m=[];$(".sp-text-field").each(function(){var i=$(this).parent().parent().attr("name");
var q=$(this).parent().parent().attr("required");var p=$(this).val();var o=$(this).attr("_ok");
if(o===undefined){o=true}if(q=="true"&&p==""||!o){m.push($(this))}n["fld_"+i]=p});
$(".sp_integer_field").each(function(){var i=$(this).parent().parent().attr("name");
var q=$(this).parent().parent().attr("required");var p=$(this).val();var o=$(this).attr("_ok");
if(q=="true"&&p==""||!o){m.push($(this))}n["fld_"+i]=p});$(".sp_float_field").each(function(){var i=$(this).parent().parent().attr("name");
var q=$(this).parent().parent().attr("required");var p=$(this).val();var o=$(this).attr("_ok");
if(q=="true"&&p==""||!o){m.push($(this))}n["fld_"+i]=p});$(".url_field_text").each(function(){var o=$(this).parent().parent().parent();
var i=o.attr("name");var q=o.attr("required");var p=$(this).val();if(q=="true"&&p==""){m.push($(this))
}n["fld_"+i]=p});$(".sp-checkbox-field").each(function(){var i=$(this).parent().parent().attr("name");
n["fld_"+i]=$(this).prop("checked")});$(".sp-date-field").each(function(){var q=$(this).datepicker("getDate");
var o=$(this).parent().parent().attr("name");if(q!=null){var p=q.getFullYear();var r=q.getMonth()+1;
var i=q.getDate();q=p+"-"+r+"-"+i}else{q=""}var s=$(this).parent().parent().attr("required");
if(s=="true"&&q==""){m.push($(this))}n["fld_"+o]=q});$(".sp-time-field").each(function(){var i=$(this).parent().parent().attr("name");
var q=$(this).parent().parent().attr("required");var p=$(this).val();var o=$(this).attr("_ok");
if(q=="true"&&p==""||!o){m.push($(this))}n["fld_"+i]=p});$(".sp-select-field").each(function(){var i=$(this).parent().parent().attr("name");
var p=$(this).parent().parent().attr("required");var o=$(this).attr("value");if(p=="true"&&o==""){m.push($(this))
}n["fld_"+i]=o});if(m.length>0){$("#save-button").qtip({content:{text:"{{_('Check required fields!')}}"},show:{target:false,ready:true},hide:{event:false},position:{at:"right top",my:"left bottom"},style:"ui-tooltip-red ui-tooltip-rounded"});
for(var l=0;l<m.length;l++){m[l].qtip({content:{text:"{{_('this field is required')}}"},show:{target:false,ready:true},hide:{event:false},position:{at:"right top",my:"left bottom"},style:"ui-tooltip-red ui-tooltip-rounded"})
}}else{$.ajax({url:"{{tg.url('/dashboard/save/%s/' % cls)}}",type:"post",data:n,success:function(i){if(i.status){$("#form_back").submit()
}else{if(i.message){alert(i.message)}else{alert("Error!")}}}})}});{{df.date_field(tg,_,".sp-date-field")}}
$("#rel-classes-show").click(function(){var i=$("#rel-classes-sel option:selected");
var l="/dashboard/list/"+i.attr("cls");var m="";m+='<input type="hidden" name="parent_id" value="{{id}}">\n';
m+='<input type="hidden" name="ch_attr" value="'+i.attr("ch_attr")+'">\n';$("#rel-classes-form").attr("action",l).html(m).submit()
});$("#action-go").click(function(){var l=$("#actions-sel").attr("row_id");var i=$("#actions-sel option:selected").val();
if(i[i.length-1]!="/"){i+="/"}i+=l;$("#action-form").attr("action",i).submit();$("#actions-sel option:first").attr("selected",true)
});var h=$(".sp_selector");for(var f=0,d=h.length;f<d;f++){var k=$(h[f]);var j=k.attr("attr_name");
var c=k.attr("attr_value");var b=k.attr("attr_title");var a=k.attr("attr_rc");var g=k.attr("attr_rc_title");
var e=k.parent().parent().attr("read_only");k.sapnsSelector({name:j,value:c,title:b,rc:a,rc_title:g,read_only:e=="true"})
}$(".sp_integer_field").change(function(){fields.check_regex($(this))});$(".sp_float_field").change(function(){fields.check_regex($(this))
});$(".sp-text-field").change(function(){fields.check_regex($(this))});$(".sp-time-field").change(function(){fields.check_regex($(this))
});$(".url_field_btn").click(function(){var i=$(this).parent().find(".url_field_text").val();
if(i.trim()){$('<form method="get" action="'+i+'" target="_blank"></form>').appendTo("body").submit().remove()
}});$(".created").click(function(){$.ajax({url:"{{tg.url('/dashboard/logs/search/')}}",data:{table_name:"{{cls}}",row_id:"{{id}}"},success:function(i){$("#edit-dialog").html(i).dialog({title:"Logs",width:900,height:600,resizable:false,modal:true,buttons:{"{{_('Close')}}":function(){$("#edit-dialog").dialog("close")
}}})}})})});