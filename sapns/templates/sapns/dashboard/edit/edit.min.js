"{% import 'sapns/dashboard/datefield.js' as df %}";$(function(){$("#sp-back").hide();
$("#back-button").click(function(){$("#form_back").submit()});$(".sp-edit-field:first").find("input:first").focus();
$("#save-button").click(function(){$(".ui-tooltip").remove();var p={id:"{{id}}"},o=[];
$(".sp-text-field").each(function(){var i=$(this).parent().parent().attr("name"),r=$(this).parent().parent().hasClass("required"),q=$(this).val(),l=$(this).attr("_ok");
if(l===undefined){l=true}if(r&&q==""||!l){o.push($(this))}p["fld_"+i]=q});$(".sp_integer_field").each(function(){var i=$(this).parent().parent().attr("name"),r=$(this).parent().parent().hasClass("required"),q=$(this).val(),l=$(this).attr("_ok");
if(r&&q==""||!l){o.push($(this))}p["fld_"+i]=q});$(".sp_float_field").each(function(){var i=$(this).parent().parent().attr("name"),r=$(this).parent().parent().hasClass("required"),q=$(this).val(),l=$(this).attr("_ok");
if(r&&q==""||!l){o.push($(this))}p["fld_"+i]=q});$(".url_field_text").each(function(){var l=$(this).parent().parent().parent(),i=l.attr("name"),r=l.hasClass("required"),q=$(this).val();
if(r=="true"&&q==""){o.push($(this))}p["fld_"+i]=q});$(".sp-checkbox-field").each(function(){var i=$(this).parent().parent().attr("name");
p["fld_"+i]=$(this).prop("checked")});$(".sp-date-field").each(function(){var r=$(this).datepicker("getDate"),l=$(this).parent().parent().attr("name");
if(r!=null){var q=r.getFullYear(),s=r.getMonth()+1,i=r.getDate();r=q+"-"+s+"-"+i}else{r=""
}var t=$(this).parent().parent().hasClass("required");if(t&&r==""){o.push($(this))
}p["fld_"+l]=r});$(".sp-time-field").each(function(){var i=$(this).parent().parent().attr("name"),r=$(this).parent().parent().hasClass("required"),q=$(this).val(),l=$(this).attr("_ok");
if(r&&q==""||!l){o.push($(this))}p["fld_"+i]=q});$(".sp-select-field").each(function(){var i=$(this).parent().parent().attr("name"),q=$(this).parent().parent().hasClass("required"),l=$(this).attr("value");
if(q&&l==""){o.push($(this))}p["fld_"+i]=l});if(o.length>0){$("#save-button").qtip({content:{text:"{{_('Check required fields!')}}"},show:{target:false,ready:true},hide:{event:false},position:{at:"right top",my:"left bottom"},style:"ui-tooltip-red ui-tooltip-rounded"});
for(var n=0,m=o.length;n<m;n++){o[n].qtip({content:{text:"{{_('this field is required')}}"},show:{target:false,ready:true},hide:{event:false},position:{at:"right top",my:"left bottom"},style:"ui-tooltip-red ui-tooltip-rounded"})
}}else{$.ajax({url:"{{tg.url('/dashboard/save/%s/' % cls)}}",type:"post",data:p,success:function(i){if(i.status){$("#form_back").submit()
}else{if(i.message){alert(i.message)}else{alert("Error!")}}}})}});{{df.date_field(tg,_,".sp-date-field")}}
$("#rel-classes-show").click(function(){var i=$("#rel-classes-sel option:selected"),l="/dashboard/list/"+i.attr("cls");
var m="";m+='<input type="hidden" name="parent_id" value="{{id}}">\n';m+='<input type="hidden" name="ch_attr" value="'+i.attr("ch_attr")+'">\n';
$("#rel-classes-form").attr("action",l).html(m).submit()});$("#action-go").click(function(){var l=$("#actions-sel").attr("row_id"),i=$("#actions-sel option:selected").val();
if(i[i.length-1]!="/"){i+="/"}i+=l;$("#action-form").attr("action",i).submit();$("#actions-sel option:first").prop("selected",true)
});var h=$(".sp_selector");for(var f=0,d=h.length;f<d;f++){var k=$(h[f]),j=k.attr("attr_name"),c=k.attr("attr_value"),b=k.attr("attr_title"),a=k.attr("attr_rc"),g=k.attr("attr_rc_title"),e=k.parent().parent().hasClass("readonly");
k.sapnsSelector({name:j,value:c,title:b,rc:a,rc_title:g,read_only:e})}$(".sp_integer_field, .sp_float_field, .sp-text-field, .sp-time-field").change(function(){fields.check_regex($(this))
});$(".url_field_btn").click(function(){var i=$(this).parent().find(".url_field_text").val();
if(i.trim()){$('<form method="get" action="'+i+'" target="_blank"></form>').appendTo("body").submit().remove()
}});$(".created").click(function(){$.ajax({url:"{{tg.url('/dashboard/logs/search/')}}",data:{table_name:"{{cls}}",row_id:"{{id}}"},success:function(i){$("#edit-dialog").html(i).dialog({title:"Logs",width:1100,height:600,resizable:false,modal:true,buttons:{"{{_('Close')}}":function(){$("#edit-dialog").dialog("close")
}}})}})})});