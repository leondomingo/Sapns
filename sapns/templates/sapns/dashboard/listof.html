{% extends 'sapns/base.html' %}
{% import 'sapns/dashboard/util.html' as util %}

{% block head %}
    {{ super() }}
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- "Sapns - Web Information System: Students" (with caption) -->
    <!-- "Sapns - Web Information System" (without caption) -->
    <!--<title>Sapns - Web Information System{%if grid.caption %}: {{grid.caption}}{%endif%}</title>-->
    {{ util.jquery() }}
    {{ util.jquery_ui() }}
    {{ util.qtip2() }}
{% endblock %}

{#{% block header %}
{% endblock %}#}

{% block middle %}
    {{ super() }}
        
    <div id="grid"></div>
    <!--{% if grid.rel_classes %}-->
    <div id="rel-classes" style="clear: left; padding-left: 20px;">
        <div class="sp-grid-relatedinfo-title">{{_('Related info')}}</div>
        <select id="rel-classes-sel" style="font-size: 11px;">
        <!--{% for rc in grid.rel_classes %}-->
        <option cls="{{rc.name}}" ch_attr="{{rc.attr_name}}">{{rc.title}} ({{rc.attr_title}})</option>
        <!--{% endfor %}-->
        </select>
        <button id="rel-classes-show" class="sp-button">{{_('Show')}}</button>
    </div>
    <!--{% endif %}-->
        
    <script src="{{tg.url('/js/sprintf.min.js')}}"></script>
    <script>
        {% include 'sapns/components/sapns.grid/sapns.grid.min.js' %}
        $(function() {
        	$('.sp-search-txt').focus();
        	var title = $(document).attr('title');
        	$(document).attr('title', sprintf('[%s] %s', "{{grid.caption}}", title));
        	
        	$('#grid').sapnsGrid({
        	    cls: "{{grid.cls}}",
        	    caption: "{{grid.caption}}",
        	    q: "{{grid.q}}", 
        	    rp: "{{grid.rp}}", 
        	    pag_n: "{{grid.pag_n}}",
        	    ch_attr: "{{grid.ch_attr or ''}}",
        	    parent_id: "{{grid.parent_id or ''}}",
        	    actions: {},
        	    url_base: "/dashboard/list/{{grid.cls}}",
        	    height: 350,
        	    actions_inline: false, // temporal hasta que funcionen las acciones "inline" 
        	    dblclick: 'edit'
        	});
        	
        	$('#grid .sp-search-txt').focus();
        	
        	$('#rel-classes-show').click(function() {
        	    var ids = $('#grid').sapnsGrid('getSelectedIds');
        	    if (ids.length > 0) {
        	        var opt = $('#rel-classes-sel option:selected');
        	        var cls = opt.attr('cls');
        	        var ch_attr = opt.attr('ch_attr');
        	        var action = "/dashboard/list/" + cls;
        	        
        	        var form_ = 
        	            '<form id="rel-classes-form" method="get" action="' + action + '" target="_blank">' +
        	                '<input type="hidden" name="ch_attr" value="' + ch_attr + '">' +
        	                '<input type="hidden" name="parent_id" value="' + ids[0] + '">' +
        	            '</form>';
        	            
        	        $(form_).appendTo('body').submit().remove();
        	    }
        	});
        });
    </script>
{% endblock %}