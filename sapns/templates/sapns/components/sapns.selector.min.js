(function(b){function a(c){var d=b.extend(true,{name:"sel_"+Math.floor(Math.random()*999999),value:null,title:"",rc:"",rc_title:"",read_only:false,title_url:"{{tg.url('/dashboard/title/')}}",edit_url:"{{tg.url('/dashboard/edit/')}}",onChange:null,dialog:{width:950,height:550},grid:{cls:c.rc,rp:25,q:"",pag_n:1,with_pager:false,height:380,exportable:false,select_first:true,search_params:{url:c.search_url,data:c.search_data}}},c);
b.extend(true,this,d)}a.prototype.setValue=function(f,e){var d=this;if(!d.read_only){var g=d.value!=f;
var c=d.value;d.value=f;if(g&&d.onChange&&!e){d.onChange(f,c)}}};a.prototype.getValue=function(){return this.value
};a.prototype.setTitle=function(){var c=this;var e="#st_"+c.name;var d=c.value;if(d&&c.rc){b.ajax({url:c.title_url,data:{cls:c.rc,id:c.value},success:function(f){if(f.status){b(e).val(f.title).parent().attr("value",d);
c.title=f.title}}})}else{b(e).val("").parent().attr("value","");c.title=""}};a.prototype.getTitle=function(){return this.title
};a.prototype.getClass=function(){return this.rc};a.prototype.remove=function(){this.setValue("");
this.setTitle()};a.prototype.setReadonly=function(d){var c=this;if(d===undefined){d=true
}b("#st_"+c.name).attr("disabled",d);b("#sb_"+c.name).attr("disabled",d);b("#rb_"+c.name).attr("disabled",d);
c.read_only=d};b.fn.sapnsSelector=function(f,e,d){if(typeof(f)=="object"){var h=new a(f);
var j='<input id="st_'+h.name+'" class="sp-select-text" type="text" readonly value=""';
if(this.attr("readonly")||this.attr("disabled")){h.read_only=true}if(h.read_only){j+=" disabled"
}j+=">";this.append(j);this.find("#st_"+h.name).dblclick(function(){if(!h.isReadonly){var l=h.getClass();
var n=h.getValue();if(n!=""){var k=h.edit_url;var m='<form action="'+k+'" method="post" target="_blank">                                <input type="hidden" name="cls" value="'+l+'">                                <input type="hidden" name="id" value="'+n+'">                                <input type="hidden" name="came_from" value="">                            </form>';
b(m).appendTo("body").submit().remove()}}});var i=sprintf('{{_("Set a value for [%s]")}}',h.title);
var c='<button id="sb_'+h.name+'" class="sp-button sp-select-button"  title="'+i+'"  style="font-weight:bold"';
if(h.read_only){c+=" disabled"}c+=">...</button>";this.append(c);this.find("#sb_"+h.name).click(function(){if(!h.isReadonly){var l=h.rc_title;
if(typeof(h.rc_title)=="function"){l=h.rc_title()}var m="dialog_"+h.name,k="#"+m;
b(k).remove();b('<div id="'+m+'"><div class="sapnsGrid"></div></div>').appendTo("body");
b(k+" .sapnsGrid").sapnsGrid(h.grid);b(k).dialog({title:l,width:h.dialog.width,height:h.dialog.height,resizable:false,modal:true,close:function(){b("#"+m).remove()
},buttons:{"{{_('Ok')}}":function(){var n=b("#"+m+" .sapnsGrid").sapnsGrid("getSelectedIds")[0];
h.setValue(n);h.setTitle();b(k).dialog("destroy").remove()},"{{_('Cancel')}}":function(){b(k).dialog("destroy").remove()
}}})}});h.setTitle();var g='<button id="rb_'+h.name+'" class="sp-button sp-empty-button"';
if(h.read_only){g+=" disabled "}var i=sprintf("{{_('Remove value of [%s]')}}",h.title);
g+=' title="'+i+'"  style="font-weight: bold; color: red;">x</button>';this.append(g);
this.find("#rb_"+h.name).click(function(){if(!h.isReadonly){h.remove()}});this.data("sapnsSelector",h)
}else{if(typeof(f)=="string"){var h=this.data("sapnsSelector");if(f=="setValue"){h.setValue(e,d);
h.setTitle()}else{if(f=="getValue"){return h.value}else{if(f=="getTitle"){return h.title
}else{if(f=="getClass"){return h.rc}else{if(f=="setReadonly"){h.setReadonly(e)}else{if(f=="isReadonly"){return h.read_only
}}}}}}}}return this}})(jQuery);