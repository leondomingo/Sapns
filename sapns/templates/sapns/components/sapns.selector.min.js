(function(b){function a(c){var d=b.extend(true,{name:"sapns_selector_"+Math.floor(Math.random()*999999),value:"",title:"",rc:"",rc_title:c.rc.toUpperCase(),read_only:false,title_url:"{{tg.url('/dashboard/title/')}}",edit_url:"{{tg.url('/dashboard/edit/')}}",onChange:null,onClick:null,dialog:{width:1100,height:600,},grid:{cls:c.rc,rp:25,pag_n:1,with_pager:false,height:380,exportable:false,select_first:true,search_params:{url:c.search_url,data:c.search_data}}},c);
b.extend(true,this,d)}a.prototype.setValue=function(f,e){var d=this;if(!d.read_only){var g=d.value!=f,c=d.value;
d.value=f;if(g&&d.onChange&&!e){d.onChange(f,c)}}};a.prototype.getValue=function(){return this.value
};a.prototype.setTitle=function(){var c=this,e="#st_"+c.name,d=c.value;if(d&&c.rc){b.ajax({url:c.title_url,data:{cls:c.rc,id:c.value},success:function(f){if(f.status){b(e).val(f.title).parent().attr("value",d);
c.title=f.title}}})}else{b(e).val("").parent().attr("value","");c.title=""}};a.prototype.getTitle=function(){return this.title
};a.prototype.getClass=function(){return this.rc};a.prototype.remove=function(){this.setValue("");
this.setTitle()};a.prototype.setReadonly=function(d){var c=this;if(d===undefined){d=true
}b("#st_"+c.name).attr("disabled",d);b("#sb_"+c.name).attr("disabled",d);b("#rb_"+c.name).attr("disabled",d);
c.read_only=d};a.prototype.dialog_name=function(){var c=this;return"#sp-selector-dialog-"+c.name
};b.fn.sapnsSelector=function(g,f,e){if(typeof(g)==="object"){var l=this,h=new a(g),c='<input id="st_'+h.name+'" class="sp-select-text" type="text" readonly value=""';
if(l.attr("readonly")||l.attr("disabled")){h.read_only=true;c+=" disabled"}c+=">";
l.append(c);l.find("#st_"+h.name).dblclick(function(){if(!h.isReadonly){var n=h.getClass(),p=h.getValue();
if(p!=""){var m=h.edit_url;if(m[m.length-1]!="/"){m+="/"}m+=sprintf("%s/%s",n,p);
var o='<form action="'+m+'" method="post" target="_blank">                                <input type="hidden" name="came_from" value="">                            </form>';
b(o).appendTo("body").submit().remove()}}});var j="{{_('Set value')}}",i='<button id="sb_'+h.name+'" class="sp-select-button" title="'+j+'"';
if(h.read_only){i+=" disabled"}i+=">...</button>";l.append(i);l.find("#sb_"+h.name).click(function(){if(!h.isReadonly){if(h.onClick){h.onClick(h.value)
}else{var n=h.rc_title;if(typeof(h.rc_title)==="function"){n=h.rc_title()}var m=h.dialog_name().replace("#","");
b(h.dialog_name()).remove();b('<div id="'+m+'"><div class="sapnsGrid"></div></div>').appendTo("body");
b(h.dialog_name()+" .sapnsGrid").sapnsGrid(h.grid);b(h.dialog_name()).dialog({title:n,width:h.dialog.width,height:h.dialog.height,resizable:false,modal:true,buttons:{"{{_('Ok')}}":function(){var p=b(h.dialog_name()+" .sapnsGrid").sapnsGrid("getSelectedIds")[0],o=h.getValue();
h.setValue(p);if(o!=p){h.setTitle()}b(h.dialog_name()).dialog("destroy").remove()
},"{{_('Cancel')}}":function(){b(h.dialog_name()).dialog("destroy").remove()}}})}}});
h.setTitle();var k='<button id="rb_'+h.name+'" class="sp-empty-button"',j="{{_('Remove value')}}";
if(h.read_only){k+=" disabled "}k+=' title="'+j+'">x</button>';this.append(k);this.find("#rb_"+h.name).click(function(){if(!h.isReadonly){h.remove()
}});this.data("sapnsSelector",h)}else{if(typeof(g)==="string"){var h=this.data("sapnsSelector");
if(g==="setValue"){var d=h.getValue();h.setValue(f,e);if(d!=f){h.setTitle()}}else{if(g==="getValue"){return h.value
}else{if(g==="getTitle"){return h.title}else{if(g==="getClass"){return h.rc}else{if(g==="setReadonly"){h.setReadonly(f)
}else{if(g==="isReadonly"){return h.read_only}}}}}}}}return this}})(jQuery);