(function(a){function b(c){function d(e,f,g,h){if(h==undefined){h=c}if(h[f]==undefined){e[f]=g
}else{e[f]=h[f]}return}d(this,"name","upl_"+Math.floor(Math.random()*999999));d(this,"file_name","");
d(this,"uploaded_file","");this.file_size=0;this.uploaded=false;d(this,"url","{{tg.url('/dashboard/docs/upload_file')}}");
d(this,"repo","");d(this,"show_button",true);d(this,"button_caption","Upload");d(this,"auto_upload",true);
d(this,"onUpload",null);d(this,"onDelete",null);d(this,"onError",null);d(this,"removeOnDelete",false);
d(this,"qtip",{});d(this.qtip,"style","ui-tooltip-red ui-tooltip-rounded",this.qtip);
d(this.qtip,"position",{my:"left center",at:"right center"},this.qtip)}b.prototype.getFilename=function(){return this.file_name
};b.prototype.setFilename=function(c){this.file_name=c};b.prototype.getFilesize=function(){return this.file_size
};b.prototype.getUploadedfile=function(){return this.uploaded_file};b.prototype.setUploadedfile=function(c){this.uploaded_file=c
};b.prototype.upload=function(){var c=this;if(a("#upload_file_form_"+c.name+" input[name=f]").val()==""){return
}if(c.getRepo()==""){var d="{{_('There is no repo selected')}}";if(!c.auto_upload){c.showWarning(a("#btn_upload_"+c.name),d)
}else{alert(d);a("#upload_file_form_"+c.name+" input[type=file]").val("")}return}a("#file_"+c.name).css("cursor","wait");
a("#upload_file_form_"+c.name+" input[name=id_repo]").val(c.repo);a("#upload_file_form_"+c.name).submit()
};b.prototype.isUploaded=function(){return this.uploaded};b.prototype.setUploaded=function(c){if(!c){this.file_size=0
}this.uploaded=c};b.prototype.setRepo=function(c){this.repo=c};b.prototype.getRepo=function(){return this.repo
};b.prototype.showWarning=function(f,c){try{f.qtip({content:{text:c},show:{target:false,ready:true},position:this.qtip.position,hide:"unfocus",style:this.qtip.style})
}catch(d){alert(d);alert(c)}};b.prototype.deleteFile=function(g){var c=this;var e=c.getFilename();
if(e!=""){var h=c.name;var d=function(){a("#file_name_"+h).hide();a("#upload_file_form_"+h).show();
c.setFilename("");c.setUploadedfile("");c.setUploaded(false)};if(g){a.ajax({url:"{{tg.url('/dashboard/docs/remove_file')}}",data:{file_name:e,id_repo:c.getRepo()},success:function(f){if(f.status){d()
}}})}else{d()}}};a.fn.sapnsUploader=function(f,d){if(f==undefined){f={}}if(typeof(f)=="object"){var g=new b(f);
var e=g.url;var i=g.name;var h='<div id="file_name_'+i+'" class="file_name"><div style="width: 80%; float: left; border: 1px solid lightgray; margin-top: 3px;">...</div><button id="btn_delete_file_'+i+'">{{_("Delete")}}</button></div>';
h+='<form id="upload_file_form_'+i+'" method="post" action="'+e+'" target="upload_target_'+i+'" enctype="multipart/form-data"> <input type="hidden" name="id_repo" value=""> <input id="file_'+i+'" type="file" name="f">';
if(g.show_button&&!g.auto_upload){h+=' <input id="btn_upload_'+i+'" type="button" value="'+g.button_caption+'">'
}h+=" </form>";h+='<iframe id="upload_target_'+i+'" name="upload_target_'+i+'" style="display: none;"></iframe>';
this.append(h);if(g.getFilename()==""){a("#file_name_"+i).css("display","none")}else{a("#upload_file_form_"+i).hide();
a("#file_name_"+i).find("div").html(g.getUploadedfile()).show()}a("#btn_delete_file_"+i).click(function(){g.deleteFile(g.removeOnDelete);
if(g.onDelete){g.onDelete()}g.setUploaded(false)});if(g.auto_upload){a("#upload_file_form_"+i+" input[type=file]").change(function(){g.upload()
})}var c=this;this.find("#upload_target_"+i).load(function(){var j=document.getElementById("upload_target_"+i).contentWindow.document.body.innerHTML;
if(j!=""){j=JSON.parse(j);if(j.status){a("#upload_file_form_"+i).hide();a("#file_"+i).css("cursor","").val("");
a("#file_name_"+i).find("div").html(j.uploaded_file);a("#file_name_"+i).css("cursor","").show();
g.uploaded_file=j.uploaded_file;g.file_name=j.file_name;g.file_size=j.file_size;if(g.onUpload){g.onUpload(j.uploaded_file,j.file_name)
}g.setUploaded(true)}else{if(g.onError){g.onError(j.message)}else{g.showWarning(a("#btn_upload_"+i),j.message)
}}}});this.find("#btn_upload_"+i).click(function(){g.upload()});this.data("sapnsUploader",g)
}else{if(typeof(f)=="string"){var g=this.data("sapnsUploader");if(f=="getFilename"){return g.getFilename()
}else{if(f=="getUploadedfile"){return g.getUploadedfile()}else{if(f=="setRepo"){g.setRepo(d)
}else{if(f=="getRepo"){return g.getRepo()}else{if(f=="deleteFile"){g.deleteFile(d)
}else{if(f=="isUploaded"){return g.isUploaded()}else{if(f=="getFilesize"){return g.getFilesize()
}}}}}}}}}return this}})(jQuery);