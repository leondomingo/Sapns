var __DEFAULT_FILTER='default';(function(a){function b(b){this.field=a.trim(b.field);this.operator=b.operator;this.value=a.trim(b.value);this.active=b.active!==undefined?!!b.active:true;}function c(b){b=a.trim(b.toLowerCase());b=b.replace(/[áäà]/g,'a');b=b.replace(/[éëè]/g,'e');b=b.replace(/[íïì]/g,'i');b=b.replace(/[óöò]/g,'o');b=b.replace(/[úüù]/g,'u');b=b.replace(/[^a-z0-9]/g,'');return b;}b.prototype={tip:function(){var a=this;return sprintf('&lt;%s&gt; %s "%s"',a.field,a.operator_title().toLowerCase(),a.value);},operator_title:function(){var a={co:"{{_('Contains')}}",eq:"{{_('Equals to')}}",lt:"{{_('Less than')}}",gt:"{{_('Greater than')}}",let:"{{_('Less than or equals to')}}",get:"{{_('Greater than or equals to')}}",nco:"{{_('Does not contain')}}",neq:"{{_('Not equals to')}}"};return a[this.operator];},toggle:function(){if(this.active)this.active=false;else this.active=true;},toString:function(){var a=this;var b=c(a.field);var d={co:'=',eq:'=',lt:'<',gt:'>',let:'<=',get:'>=',nco:'<>',neq:'<>'};var e=d[a.operator];var f=a.value;if(a.operator=='eq'||a.operator=='neq'){if(f)f=sprintf('"%s"',f);else if(a.operator=='eq')return sprintf('!%s',b);else if(a.operator=='neq')return sprintf('#%s',b);}else if((a.operator=='co'||a.operator=='nco')&&!f)if(a.operator=='co')return sprintf('!%s',b);else if(a.operator=='nco')return sprintf('#%s',b);return sprintf('%s%s%s',b,e,f);},stringify:function(){return sprintf('%s"%s" %s "%s"',!this.active?'_':'',this.field,this.operator,this.value);}};function d(c){var d=c.split(',');var e=[];for(var f=0,g=d.length;f<g;f++){var h=a.trim(d[f]).match('^(_)?"([^"]+)"\\s([a-z]{2,3})\\s"([^"]*)"$');if(h)e.push(new b({field:h[2],operator:h[3],value:h[4],active:!h[1]}));}return e;};function e(a){this.field=a.field;if(a.type=='+')this.type='asc';else if(a.type=='-')this.type='desc';else this.type=a.type;}e.prototype={toString:function(){var a=this;var b;if(a.type=='asc')b='+';else if(a.type=='desc')b='-';var d=c(a.field);return sprintf('%s%s',b,d);},stringify:function(){var a=this;var b;if(a.type=='asc')b='+';else if(a.type=='desc')b='-';return sprintf('%s"%s"',b,a.field);}};function f(b){var c=b.split(',');var d=[];for(var f=0,g=c.length;f<g;f++){var h=a.trim(c[f]).match('^(\\+|\\-)"([^"]+)"$');if(h)d.push(new e({field:h[2],type:h[1]}));}return d;}function g(b){var c=this;if(typeof (b.caption)==='function')b.caption=b.caption();if(typeof (b.actions)==='function')b.actions=b.actions();var d=b.pager_options;if(!d)d=[{val:10,desc:'10',sel:false},{val:50,desc:'50',sel:false},{val:100,desc:'100',sel:false},{val:0,desc:"{{_('All')}}",sel:false}];if(b.rp===undefined)b.rp=10;var e=[];for(var f=0,g=d.length;f<g;f++)e.push(d[f].val);var f=a.inArray(b.rp*1,e);if(f===-1)d.push({val:b.rp*1,desc:b.rp,sel:true});else d[f].sel=true;d.sort(function(a,b){if(a.val===0)return 1;else if(b.val==0)return -1;else return a.val-b.val;});var h=a.extend(true,{caption:'',name:'sapns_grid_'+Math.floor(Math.random()*999999),cls:'',with_search:true,with_filters:true,search_params:{},show_ids:false,link:'',q:'',user_filters:[],ch_attr:'',parent_id:'',cols:[],data:{},height:500,url_base:'',multiselect:false,allow_multiselect:true,actions:null,actions_inline:false,hide_check:false,hide_id:true,dblclick:null,select_first:false,shift_enabled:false,exportable:true,with_pager:true,pag_n:1,rp:10,onLoad:null,resize:{min_width:60,after:null},default_:{col_width:60,col_align:'center',empty_value:''}},b);a.extend(true,c,h);c.exportable_formats=[{id:'excel',title:'Excel',url:"{{tg.url('/dashboard/to_xls/')}}",func_name:'to_xls',export_url:"{{tg.url('/dashboard/to_xls_/')}}",modal:true},{id:'csv',title:'CSV',url:"{{tg.url('/dashboard/to_csv/')}}"}];if(b.exportable_formats)c.exportable_formats=b.exportable_formats;c.pager_options=d;c.this_page=0;c.total_count=0;c.total_pag=0;c.ajx_data=JSON.stringify({});c.styles=[];c.setQuery(c.q);c._new_default={name:'new',url:'{{tg.url("/dashboard/new/")}}',require_id:'false',type:'new'};c._edit_default={name:'edit',url:'{{tg.url("/dashboard/edit/")}}',require_id:'true',type:'edit'};c._delete_default={name:'delete',url:'{{tg.url("/dashboard/delete/")}}',require_id:'true',type:'delete'};c._docs_default={name:'docs',url:'{{tg.url("/docs/")}}',require_id:'true',type:'docs'};}g.prototype.setQuery=function(a){var b=this;var c=a.split('$$');b.q=c[0];b.filters=[];if(c.length>1)b.filters=d(c[1]);b.order=[];if(c.length>2)b.order=f(c[2]);if(c.length>3)b.current_user_filter=c[3];else b.current_user_filter=__DEFAULT_FILTER;};g.prototype.getSelectedIds=function(){var b=this;var c=[];a('#'+b.name+' .sp-grid-row').each(function(){var b=a(this).find('.sp-grid-rowid');if(b.prop('checked'))c.push(b.attr('id_row')*1);});return c;};g.prototype.getAction=function(a){var b=this;for(var c=0,d=(b.actions||[]).length;c<d;c++){var e=b.actions[c];if(typeof (e.type)==='object'){if(e.type.id===a)return e;}else if(e.name===a)return e;}};g.prototype.getRow=function(b){var c=this;var d=null;a('#'+c.name+' .sp-grid-row').each(function(){var c=a(this).find('.sp-grid-rowid');if(c.attr('id_row')===b){d=c.parent();return;}});return d;};g.prototype.loadData=function(b){var c=this;var d=c.cols;if(typeof d==='function')d=d();var e=23;if(c.hide_check)e=-6;var f=d.length*42;if(d[0].title!='id'){c.hide_check=true;c.hide_id=true;c.actions_inline=false;}if(!c.hide_check)f+=23;if(!c.hide_id)f+=60;var g=905;if(f<g)f=g;var h='';for(var i=0,j=d.length;i<j;i++){var k=d[i];if(k.title!='id')h+='<option value="'+k.title+'">'+k.title+'</option>';if(c.hide_id&&k.title==='id')continue;e+=(k.width+5);}a('#'+c.name+' .sp-grid-filter-field').html(h);var l='<div class="sp-grid" style="width:'+(e+200)+'px">';var m='<div class="sp-grid-row" style="width:'+(e+150)+'px">';if(!c.hide_check){var n='';if(!c.allow_multiselect)n='disabled';m+='<div class="sp-col-title" style="width:23px">                <input class="sp-grid-select-all" type="checkbox" '+n+'></div>';}if(c.actions_inline)m+='<div class="sp-col-title" style="%(actions_wd)s">*</div>';var o={};for(var i=0,j=c.order.length;i<j;i++){var p=c.order[i];p.index=i+1;o[c.order[i].field]=p;}for(var i=0,j=d.length;i<j;i++){var k=d[i];var q=k.width;if(!q)q=c.default_.col_width;if(c.hide_id&&k.title==='id')continue;var r='';var s='';var t='';if(o[k.title]){var p=o[k.title];r='sp-grid-ordered-col';s=' order_type="'+p.type+'"';var u;if(p.type==='asc')u='+';else u='-';t=' ('+p.index+u+')';}m+='<div class="sp-col-title sp-col-title-sortable '+r+'"'+s+' col_num="'+i+'" style="width:'+q+'px" col_title="'+k.title+'">'+k.title+t+'</div>';}m+='</div>';var v=c.data;if(typeof v==='function')v=v();var w=c.getAction('edit')!==undefined,x=c.getAction('delete')!==undefined,y=c.getAction('docs')!==undefined;var z='',A='';if(c.actions_inline){A=107;if(!c.nonstd)A=82;var B=25;var z='<div class="sp-grid-cell" style="%(actions_wd)s">';if(w)z+='<img class="inline_action edit_inline" title="{{_("Edit")}}"                    src="{{tg.url("/images/sapns/icons/edit.png")}}">';else z+='<img class="inline_action edit_inline" title="{{_("Edit")}}"                    src="{{tg.url("/images/sapns/icons/edit_disabled.png")}}">';if(x)z+='<img class="inline_action delete_inline" title="{{_("Delete")}}"                     src="{{tg.url("/images/sapns/icons/delete.png")}}">';else z+='<img class="inline_action delete_inline" title="{{_("Delete")}}"                     src="{{tg.url("/images/sapns/icons/delete_disabled.png")}}">';if(y)z+='<img class="inline_action docs_inline" title="{{_("Docs")}}"                     src="{{tg.url("/images/sapns/icons/docs.png")}}">';else z+='<img class="inline_action docs_inline" title="{{_("Docs")}}"                     src="{{tg.url("/images/sapns/icons/docs_disabled.png")}}">';A=sprintf('width:%dpx',A);}var C=v.length;if(C>0){for(var i=0;i<C;i++){var D=v[i];var E='';if(c.styles.length&&c.styles.length>i)E=c.styles[i];var F='<div class="sp-grid-row" style="width:'+(e+150)+'px">';if(!c.hide_check){var G='';if(i===C-1)G='border-radius:0 0 0 5px';F+='<div class="sp-grid-cell" title="'+D[0]+'" style="width:23px;'+G+'">'+'<input class="sp-grid-rowid" type="checkbox" id_row="'+D[0]+'"></div>';}if(c.actions_inline)F+=sprintf(z,{actions_wd:A})+c.nonstd+'</div>';if(i===0)l+=sprintf(m,{actions_wd:A});for(var H=0,I=d.length;H<I;H++){var k=d[H];var J=k.align;if(!J)J=c.default_.col_align;var q=k.width;if(!q)q=c.default_.col_width;var K=D[H];if(!K)K=c.default_.empty_value;if(c.hide_id&&k.title=='id')continue;var L='';if(q>0)L=' width:'+q+'px;';var G='';if((c.hide_check&&i==C-1)&&(!c.hide_id&&H==0||c.hide_id&&H==1))G='border-radius:0 0 0 5px;';if(i==C-1&&H==I-1)G='border-radius:0 0 5px 0;';F+='<div class="sp-grid-cell sp-grid-cell-tip clickable '+E+'"                         col_num="'+H+'" style="text-align:'+J+';'+L+G+'"';if(K)F+=sprintf('title="%s"',K.replace(/"/gi,"''"));else F+='title="({{_("empty")}})"';F+='>'+K+'</div>';}F+='</div>';l+=F;}}else{var M=1;var N=e;if(c.actions_inline){M=3;N+=25;}l+=sprintf(m,{actions_wd:A})+'<div class="sp-grid-row"><div class="sp-grid-cell sp-grid-noresults" title="{{_("No results")}}" '+'style="width:'+N+'px" >{{_("No results")}}</div></div>';}l+='</div>';a('#'+c.name).find('.sp-grid-parent').html(l);a('.sp-col-title-sortable').disableSelection();if(c.select_first&&c.with_search&&c.q&&C<5&&C>0)a('#'+c.name+' .sp-grid-rowid:first').prop('checked',true);var O='#'+c.name;a(O+' .sp-col-title-sortable, '+O+' .sp-grid-cell-tip').resizable({handles:'e',minWidth:c.resize.min_width,resize:function(b,c){var d=c.element.width(),e=c.element.attr('col_num'),f=a(O+' .sp-grid-row').width(),g=a(O+' .sp-grid-cell[col_num='+e+']').width();a(O+' .sp-col-title-sortable[col_num='+e+']').width(d);a(O+' .sp-grid-cell[col_num='+e+']').width(d);a(O+' .sp-grid-row').width(f+(d-g));},stop:function(b,d){var e=d.element.attr('col_num');if(c.resize.after)c.resize.after(e*1);else{var f=c.cols.length;if(c.cols[0].title==='id')f-=1;a.ajax({url:"{{tg.url('/dashboard/save_col_width/')}}",data:{cls:c.cls,length:f,col_num:e,width:d.element.width()},success:function(a){if(a.status){}}});}}});if(b)b();};g.prototype.query=function(){var b=this;var c=b.q;var d=a.map(b.filters,function(a){if(a.active)return a;});if(d.length)if(c)c=c+', '+d.join(', ');else c=d.join(', ');if(b.order.length)if(c)c=c+', '+b.order.join(', ');else c=b.order.join(', ');return c;};g.prototype.query_=function(){var a=this,b=a.q+'$$';for(var c=0,d=a.filters.length;c<d;c++){if(c>0)b+=', ';b+=a.filters[c].stringify();}b+='$$';for(var c=0,d=a.order.length;c<d;c++){if(c>0)b+=', ';b+=a.order[c].stringify();}if(a.current_user_filter!==__DEFAULT_FILTER)b+='$$'+a.current_user_filter;return b;};g.prototype.search=function(b,c,d){var e=this;if(c===undefined)c=false;if(b===undefined)b=e.q;if(e.q!=b||c)e.pag_n=1;e.q=b;e.filters_tip();var b=e.query();var f=sprintf('<div class="sp-grid-loading" style="height:%(hg)dpx">{{_("Loading")}}...</div>',{hg:e.height-50});a('#'+e.name).find('.sp-grid-parent').html(f);var g=a.extend(true,{url:"{{tg.url('/dashboard/grid/')}}",cache:false,data:{cls:e.cls,q:b,rp:e.rp,pag_n:e.pag_n,ch_attr:e.ch_attr,parent_id:e.parent_id},success:function(b){if(b.status){if(b.this_page)e.this_page=b.this_page;if(b.total_count)e.total_count=b.total_count;if(b.total_pag)e.total_pag=b.total_pag;if(b.cols)e.cols=b.cols;if(b.actions)e.actions=b.actions;if(b.styles)e.styles=b.styles;var c=(e.pag_n-1)*e.rp*1;var f={curr_page:e.pag_n*1,total_page:e.total_pag*1,pos0:c+1,pos1:c+e.this_page};var g=sprintf("{{_('Page %(curr_page)d of %(total_page)d / Showing rows %(pos0)d to %(pos1)d')}}",f);a('#'+e.name+' .sp-grid-first-page').attr('title',"{{_('page 1')}}");if(f.curr_page>1){var h=sprintf("{{_('page %(p)d')}}",{p:f.curr_page-1});a('#'+e.name+' .sp-grid-page-back').attr('title',h).prop('disabled',false);}else a('#'+e.name+' .sp-grid-page-back').prop('disabled',true);if(f.curr_page<f.total_page){var i=sprintf("{{_('page %(p)d')}}",{p:f.curr_page+1});a('#'+e.name+' .sp-grid-page-forth').attr('title',i).prop('disabled',false);}else a('#'+e.name+' .sp-grid-page-forth').prop('disabled',true);a('#'+e.name+' .sp-search-txt').focus();var j=sprintf("{{_('page %(p)d')}}",{p:f.total_page});a('#'+e.name+' .sp-grid-last-page').attr('title',j);a('#'+e.name+' .sp-grid-current-page').val(e.pag_n);e.data=b.data;e.loadData(function(){a('.sp-grid-cell-tip, .edit_inline, .delete_inline, .docs_inline, .new_inline, .sp-grid-save-filter').qtip({content:{text:true},position:{my:'top left',at:'bottom center'},style:'ui-tooltip-rounded'});});if(d)d(b);if(e.onLoad)e.onLoad(b);}}},e.search_params);var h=JSON.stringify(g.data);if(e.ajx_data)if(e.ajx_data===h&&!c)e.loadData();else a.ajax(g);e.ajx_data=h;};g.prototype.warningSelectedId=function(){var b=this;a('#grid-dialog_'+b.name).html("<p style='text-align:center;font-style:italic'>{{_('You must select a row before click on this action')}}</p>").dialog({title:b.caption,resizable:false,height:155,width:450,modal:true,draggable:false,buttons:{"{{_('Close')}}":function(){a('#grid-dialog_'+b.name).dialog('close');}}});a('.ui-icon-closethick').hide();};g.prototype._loadActions=function(b){var c=this;var d='';c.nonstd='';var e='<button id="%(id)s" class="sp-grid-button-action">%(title)s</button>';var f='<option value="%(id)s">%(title)s</option>';if(b.length>0){d='';for(var g=0,h=b.length;g<h;g++){var i=b[g];var j=i.require_id;if(j===undefined)j=true;if(typeof (i.type)==='string'&&i.type==='new'){var k='<img class="inline_action new_inline" '+'title="{{_("New")}}" src="{{tg.url("/images/sapns/icons/new.png")}}">';a('#'+c.name+' .sp-grid-search-box').append(k);}else if(!c.actions_inline){a('#'+c.name+' .sp-grid-button-actions').show();var l;if(typeof (i.type)=='object')l={id:i.type.id,title:i.title};else l={id:i.name,title:i.title};a('#'+c.name+' .sp-grid-button-actions').append(sprintf(e,l));}else if(c.actions_inline)if(typeof (i.type)==='string'&&(i.type=='edit'||i.type=='delete'||i.type=='docs'))continue;else{var m;if(typeof (i.type)=='object')m={id:i.type.id,title:i.title};else m={id:i.name,title:i.title};c.nonstd+=sprintf(f,m);}}if(c.nonstd)c.nonstd='<select class="nonstd_actions"><option value=""></option>'+c.nonstd+'</select>';}if(c.exportable){var n=c.exportable_formats;if(typeof (c.exportable)=='object')n=c.exportable.formats;var h=n.length;if(h>0){var o='';for(var g=0;g<h;g++)o+='<option value="'+n[g].id+'">'+n[g].title+'</option>';var p='<div class="export">                    <select class="sp-button sp-grid-action">                    <option value="">({{_("Export")}})</option>'+o+'</select></div>';a('#'+c.name+' .sp-grid-search-box').append(p);}}return d;};g.prototype.complete_actions=function(){var b=this;for(var c=0,d=(b.actions||[]).length;c<d;c++){var e=b.actions[c];if(typeof (e.type)==='string')if(e.type==='new')b.actions[c]=a.extend(b._new_default,e);else if(e.type==='edit')b.actions[c]=a.extend(b._edit_default,e);else if(e.type==='delete')b.actions[c]=a.extend(b._delete_default,e);else if(e.type==='docs')b.actions[c]=a.extend(b._docs_default,e);}};g.prototype.loadActions=function(b){var c=this;var d='';var e=sprintf('#%s .actions',c.name);if(c.actions!=null){if(c.actions.length===undefined){var f=a.extend(true,{url:"{{tg.url('/dashboard/grid_actions/')}}",cache:false,data:{cls:c.cls},success:function(d){if(d.status)c.actions=d.actions;a(e).html(c._loadActions(c.actions));if(b)b();}},c.actions);a.ajax(f);}else{a(e).html(c._loadActions(c.actions));if(b)b();}}else if(b)b();var g=sprintf('#%s .sp-grid-cell.clickable',c.name),h=sprintf('#%s .sp-grid-cell .sp-grid-rowid:checked',c.name);a(document).off('click',g).on('click',g,function(b){var d=(b.ctrlKey||b.metaKey)&&c.allow_multiselect;var e=a(this).parent().find('.sp-grid-rowid');if(!e.prop('checked')||d||(c.multiselect&&c.allow_multiselect)){a('#'+c.name+' .sp-grid-select-all').prop('checked',false);a('#'+c.name+' .sp-grid-rowid').each(function(){if(a(this)!=e&&!c.multiselect&&!d){a(this).prop('checked',false);a(this).parent().parent().removeClass('sp-grid-row-selected');}});if(e.prop('checked')){e.prop('checked',false);a(this).parent().removeClass('sp-grid-row-selected');}else{e.prop('checked',true);a(this).parent().addClass('sp-grid-row-selected');}}else if(c.dblclick)l(e.attr('id_row')*1,c.dblclick,b.ctrlKey||b.metaKey,b.shiftKey);});var i=sprintf('#%s .sp-grid-cell .sp-grid-rowid',c.name);a(document).off('click',i).on('click',i,function(){var b=a(this).prop('checked');if(!c.allow_multiselect){a(i).prop('checked',false);a(this).prop('checked',b);}});function j(a,b){var d=c.query_();d=encodeURI(d).replace('-','%2D','g').replace('"','%22','g').replace('+','%2B','g').replace('#','%23','g');var e='';if(b!='_blank')var e=c.url_base+'?q='+d+'&rp='+c.rp+'&pag_n='+c.pag_n+'&ch_attr='+c.ch_attr+'&parent_id='+c.parent_id;var f='<form type="post" action="'+a+'" target="'+b+'">'+'<input type="hidden" name="came_from" value="'+e+'">';if(c.ch_attr)f+='<input type="hidden" name="_'+c.ch_attr+'" value="'+c.parent_id+'">';f+='</form>';return f;}function k(b,d,e,f,g){if(typeof (e.type)==='string'){if(g&&c.shift_enabled)if(e.type==='new')e=c._new_default;else if(e.type==='edit')e=c._edit_default;else if(e.type==='delete')e=c._delete_default;else if(e.type==='docs')e=c._docs_default;var h=e.url;if(h[h.length-1]!='/')h+='/';if(!e.data){var i='';if(f)i='_blank';if(e.type==='process'){if(e.require_id)if(b)h+=b;else{c.warningSelectedId();return;}else if(b)h+=b;}else if(e.type==='new')h+=sprintf('%s/',c.cls);else if(e.require_id)if(b)h+=sprintf('%s/%s',c.cls,b);else{c.warningSelectedId();return;}else if(b)h+=sprintf('%s/%s',c.cls,b);else h+=sprintf('%s/',c.cls);a(j(h,i)).appendTo('body').submit().remove();}else{var k=JSON.parse(e.data),l=false;var m={};m[k.param_name]=b;m[k.param_name+'$']=JSON.stringify(d);var n="{{_('Ok')}}";if(k.button_title)n=k.button_title;var o=true;if(k.refresh!==undefined)o=k.refresh;if(k.extra_params!==undefined)for(ep in k.extra_params)m[ep]=k.extra_params[ep];var p=c.name+'_dialog';a('#'+p).remove();var q=a('<div id="'+p+'" style="display:none"></div>').appendTo('body');var r=[];if(k.buttons===undefined)k.buttons=[{button_title:n,callback:k.callback,refresh:o}];var s=function(a){var b=this;b.b=a;b.call=function(){if(!l){l=true;window[b.b.callback](function(){if(b.b.refresh)c.search(c.q,true);q.dialog('close');},function(){l=false;});}};};for(var t=0,u=k.buttons.length;t<u;t++){var v=k.buttons[t],w=new s(v);r.push({text:v.button_title,click:w.call});}r.push({text:"{{_('Cancel')}}",click:function(){if(!l)q.dialog('close');}});var x,y={title:e.title,modal:true,resizable:false,width:k.width||'auto',height:k.height||'auto',closeOnEscape:false,buttons:r};if(k.json_load)x=function(a){if(a.status)q.html(a.content).dialog(y);else alert('Error!');};else x=function(a){q.html(a).dialog(y);};a.ajax({url:h,data:m,success:x,error:function(){alert('Error!');}});}}else{var z=d;if(e.require_id)if(z.length>0)e.type.f(z[0],z);else{c.warningSelectedId();return;}else if(z.length>0)e.type.f(z[0],z);else e.type.f();}}function l(a,b,d,e){var f=c.getAction(b);if(f!==undefined){if(typeof a!=='number')var g=a.parent().parent().find('.sp-grid-rowid').attr('id_row')*1;else var g=a;var h=c.getSelectedIds();if(h.length==0)h=[g];k(g,h,f,d,e);}}var m=sprintf('#%s .new_inline',c.name);a(document).off('click',m).on('click',m,function(b){l(a(this),'new',b.ctrlKey||b.metaKey,b.shiftKey);});if(c.actions_inline){var n=sprintf('#%s .edit_inline',c.name);a(document).off('click',n).on('click',n,function(b){l(a(this),'edit',b.ctrlKey||b.metaKey,b.shiftKey);});var o=sprintf('#%s .delete_inline',c.name);a(document).off('click',o).on('click',o,function(b){l(a(this),'delete',false,false);});var p=sprintf('#%s .docs_inline',c.name);a(document).off('click',p).on('click',p,function(b){l(a(this),'docs',false,b.shiftKey);});var q=sprintf('#%s .nonstd_actions',c.name);a(document).off('change',q).on('change',q,function(b){var c=a(this).val();if(c){l(a(this),c);a(q).val('');}});}else{var r=sprintf('#%s .sp-grid-button-action',c.name);a(document).off('click',r).on('click',r,function(b){var d=c.getAction(a(this).attr('id'));var e=c.getSelectedIds();k(e[0],e,d,b.ctrlKey||b.metaKey,b.shiftKey);});}var s=sprintf('#%s .export select',c.name);a(document).on('change',s,function(){var b=a(s).val();if(b=='')return;var d=c.exportable_formats;var e='';if(typeof (c.exportable)==='object'){d=c.exportable.formats;if(c.exportable.data)for(k in c.exportable.data){var f=c.exportable.data[k];if(typeof f==='function')f=f();e+='<input type="hidden" name="'+k+'" value="'+f+'">';}}var g='',h;for(var i=0,j=d.length;i<j;i++)if(d[i].id==b){h=d[i];break;}if(h.modal){a(this).find('option:first').prop('selected',true);var k=a.extend({cls:c.cls,q:c.query(),ch_attr:c.ch_attr,parent_id:c.parent_id,export_url:h.export_url},h.data||{});var e={};for(ep in h.data){var l=h.data[ep];if(typeof l==='function')l=l();e[ep]=l;}k.extra_params=JSON.stringify(e);a.ajax({url:h.url,data:k,success:function(b){var c=false;if(b.status){a('#sp-grid-export-dialog').remove();a('<div id="sp-grid-export-dialog" style="display:none"></div>').appendTo('body');a('#sp-grid-export-dialog').html(b.content).dialog({title:h.title,modal:true,resizable:false,width:h.width||700,height:h.height||'auto',buttons:{"{{_('Export')}}":function(){if(!c){c=true;window[h.func_name](function(){c=false;},function(){c=false;});}},"{{_('Close')}}":function(){if(!c)a('#sp-grid-export-dialog').dialog('close');}}});}}});}else{var m='<form action="'+h.url+'" method="get">                    <input type="hidden" name="cls" value="'+c.cls+'">                    <input type="hidden" name="q" value="'+c.query()+'">                    <input type="hidden" name="ch_attr" value="'+c.ch_attr+'">                    <input type="hidden" name="parent_id" value="'+c.parent_id+'">'+e+'</form>';a(m).appendTo('body').submit().remove();a(this).find('option:first').prop('selected',true);}});};g.prototype.selectAll=function(b){var c=this;if(b===undefined)b=true;a('#'+c.name+' .sp-grid-rowid').prop('checked',b);};g.prototype.filters_tip=function(){var b=this;a('#'+b.name+' .sp-search-btn').qtip({content:{text:function(){var a='';if(b.filters.length)for(var c=0,d=b.filters.length;c<d;c++)if(!b.filters[c].active)a+='<font style="text-decoration:line-through">'+b.filters[c].tip()+'</font><br>';else a+=b.filters[c].tip()+'<br>';else a="{{_('There are not filters')}}";return a;}},position:{at:'top right',my:'bottom left'},style:'ui-tooltip-rounded'});if(b.filters.length)a('#'+b.name+' .sp-search-btn').css('border-color','orange');else a('#'+b.name+' .sp-search-btn').css('border-color','');};a.fn.sapnsGrid=function(c,d,f){if(typeof c==="object"){var h=new g(c);this.data('sapnsGrid',h);var i='#'+h.name;this.append(sprintf('<div id="grid-dialog_%(name)s" class="sp-grid-dialog" style="display:none"></div>',{name:h.name}));var j='';j+=sprintf('<div class="sp-grid-container" id="%(name)s" cls="%(cls)s">',{name:h.name,cls:h.cls});if(h.caption)j+=sprintf('<div class="sp-grid-caption">%(caption)s</div>',{caption:h.caption});if(h.with_search){j+='<div><div class="sp-grid-search-box">                    <input class="sp-search-txt" name="q" type="text" value="">                    <img class="inline_action sp-search-btn"                         src="{{tg.url("/images/sapns/icons/search.png")}}" title="{{_("Search...")}}">';if(h.with_filters){var k='';for(var l=0,m=h.user_filters.length;l<m;l++){var n=h.user_filters[l],o='';if(h.current_user_filter==n.name)o=' selected';k+='<option value="'+n.name+'"'+o+'>'+n.name+'</option>';}j+='<img class="inline_action sp-grid-save-filter"                             src="{{tg.url("/images/sapns/icons/filters.png")}}" title="{{_("Manage filter")}}">                        <select class="sp-grid-action sp-button sp-grid-select-filter">'+k+'</select>';}j+='</div>';j+='<div class="sp-grid-filters" style="display:none"></div>';j+='<div class="sp-grid-edit-filter" style="display:none">                    <div style="float:left;height:40px;margin-right:5px">                        <div class="sp-grid-filter-label">{{_("Field")}}</div>                        <div><select class="sp-grid-filter-field"></select></div>                    </div>                    <div style="float:left;height:40px;margin-right:5px">                        <div class="sp-grid-filter-label">{{_("Operator")}}</div>                        <div><select class="sp-grid-filter-operator">                            <option value="co">{{_("Contains")}}</option>                            <option value="eq">{{_("Equals to")}}</option>                            <option value="lt">{{_("Less than")}}</option>                            <option value="gt">{{_("Greater than")}}</option>                            <option value="let">{{_("Less than or equals to")}}</option>                            <option value="get">{{_("Greater than or equals to")}}</option>                            <option value="nco">{{_("Does not contain")}}</option>                            <option value="neq">{{_("Not equals to")}}</option>                        </select></div>                    </div>                    <div style="float:left;height:40px">                        <div class="sp-grid-filter-label">{{_("Value")}}</div>                        <input class="sp-grid-filter-value" type="text">                        <select class="sp-grid-filter-functions">                            <option value="">({{_("date functions")}})</option>                            <option value="{today}">{{_("Today")}}</option>                            <option value="{today - 1}">{{_("Yesterday")}}</option>                            <option value="{today + 1}">{{_("Tomorrow")}}</option>                            <option value="{start_week}">{{_("Week start")}}</option>                            <option value="{end_week}">{{_("Week end")}}</option>                            <option value="{start_month}">{{_("Month start")}}</option>                            <option value="{end_month}">{{_("Month end")}}</option>                            <option value="{start_month - 1m}">{{_("Previous month start")}}</option>                            <option value="{end_month - 1m}">{{_("Previous month end")}}</option>                            <option value="{start_month + 1m}">{{_("Next month start")}}</option>                            <option value="{end_month + 1m}">{{_("Next month end")}}</option>                            <option value="{start_year}">{{_("Year start")}}</option>                            <option value="{end_year}">{{_("Year end")}}</option>                            <option value="{start_year - 1y}">{{_("Previous year start")}}</option>                            <option value="{end_year - 1y}">{{_("Previous year end")}}</option>                            <option value="{start_year + 1y}">{{_("Next year start")}}</option>                            <option value="{end_year + 1y}">{{_("Next year end")}}</option>                        </select>                    </div></div>';var p='.sp-grid-activate-filter, .sp-grid-deactivate-filter';var q='.sp-grid-filter-value';a(document).off('keypress',q).on('keypress',q,function(b){if(b.which===13)a(this).parents('.ui-dialog').find('.ui-dialog-buttonset button:first').click();});var q='.sp-grid-filter-functions';a(document).off('change',q).on('change',q,function(){var b=a(this).val();a(this).parent().find('.sp-grid-filter-value').val(b);});var q='.sp-grid-row-filter button';a(document).off('click',q).on('click',q,function(){var b=a(this).parent().attr('filter_order');var c=h.filters[b];if(c.active){a(this).parent().removeClass('active').addClass('inactive');a(this).text("{{_('Activate')}}");}else{a(this).parent().removeClass('inactive').addClass('active');a(this).text("{{_('Deactivate')}}");}a(this).addClass('sp-grid-filter-changed');c.toggle();});var r=i+' .sp-search-btn';a(document).off('click',r).on('click',r,function(){function c(){var b='',c=h.filters.length;if(c)for(var d=0;d<c;d++){var e=h.filters[d];var f='',g='active';if(e.active)f='<button>{{_("Deactivate")}}</button>';else{g='inactive';f='<button>{{_("Activate")}}</button>';}b+='<div class="sp-grid-row-filter '+g+'" style="clear:left" filter_order="'+d+'">                                    <div style="float:left;margin-right:10px"><input class="sp-grid-check-filter" type="checkbox"></div>                                    <div class="sp-grid-filter-description"><span class="col">&lt;'+e.field+'&gt;</span>                                     <span class="operator">'+e.operator_title().toLowerCase()+'</span>                                    <span class="value">"'+e.value+'"</span></div>'+f+'</div>';}else b='<p class="sp-grid-no-filters">{{_("There are not filters")}}</p>';a(i+' .sp-grid-filters').html(b);}c();function d(c,d){a('<div/>').html(a(i+' .sp-grid-edit-filter').html()).dialog({title:"{{_('Edit filter')}}",modal:true,resizable:false,width:700,height:'auto',open:function(){if(c){a(this).find('.sp-grid-filter-field').val(c.field);a(this).find('.sp-grid-filter-operator').val(c.operator);a(this).find('.sp-grid-filter-value').val(c.value);}},buttons:{"{{_('Ok')}}":function(){var e=this;if(!c){c=new b({field:a(this).find('.sp-grid-filter-field').val(),operator:a(this).find('.sp-grid-filter-operator').val(),value:a(this).find('.sp-grid-filter-value').val()});h.filters.push(c);}else{c.field=a(this).find('.sp-grid-filter-field').val();c.operator=a(this).find('.sp-grid-filter-operator').val();c.value=a(this).find('.sp-grid-filter-value').val();}h.search(a(i+' .sp-search-txt').val(),true);a(this).dialog('destroy').remove();if(d)d();},"{{_('Cancel')}}":function(){a(this).dialog('destroy').remove();}}});}a('<div/>').html(a(i+' .sp-grid-filters').html()).dialog({title:"Filtros",modal:true,resizable:false,width:600,height:300,closeOnEscape:false,open:function(){var b=a(this);d(null,function(){b.dialog('destroy').remove();});},buttons:{"{{_('Add')}}":function(){var b=a(this);d(null,function(){b.dialog('destroy').remove();});},"{{_('Edit')}}":function(){var b=a(this).find('.sp-grid-row-filter input[type=checkbox]:visible:checked:first').parent().parent().attr('filter_order');var c=a(this);d(h.filters[b],function(){c.dialog('destroy').remove();});h.search(a(i+' .sp-search-txt').val(),true);},"{{_('Remove')}}":function(){var b=[];a(this).find('.sp-grid-row-filter input[type=checkbox]:visible:checked').each(function(){b.push(a(this).parent().parent().attr('filter_order')*1);});b=b.reverse();for(var c=0,d=b.length;c<d;c++)h.filters.splice(b[c],1);h.search(a(i+' .sp-search-txt').val(),true);a(this).dialog('destroy').remove();},"{{_('Remove all')}}":function(){h.filters=[];h.search(a(i+' .sp-search-txt').val(),true);a(this).dialog('destroy').remove();},"{{_('Close')}}":function(){if(a('.sp-grid-filter-changed').length){a('.sp-grid-filter-changed').removeClass('sp-grid-filter-changed');h.search(a(i+' .sp-search-txt').val(),true);}a(this).dialog('destroy').remove();}}});});var s=i+' .sp-search-txt';a(document).off('keypress',s).on('keypress',s,function(b){if(b.which===13)h.search(a(this).val());});var t=i+' .sp-grid-select-filter';a(document).off('change',t).on('change',t,function(){var b=a(this).val(),c='';for(var d=0,e=h.user_filters.length;d<e;d++){var f=h.user_filters[d];if(f.name===b){h.setQuery((h.q||'')+f.query);h.current_user_filter=b;h.search(h.query_().split('$$')[0],true);return;}}});var u=i+' .sp-grid-save-filter';a(document).off('click',u).on('click',u,function(){var b=h.query_(),c=a(t).val(),d=false,e='<div id="sp-grid-save-filter-dialog" style="display:none">                            <div class="sp-field-row">                                <div class="sp-field">                                    <div class="label">{{_("Filter name")}}</div>                                    <input class="sp-grid-filter-name" grid-id="'+i+'" type="text" value="'+c+'">                                </div>                            </div>                        </div>';a('#sp-grid-save-filter-dialog').remove();a(e).appendTo('body').dialog({title:"{{_('Save filter')}}",modal:true,resizable:false,width:400,height:'auto',buttons:{"{{_('Create or Modify')}}":function(){if(!d){d=true;var c=a('.sp-grid-filter-name[grid-id='+i+']').val().replace(/(á|ä|à|â)/g,'a').replace(/(Á|Ä|À|Â)/g,'A').replace(/(é|ë|è|ê)/g,'e').replace(/(É|Ë|È|Ê)/g,'E').replace(/(í|ï|ì|î)/g,'i').replace(/(Í|Ï|Ì|Î)/g,'I').replace(/(ó|ö|ò|ô)/g,'o').replace(/(Ó|Ö|Ò|Ô)/g,'O').replace(/(ú|ü|ù|û)/g,'u').replace(/(Ú|Ü|Ù|Û)/g,'U').replace(/ñ/g,'n').replace(/Ñ/g,'N').replace(/[^A-Za-z0-9_]/g,'_');a.ajax({url:"{{tg.url('/dashboard/save_user_filter/')}}",data:{cls:h.cls,filter_name:c,query:b},success:function(e){if(e.status){var f=false;for(var g=0,i=h.user_filters.length;g<i;g++){var j=h.user_filters[g];if(j.name===c){j.query=b;f=true;}}if(!f){h.user_filters.push({name:c,query:b});a(t).append('<option value="'+c+'">'+c+'</option>');a(t).val(c);}a('#sp-grid-save-filter-dialog').dialog('close');}else{if(e.msg){}d=false;alert('Error!');}},error:function(){d=false;alert('Error!');}});}},"{{_('Delete')}}":function(){if(!d){var b=a('.sp-grid-filter-name[grid-id='+i+']').val();d=true;a.ajax({url:"{{tg.url('/dashboard/delete_user_filter/')}}",data:{cls:h.cls,filter_name:b},success:function(c){if(c.status){a(t).val('default').change();a(t+' option[value='+b+']').remove();var e=[];for(var f=0,g=h.user_filters.length;f<g;f++){var i=h.user_filters[f];if(i.name!==b)e.push(i);}h.user_filters=e;a('#sp-grid-save-filter-dialog').dialog('close');}else{d=false;alert('Error!');}},error:function(){d=false;alert('Error!');}});}},"{{_('Cancel')}}":function(){if(!d)a('#sp-grid-save-filter-dialog').dialog('close');}}});});j+='</div>';}var v='.sp-grid-filter-name[grid-id='+i+']';a(document).off('keypress',v).on('keypress',v,function(b){if(b.which===13)a(this).parents('.ui-dialog').find('.ui-dialog-buttonset button:first').click();});var w='<div class="sp-grid-parent" style="overflow:auto;clear:left;height:'+(h.height+5)+'px;background-color:transparent"></div>';var x='';if(h.with_pager){x+='<div class="sp-grid-pager">                    <div class="sp-grid-pager-desc"></div>';var y='';for(var l=0,m=h.pager_options.length;l<m;l++){var z=h.pager_options[l];var o='';if(z.sel)o=' selected ';y+='<option value="'+z.val+'"'+o+'>'+z.desc+'</option>';}x+='<div style="float:left;clear:right;height:25px;margin-top:2px">'+'<select class="sp-button sp-grid-rp">'+y+'</select>'+'<button class="sp-button sp-grid-first-page" style="float:left">|&lt;&lt;</button>'+'<button class="sp-button sp-grid-page-back" style="float:left">&lt;&lt;</button>'+'<input class="sp-grid-current-page" type="text" style="text-align:center;font-size:11px;margin-top:3px" readonly>'+'<button class="sp-button sp-grid-page-forth" style="float:left">&gt;&gt</button>';x+='</div>';var A=sprintf('%s .sp-grid-rp',i),B=sprintf('%s .sp-grid-first-page',i),C=sprintf('%s .sp-grid-page-back',i),D=sprintf('%s .sp-grid-page-forth',i),E=sprintf('%s .sp-grid-last-page',i);a(document).off('change',A).on('change',A,function(){h.rp=a(this).val();h.pag_n=1;h.search(h.q);});a(document).off('click',B).on('click',B,function(){h.pag_n=1;h.search(h.q);});a(document).off('click',C).on('click',C,function(){if(h.pag_n>1){h.pag_n-=1;h.search(h.q);}});a(document).off('click',D).on('click',D,function(){if(h.pag_n<h.total_pag){h.pag_n*=1;h.pag_n+=1;h.search(h.q);}});a(document).off('click',E).on('click',E,function(){h.pag_n=h.total_pag;h.search(h.q);});}var F=sprintf('%s .sp-grid-select-all',i);a(document).off('click',F).on('click',F,function(){var b=a(this).prop('checked');h.selectAll(b);});var G=i+' .sp-col-title-sortable';a(document).off('click',G).on('click',G,function(b){var c=a(this).attr('col_title');var d=b.shiftKey;var f=b.ctrlKey||b.metaKey;if(a(this).hasClass('sp-grid-ordered-col')){var g;if(a(this).attr('order_type')=='asc')g='desc';else g='asc';if(d){for(var i=0,j=h.order.length;i<j;i++)if(h.order[i].field===c)break;h.order[i].type=g;}else if(!f){if(h.order.length>1)g='asc';var k=new e({field:c,type:g});h.order=[k];}else{for(var i=0,j=h.order.length;i<j;i++)if(h.order[i].field===c)break;h.order.splice(i,1);a(this).removeClass('sp-grid-ordered-col');}}else{var k=new e({field:c,type:'asc'});if(d)h.order.push(k);else h.order=[k];}h.search(undefined,true);});var H='<div class="sp-grid-button-actions" style="display:none"></div>';this.append(j+H+w+x+'</div>');h.loadActions(function(){a(i+' .sp-search-txt').val(h.q);h.search(h.q);});}else if(typeof c=="string"){var I=this.data('sapnsGrid');var i='#'+I.name;if(c=="loadData")I.loadData();else if(c=="search"){var J='';if(typeof d=='boolean')J=I.q;else if(d)J=d;if(I.with_search)a(i+' .sp-search-txt').val(J);I.search(J,true,f);}else if(c=="getSelectedIds")return I.getSelectedIds();else if(c=="setRp"){I.rp=d;a(i+' .sp-grid-rp [value='+d+']').prop('selected',true);}else if(c=="selectAll")I.selectAll();else if(c==="getQuery")return I.query_();else if(c==="setQuery")I.setQuery(d);}return this;};})(jQuery);