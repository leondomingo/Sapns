(function(g){function b(h){this.field=g.trim(h.field);this.operator=h.operator;this.value=g.trim(h.value);
this.active=h.active!==undefined?!!h.active:true}function a(h){h=g.trim(h.toLowerCase());
h=h.replace(/[áäà]/g,"a");h=h.replace(/[éëè]/g,"e");h=h.replace(/[íïì]/g,"i");h=h.replace(/[óöò]/g,"o");
h=h.replace(/[úüù]/g,"u");h=h.replace(/[^a-z]/g,"");return h}b.prototype={tip:function(){var h=this;
return sprintf('&lt;%s&gt; %s "%s"',h.field,h.operator_title().toLowerCase(),h.value)
},operator_title:function(){var h={co:"Contiene",eq:"Igual a",lt:"Menor que",gt:"Mayor que",let:"Menor o igual que",get:"Mayor o igual que",nco:"No contiene",neq:"Distinto"};
return h[this.operator]},toggle:function(){if(this.active){this.active=false}else{this.active=true
}},toString:function(){var i=this;var l=a(i.field);var j={co:"=",eq:"=",lt:"<",gt:">",let:"<=",get:">=",nco:"<>",neq:"<>"};
var m=j[i.operator];var h=i.value;if(i.operator=="eq"||i.operator=="neq"){if(h){h=sprintf('"%s"',h)
}else{if(i.operator=="eq"){return sprintf("!%s",l)}else{if(i.operator=="neq"){return sprintf("#%s",l)
}}}}else{if((i.operator=="co"||i.operator=="nco")&&!h){if(i.operator=="co"){return sprintf("!%s",l)
}else{if(i.operator=="nco"){return sprintf("#%s",l)}}}}return sprintf("%s%s%s",l,m,h)
},stringify:function(){return sprintf('%s"%s" %s "%s"',!this.active?"_":"",this.field,this.operator,this.value)
}};function f(o){var q=o.split(",");var p=[];for(var n=0,j=q.length;n<j;n++){var h=g.trim(q[n]).match('^(_)?"([^"]+)"\\s([a-z]{2,3})\\s"([^"]*)"$');
if(h){p.push(new b({field:h[2],operator:h[3],value:h[4],active:!h[1]}))}}return p
}function d(h){this.field=h.field;if(h.type=="+"){this.type="asc"}else{if(h.type=="-"){this.type="desc"
}else{this.type=h.type}}}d.prototype={toString:function(){var h=this;var j;if(h.type=="asc"){j="+"
}else{if(h.type=="desc"){j="-"}}var i=a(h.field);return sprintf("%s%s",j,i)},stringify:function(){var h=this;
var i;if(h.type=="asc"){i="+"}else{if(h.type=="desc"){i="-"}}return sprintf('%s"%s"',i,h.field)
}};function e(p){var q=p.split(",");var j=[];for(var o=0,n=q.length;o<n;o++){var h=g.trim(q[o]).match('^(\\+|\\-)"([^"]+)"$');
if(h){j.push(new d({field:h[2],type:h[1]}))}}return j}function c(j){function l(m,n,o,p){if(p==undefined){p=j
}if(p[n]==undefined){m[n]=o}else{m[n]=p[n]}return}l(this,"caption","");if(typeof(this.caption)=="function"){this.caption=this.caption()
}l(this,"name","grid_"+Math.floor(Math.random()*999999));l(this,"cls","");l(this,"with_search",true);
l(this,"search_params",{});l(this,"show_ids",false);l(this,"link","");l(this,"q","");
l(this,"ch_attr","");l(this,"parent_id","");l(this,"cols",[]);l(this,"data",{});l(this,"height",500);
l(this,"url_base","");l(this,"multiselect",false);l(this,"actions_inline",false);
l(this,"hide_check",false);l(this,"hide_id",true);l(this,"dblclick",null);l(this,"select_first",false);
l(this,"onLoad",null);l(this,"default_",{});l(this.default_,"col_width",60,this.default_);
l(this.default_,"col_align","center",this.default_);l(this.default_,"empty_value","",this.default_);
l(this,"actions",null);if(typeof(this.actions)=="function"){this.actions=this.actions()
}l(this,"shift_enabled",false);l(this,"exportable",true);var h=[{id:"csv",title:"CSV",url:"{{tg.url('/dashboard/tocsv')}}"},{id:"excel",title:"Excel",url:"{{tg.url('/dashboard/toxls')}}"}];
l(this,"exportable_formats",h);l(this,"with_pager",true);l(this,"pag_n",1);l(this,"rp",10);
l(this,"this_page",0);l(this,"total_count",0);l(this,"total_pag",0);this.ajx_data="{}";
var i=this.q.split("$$");this.q=i[0];this.filters=[];if(i.length>1){this.filters=f(i[1])
}this.order=[];if(i.length>2){this.order=e(i[2])}this._new_default={name:"new",url:"/dashboard/new/",require_id:"false",type:"new"};
this._edit_default={name:"edit",url:"/dashboard/edit/",require_id:"true",type:"edit"};
this._delete_default={name:"delete",url:"/dashboard/delete/",require_id:"true",type:"delete"};
this._docs_default={name:"docs",url:"/dashboard/docs/",require_id:"true",type:"docs"}
}c.prototype.getSelectedIds=function(){var h=this;var i=[];g("#"+h.name+" .sp-grid-row").each(function(){var j=g(this).find(".sp-grid-rowid");
if(j.attr("checked")==true){i.push(j.attr("id_row")*1)}});return i};c.prototype.getAction=function(o){var m=this;
for(var n=0,j=m.actions.length;n<j;n++){var h=m.actions[n];if(typeof(h.type)=="object"){if(h.type.id==o){return h
}}else{if(h.name==o){return h}}}};c.prototype.getRow=function(j){var h=this;var i=null;
g("#"+h.name+" .sp-grid-row").each(function(){var l=g(this).find(".sp-grid-rowid");
if(l.attr("id_row")==j){i=l.parent();return}});return i};c.prototype.loadData=function(u){var E=this;
var C=E.cols;if(typeof(C)=="function"){C=C()}var w=23;if(E.hide_check){w=-6}var t=C.length*42;
if(!E.hide_check){t+=23}if(!E.hide_id){t+=60}var m=905;if(t<m){t=m}var A="";for(var O=0,K=C.length;
O<K;O++){var v=C[O];if(v.title!="id"){A+='<option value="'+v.title+'">'+v.title+"</option>"
}if(E.hide_id&&v.title=="id"){continue}w+=(v.width+5)}g("#"+E.name+" .sp-grid-filter-field").html(A);
var P='<div class="sp-grid" style="width:'+(w+5)+'px;">';var p='<div class="sp-grid-row" style="width:'+t+'px;">';
if(!E.hide_check){p+='<div class="sp-col-title" style="width:23px;"><input class="sp-grid-select-all" type="checkbox"></div>'
}if(E.actions_inline){p+='<div class="sp-col-title" style="%(actions_wd)s">*</div>'
}var F={};for(var O=0,K=E.order.length;O<K;O++){var H=E.order[O];H.index=O+1;F[E.order[O].field]=H
}for(var O=0,K=C.length;O<K;O++){var v=C[O];var B=v.width;if(!B){B=E.default_.col_width
}if(E.hide_id&&v.title=="id"){continue}var s="";var S="";var D="";if(F[v.title]){var H=F[v.title];
s="sp-grid-ordered-col";S=' order_type="'+H.type+'"';var y;if(H.type==="asc"){y="+"
}else{y="-"}D=" ("+H.index+y+")"}p+='<div class="sp-col-title sp-col-title-sortable '+s+'"'+S+' style="width:'+B+'px;" col_title="'+v.title+'">'+v.title+D+"</div>"
}p+="</div>";var T=E.data;if(typeof(T)=="function"){T=T()}var G=T.length;if(G>0){for(var O=0;
O<G;O++){var x=T[O];var r='<div class="sp-grid-row" style="width:'+t+'px;">';if(!E.hide_check){var N="";
if(O==G-1){N="border-radius:0 0 0 5px;"}r+='<div class="sp-grid-cell" title="'+x[0]+'" style="width:23px;'+N+'"><input class="sp-grid-rowid" type="checkbox" id_row="'+x[0]+'"></div>'
}if(E.actions_inline){var h="width:107px;";if(!E.nonstd){h="width:82px;"}var R='<div class="sp-grid-cell" style="%(actions_wd)s"><img class="inline_action edit_inline" title="{{_("Edit")}}" src="{{tg.url("/images/sapns/icons/edit.png")}}"><img class="inline_action delete_inline" title="{{_("Delete")}}" src="{{tg.url("/images/sapns/icons/delete.png")}}"><img class="inline_action docs_inline" title="{{_("Docs")}}" src="{{tg.url("/images/sapns/icons/docs.png")}}">';
r+=sprintf(R,{actions_wd:h})+E.nonstd+"</div>"}if(O==0){P+=sprintf(p,{actions_wd:h})
}for(var M=0,z=C.length;M<z;M++){var v=C[M];var L=v.align;if(!L){L=E.default_.col_align
}var B=v.width;if(!B){B=E.default_.col_width}var q=x[M];if(!q){q=E.default_.empty_value
}if(E.hide_id&&v.title=="id"){continue}var J="";if(B>0){J=" width:"+B+"px;"}var N="";
if((E.hide_check&&O==G-1)&&(!E.hide_id&&M==0||E.hide_id&&M==1)){N="border-radius:0 0 0 5px;"
}if(O==G-1&&M==z-1){N="border-radius:0 0 5px 0;"}r+='<div class="sp-grid-cell sp-grid-cell-tip" style="text-align:'+L+";"+J+N+'"';
if(q){r+=sprintf('title="%s"',q.replace(/"/gi,"''"))}else{r+='title="({{_("empty")}})"'
}r+='clickable="true">'+q+"</div>"}r+="</div>";P+=r}}else{var I=1;var Q=w;if(E.actions_inline){I=3;
Q+=25}P+=sprintf(p,{actions_wd:h})+'<div class="sp-grid-row"><div class="sp-grid-cell sp-grid-noresults" title="{{_("No results")}}" style="width:'+Q+'px;" >{{_("No results")}}</div></div>'
}P+="</div>";g("#"+E.name).find(".sp-grid-parent").html(P);g(".sp-col-title-sortable").disableSelection();
if(E.select_first&&E.with_search&&E.q&&G<5&&G>0){g("#"+E.name+" .sp-grid-rowid:first").attr("checked",true)
}if(u){u()}};c.prototype.search=function(h,j,s){var t=this;if(j==undefined){j=false
}if(h==undefined){h=t.q}if(t.q!=h||j){t.pag_n=1}t.q=h;t.filters_tip();var m=[];for(var p=0,o=t.filters.length;
p<o;p++){if(t.filters[p].active){m.push(t.filters[p])}}if(m.length){if(h){h=h+", "+m.join(", ")
}else{h=m.join(", ")}}if(t.order.length){if(h){h=h+", "+t.order.join(", ")}else{h=t.order.join(", ")
}}var n='<div style="padding:10px;font-size: 15px; '+sprintf('font-weight:bold;color:gray;height:%(hg)dpx;">{{_("Loading")}}...</div>',{hg:t.height-50});
g("#"+t.name).find(".sp-grid-parent").html(n);var u=g.extend(true,{url:"{{tg.url('/dashboard/grid/')}}",data:{cls:t.cls,q:h,rp:t.rp,pag_n:t.pag_n,ch_attr:t.ch_attr,parent_id:t.parent_id},success:function(l){if(l.status){if(l.this_page){t.this_page=l.this_page
}if(l.total_count){t.total_count=l.total_count}if(l.total_pag){t.total_pag=l.total_pag
}if(l.cols){t.cols=l.cols}if(l.actions){t.actions=l.actions}var y=(t.pag_n-1)*t.rp*1;
var x={curr_page:t.pag_n*1,total_page:t.total_pag*1,pos0:y+1,pos1:y+t.this_page};
var v=sprintf("{{_('Page %(curr_page)d of %(total_page)d / Showing rows %(pos0)d to %(pos1)d')}}",x);
g("#"+t.name+" .sp-grid-first-page").attr("title","{{_('page 1')}}");if(x.curr_page>1){var i=sprintf("{{_('page %(p)d')}}",{p:x.curr_page-1});
g("#"+t.name+" .sp-grid-page-back").attr("title",i).attr("disabled",false)}else{g("#"+t.name+" .sp-grid-page-back").attr("disabled",true)
}if(x.curr_page<x.total_page){var w=sprintf("{{_('page %(p)d')}}",{p:x.curr_page+1});
g("#"+t.name+" .sp-grid-page-forth").attr("title",w).attr("disabled",false)}else{g("#"+t.name+" .sp-grid-page-forth").attr("disabled",true)
}var q=sprintf("{{_('page %(p)d')}}",{p:x.total_page});g("#"+t.name+" .sp-grid-last-page").attr("title",q);
g("#"+t.name+" .sp-grid-current-page").val(t.pag_n);t.data=l.data;t.loadData(function(){g(".sp-grid-cell-tip, .edit_inline, .delete_inline, .docs_inline, .new_inline").qtip({content:{text:true},position:{my:"top left",at:"bottom center"},style:"ui-tooltip-rounded"})
});if(s){s(l)}if(t.onLoad){t.onLoad(l)}}}},t.search_params);var r=JSON.stringify(u.data);
if(t.ajx_data){if(t.ajx_data===r&&!j){t.loadData()}else{g.ajax(u)}}t.ajx_data=r};
c.prototype.warningSelectedId=function(){var h=this;g("#grid-dialog_"+h.name).html("<p style='text-align:center;font-style:italic;'>{{_('You must select a row before click on this action')}}</p>").dialog({title:h.caption,resizable:false,height:155,width:450,modal:true,draggable:false,buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+h.name).dialog("close")
}}});g(".ui-icon-closethick").hide()};c.prototype._loadActions=function(m){var w=this;
var u="";w.nonstd="";var q='<button id="%(id)s" class="sp-grid-button-action">%(title)s</button>';
var v='<option value="%(id)s">%(title)s</option>';if(m.length>0){u="";for(var n=0,h=m.length;
n<h;n++){var s=m[n];var o=s.require_id;if(o===undefined){o=true}if(typeof(s.type)==="string"&&s.type==="new"){var r='<img class="inline_action new_inline" title="{{_("New")}}" src="{{tg.url("/images/sapns/icons/new.png")}}">';
g("#"+w.name+" .sp-grid-search-box").append(r)}else{if(!w.actions_inline){g("#"+w.name+" .sp-grid-button-actions").show();
var y;if(typeof(s.type)=="object"){y={id:s.type.id,title:s.title}}else{y={id:s.name,title:s.title}
}g("#"+w.name+" .sp-grid-button-actions").append(sprintf(q,y))}else{if(w.actions_inline){if(typeof(s.type)==="string"&&(s.type=="edit"||s.type=="delete"||s.type=="docs")){continue
}else{var j;if(typeof(s.type)=="object"){j={id:s.type.id,title:s.title}}else{j={id:s.name,title:s.title}
}w.nonstd+=sprintf(v,j)}}}}}if(w.nonstd){w.nonstd='<select class="nonstd_actions"><option value=""></option>'+w.nonstd+"</select>"
}}if(w.exportable){var t=w.exportable_formats;if(typeof(w.exportable)=="object"){t=w.exportable.formats
}var h=t.length;if(h>0){var x="";for(var n=0;n<h;n++){x+='<option value="'+t[n].id+'">'+t[n].title+"</option>"
}var p='<div id="grid-export_'+w.name+'" style="height:25px;float:left;"><select id="select-export" class="sp-button sp-grid-action" style="height:20px;"><option value="">({{_("Export")}})</option>'+x+"</select></div>";
g("#"+w.name+" .sp-grid-search-box").append(p)}}return u};c.prototype.complete_actions=function(){var m=this;
for(var n=0,j=m.actions.length;n<j;n++){var h=m.actions[n];if(typeof(h.type)==="string"){if(h.type==="new"){m.actions[n]=g.extend(m._new_default,h)
}else{if(h.type==="edit"){m.actions[n]=g.extend(m._edit_default,h)}else{if(h.type==="delete"){m.actions[n]=g.extend(m._delete_default,h)
}else{if(h.type==="docs"){m.actions[n]=g.extend(m._docs_default,h)}}}}}}};c.prototype.loadActions=function(){var l=this;
var i="";if(l.actions!=null){if(l.actions.length===undefined){var h=g.extend(true,{url:"{{tg.url('/dashboard/grid_actions/')}}",type:"post",data:{cls:l.cls},success:function(o){if(o.status){l.actions=o.actions
}g("#"+l.name+" .actions").html(l._loadActions(l.actions))}},l.actions);g.ajax(h)
}else{g("#"+l.name+" .actions").html(l._loadActions(l.actions))}}g("#"+l.name+" .sp-grid-cell").live("click",function(p){if(g(this).attr("clickable")=="true"){g("#"+l.name+" .sp-grid-select-all").attr("checked",false);
var o=g(this).parent().find(".sp-grid-rowid");g("#"+l.name+" .sp-grid-rowid").each(function(){var q=p.ctrlKey||p.metaKey;
if(g(this)!=o&&!l.multiselect&&!q){g(this).attr("checked",false)}});if(o.attr("checked")==true){o.attr("checked",false)
}else{o.attr("checked",true)}}});function n(t,u){var r=l.q+"$$";for(var q=0,o=l.filters.length;
q<o;q++){if(q>0){r+=", "}r+=l.filters[q].stringify()}r+="$$";for(var q=0,o=l.order.length;
q<o;q++){if(q>0){r+=", "}r+=l.order[q].stringify()}r=encodeURI(r).replace("-","%2D","g").replace('"',"%22","g").replace("+","%2B","g").replace("#","%23","g");
var p="";if(u!="_blank"){var p=l.url_base+"?q="+r+"&rp="+l.rp+"&pag_n="+l.pag_n+"&ch_attr="+l.ch_attr+"&parent_id="+l.parent_id
}var s='<form type="post" action="'+t+'" target="'+u+'"><input type="hidden" name="came_from" value="'+p+'">';
if(l.ch_attr){s+='<input type="hidden" name="_'+l.ch_attr+'" value="'+l.parent_id+'">'
}s+="</form>";return s}function j(v,r,q,s,p){if(typeof(q.type)==="string"){if(p&&l.shift_enabled){if(q.type==="new"){q=l._new_default
}else{if(q.type==="edit"){q=l._edit_default}else{if(q.type==="delete"){q=l._delete_default
}else{if(q.type==="docs"){q=l._docs_default}}}}}var o=q.url;if(o[o.length-1]!="/"){o+="/"
}var t="";if(s){t="_blank"}if(q.type=="process"){if(q.require_id){if(v){o+=v}else{l.warningSelectedId();
return}}else{if(v){o+=v}}}else{if(q.type=="new"){o+=sprintf("%s/",l.cls)}else{if(q.type=="delete"){l.std_delete(r,q.url);
return}else{if(q.require_id){if(v){o+=sprintf("%s/%s",l.cls,v)}else{l.warningSelectedId();
return}}else{if(v){o+=sprintf("%s/%s",l.cls,v)}else{o+=sprintf("%s/",l.cls)}}}}}g(n(o,t)).appendTo("body").submit().remove()
}else{var u=r;if(q.require_id){if(u.length>0){q.type.f(u[0],u)}else{l.warningSelectedId();
return}}else{if(u.length>0){q.type.f(u[0],u)}else{q.type.f()}}}}function m(q,s,r,p){var o=l.getAction(s);
var t=q.parent().parent().find(".sp-grid-rowid").attr("id_row");j(t,[],o,r,p)}g("#"+l.name+" .new_inline").live("click",function(o){m(g(this),"new",o.ctrlKey||o.metaKey,o.shiftKey)
});if(l.actions_inline){g("#"+l.name+" .edit_inline").live("click",function(o){m(g(this),"edit",o.ctrlKey||o.metaKey,o.shiftKey)
});g("#"+l.name+" .delete_inline").live("click",function(q){var p=l.getSelectedIds();
if(p.length==0){var r=g(this).parent().parent().find(".sp-grid-rowid").attr("id_row");
p=[r]}var o=l.getAction("delete");l.std_delete(p,o.url)});g("#"+l.name+" .docs_inline").live("click",function(o){m(g(this),"docs",false,o.shiftKey)
});g("#"+l.name+" .nonstd_actions").live("change",function(p){var o=g(this).val();
if(o){m(g(this),o)}})}else{g("#"+l.name+" .sp-grid-button-action").live("click",function(p){var o=l.getAction(g(this).attr("id"));
var q=l.getSelectedIds();j(q[0],q,o,p.ctrlKey||p.metaKey,p.shiftKey)})}g("#grid-export_"+l.name).live("change",function(){var q=g("#grid-export_"+l.name+" option:selected").val();
if(q==""){return}var o=l.exportable_formats;var w="";if(typeof(l.exportable)=="object"){o=l.exportable.formats;
if(l.exportable.data){for(k in l.exportable.data){var r=l.exportable.data[k];if(typeof(r)=="function"){r=r()
}w+='<input type="hidden" name="'+k+'" value="'+r+'">'}}}var t="";for(var u=0,p=o.length;
u<p;u++){if(o[u].id==q){t=o[u].url;break}}var s='<form action="'+t+'" method="get"><input type="hidden" name="cls" value="'+l.cls+'"><input type="hidden" name="q" value="'+l.q+'"><input type="hidden" name="ch_attr" value="'+l.ch_attr+'"><input type="hidden" name="parent_id" value="'+l.parent_id+'">'+w+"</form>";
g(s).appendTo("body").submit().remove();g(this).find("option:first").attr("selected",true)
})};c.prototype.std_delete=function(m,l){var j=this;var i=j.cls;var p=JSON.stringify(m);
var n="<p id='delete-question'>{{_('Do you really want to delete this record?')}}</p><p id='object-title'></p>";
var h="<p id='delete-error-title'>{{_('Oops, something went wrong...')}}</p><div id='delete-error-message'></div>";
g("#grid-dialog_"+j.name).html(n);var o="";g.ajax({url:"{{tg.url('/dashboard/title')}}",type:"get",dataType:"json",data:{cls:i,id:p},success:function(q){if(q.status){var r;
if(typeof(q.title)=="string"){r=q.title}else{r=q.title.join(" | ")}g("#grid-dialog_"+j.name+" #object-title").html(r)
}},error:function(){}});g("#grid-dialog_"+j.name).dialog({width:650,height:210,resizable:false,modal:true,title:"{{_('Delete')}}",buttons:{"{{_('Ok')}}":function(){g.ajax({url:l,data:{cls:i,id_:p},success:function(r){if(r.status){j.search(j.q,true);
g("#grid-dialog_"+j.name).dialog("close")}else{g("#grid-dialog_"+j.name).dialog("close");
var s="<p style='color:gray;'>"+r.message+"</p>";if(r.rel_tables!=undefined&&r.rel_tables.length>0){s+="<div>{{_('For your information this object is related with other objects in the following classes:')}}</div>";
s+="<ul>";for(var q=0;q<r.rel_tables.length;q++){var u=r.rel_tables[q].class_title;
var t=r.rel_tables[q].attr_title;s+='<li><span style="font-weight:bold;">'+u+'</span> (<span style="color:#777;">'+t+"</span>)</li>"
}s+="</ul>"}g("#grid-dialog_"+j.name).html(h).find("#delete-error-message").html(s);
g("#grid-dialog_"+j.name).dialog({width:700,height:250,buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+j.name).dialog("close")
}}})}},error:function(){g("#grid-dialog_"+j.name).dialog("close");g("#grid-dialog_"+j.name).html(h).dialog({buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+j.name).dialog("close")
}}})}})},"{{_('Cancel')}}":function(){g("#grid-dialog_"+j.name).dialog("close")}}})
};c.prototype.selectAll=function(h){var i=this;if(h===undefined){h=true}g("#"+i.name+" .sp-grid-rowid").attr("checked",h)
};c.prototype.filters_tip=function(){var h=this;g("#"+h.name+" .sp-search-btn").qtip({content:{text:function(){var n="";
if(h.filters.length){for(var m=0,j=h.filters.length;m<j;m++){if(!h.filters[m].active){n+='<font style="text-decoration:line-through;">'+h.filters[m].tip()+"</font><br>"
}else{n+=h.filters[m].tip()+"<br>"}}}else{n="No hay filtros"}return n}},position:{at:"top right",my:"bottom left"},style:"ui-tooltip-rounded"});
if(h.filters.length){g("#"+h.name+" .sp-search-btn").css("border-color","orange")
}else{g("#"+h.name+" .sp-search-btn").css("border-color","")}};g.fn.sapnsGrid=function(r,n,m){if(typeof(r)=="object"){var p=new c(r);
this.data("sapnsGrid",p);var w="#"+p.name;this.append(sprintf('<div id="grid-dialog_%(name)s" style="display:none;"></div>',{name:p.name}));
var z="";z+=sprintf('<div class="sp-grid-container" id="%(name)s" cls="%(cls)s">',{name:p.name,cls:p.cls});
if(p.caption){z+=sprintf('<div class="sp-grid-caption">%(caption)s</div>',{caption:p.caption})
}if(p.with_search){z+='<div><div class="sp-grid-search-box"><input class="sp-search-txt" style="float:left;" name="q" type="text" value=""><img class="inline_action sp-search-btn" src="{{tg.url("/images/sapns/icons/search.png")}}" titlee="{{_("Search...")}}"></div>';
z+='<div class="sp-grid-filters" style="display:none;"></div>';z+='<div class="sp-grid-edit-filter" style="display:none;"><div style="float:left;height:40px;margin-right:5px;"><div>Campo</div><div><select class="sp-grid-filter-field"></select></div></div><div style="float:left;height:40px;margin-right:5px;"><div>Operador</div><div><select class="sp-grid-filter-operator"><option value="co">Contiene</option><option value="eq">Igual</option><option value="lt">Menor que</option><option value="gt">Mayor que</option><option value="let">Menor o igual que</option><option value="get">Mayor o igual que</option><option value="nco">No contiene</option><option value="neq">Distinto</option></select></div></div><div style="float:left;height:40px;"><div>Valor</div><input class="sp-grid-filter-value" type="text"></div></div>';
g(".sp-grid-activate-filter, .sp-grid-deactivate-filter").live("click",function(){var q=g(this).parent().attr("filter_order");
var A=p.filters[q];if(A.active){g(this).removeClass("sp-grid-deactivate-filter").addClass("sp-grid-activate-filter");
g(this).text("Activar")}else{g(this).addClass("sp-grid-deactivate-filter").removeClass("sp-grid-activate-filter");
g(this).text("Desactivar")}g(this).addClass("sp-grid-filter-changed");A.toggle()});
g(w+" .sp-search-btn").live("click",function(){function A(){var E="",B=p.filters.length;
if(B){for(var D=0;D<B;D++){var F=p.filters[D];var C="";if(F.active){C='<button class="sp-grid-deactivate-filter">Desactivar</button>'
}else{C='<button class="sp-grid-activate-filter">Activar</button>'}E+='<div class="sp-grid-row-filter" style="clear:left;" filter_order="'+D+'"><div style="float:left;margin-right:10px;"><input class="sp-grid-check-filter" type="checkbox"></div><div class="sp-grid-filter-description">&lt;'+F.field+"&gt; "+F.operator_title().toLowerCase()+' <span style="font-style:italic;">"'+F.value+'"</span></div>'+C+"</div>"
}}else{E='<p class="sp-grid-no-filters">No hay filtros</p>'}g(w+" .sp-grid-filters").html(E)
}A();function q(B,C){g("<div/>").html(g(w+" .sp-grid-edit-filter").html()).dialog({title:"Editar filtro",modal:true,resizable:false,width:700,height:150,open:function(){if(B){g(this).find(".sp-grid-filter-field").val(B.field);
g(this).find(".sp-grid-filter-operator").val(B.operator);g(this).find(".sp-grid-filter-value").val(B.value)
}},buttons:{Aceptar:function(){var D=this;if(!B){B=new b({field:g(this).find(".sp-grid-filter-field").val(),operator:g(this).find(".sp-grid-filter-operator").val(),value:g(this).find(".sp-grid-filter-value").val()});
p.filters.push(B)}else{B.field=g(this).find(".sp-grid-filter-field").val();B.operator=g(this).find(".sp-grid-filter-operator").val();
B.value=g(this).find(".sp-grid-filter-value").val()}p.search(g(w+" .sp-search-txt").val(),true);
g(this).dialog("close");if(C){C()}},Cancelar:function(){g(this).dialog("close")}}})
}g("<div/>").html(g(w+" .sp-grid-filters").html()).dialog({title:"Filtros",modal:true,resizable:false,width:600,height:300,closeOnEscape:false,open:function(){var B=g(this);
q(null,function(){B.dialog("close")})},buttons:{"Añadir":function(){var B=g(this);
q(null,function(){B.dialog("close")})},Editar:function(){var B=g(this).find(".sp-grid-row-filter input[type=checkbox]:visible:checked:first").parent().parent().attr("filter_order");
var C=g(this);q(p.filters[B],function(){C.dialog("close")});p.search(g(w+" .sp-search-txt").val(),true)
},Borrar:function(){var D=[];g(this).find(".sp-grid-row-filter input[type=checkbox]:visible:checked").each(function(){D.push(g(this).parent().parent().attr("filter_order")*1)
});D=D.reverse();for(var C=0,B=D.length;C<B;C++){p.filters.splice(D[C],1)}p.search(g(w+" .sp-search-txt").val(),true);
g(this).dialog("close")},"Borrar todos":function(){p.filters=[];p.search(g(w+" .sp-search-txt").val(),true);
g(this).dialog("close")},Cerrar:function(){if(g(".sp-grid-filter-changed").length){g(".sp-grid-filter-changed").removeClass("sp-grid-filter-changed");
p.search(g(w+" .sp-search-txt").val(),true)}g(this).dialog("close")}}})});g(w+" .sp-search-txt").live("keypress",function(q){if(q.which==13){p.search(g(this).val())
}});if(p.link){z+="<div style=\"padding-left:20px;\"><button id='link-shortcut' class='sp-button' style='float:left;'>{{_('Create a shortcut')}}</button><div style=\"font-size:9px;margin-top:7px; width:100px;float:left;\"><a id='this-search' href='"+p.link+"' target='_blank'>[{{_('this search')}}]</a></div><div id=\"link-shortcut-dialog\" style=\"display:none;\"><p>{{_('Do you want to create a shortcut for this search?')}}</p><label>{{_('Shortcut title')}}:</label><input id='link-shortcut-title' type='text' value='({{_('title')}})'></div></div>"
}z+="</div>"}var u='<div class="sp-grid-parent" style="overflow:auto;clear:left;height:'+(p.height+5)+'px;background-color:transparent;"></div>';
var j="";if(p.with_pager){j+='<div class="sp-grid-pager">                    <div class="sp-grid-pager-desc"></div>';
var t="",l="",y="",v="";var i=" selected";var o="";if(p.rp==10){t=i}else{if(p.rp==50){l=i
}else{if(p.rp==100){y=i}else{if(p.rp==0){v=i}else{o='<option value="'+p.rp+'" selected>'+p.rp+"</option>"
}}}}j+='<div style="float:left;clear:right;height:25px;margin-top:2px;"><select class="sp-button sp-grid-rp">'+o+'<option value="10"'+t+'>10</option><option value="50"'+l+'>50</option><option value="100"'+y+'>100</option><option value="0"'+v+'>{{_("All")}}</option></select><button class="sp-button sp-grid-first-page" style="float:left;">|&lt;&lt;</button><button class="sp-button sp-grid-page-back" style="float:left;">&lt;&lt;</button><input class="sp-grid-current-page" type="text" style="text-align:center;font-size:11px;margin-top:3px;" readonly><button class="sp-button sp-grid-page-forth" style="float:left;">&gt;&gt</button>';
j+="</div>";g(w+" .sp-grid-select-all").live("click",function(){var q=g(this).attr("checked");
p.selectAll(q)});g(w+" .sp-grid-rp").live("change",function(){p.rp=g(this).val();
p.pag_n=1;p.search(p.q)});g(w+" .sp-grid-first-page").live("click",function(){p.pag_n=1;
p.search(p.q)});g(w+" .sp-grid-page-back").live("click",function(){if(p.pag_n>1){p.pag_n-=1;
p.search(p.q)}});g(w+" .sp-grid-page-forth").live("click",function(){if(p.pag_n<p.total_pag){p.pag_n*=1;
p.pag_n+=1;p.search(p.q)}});g(w+" .sp-grid-last-page").live("click",function(){p.pag_n=p.total_pag;
p.search(p.q)})}g(w+" .sp-col-title-sortable").live("click",function(D){var F=g(this).attr("col_title");
var A=D.shiftKey;var E=D.ctrlKey||D.metaKey;if(g(this).hasClass("sp-grid-ordered-col")){var C;
if(g(this).attr("order_type")=="asc"){C="desc"}else{C="asc"}if(A){for(var B=0,q=p.order.length;
B<q;B++){if(p.order[B].field===F){break}}p.order[B].type=C}else{if(!E){if(p.order.length>1){C="asc"
}var G=new d({field:F,type:C});p.order=[G]}else{for(var B=0,q=p.order.length;B<q;
B++){if(p.order[B].field===F){break}}p.order.splice(B,1);g(this).removeClass("sp-grid-ordered-col")
}}}else{var G=new d({field:F,type:"asc"});if(A){p.order.push(G)}else{p.order=[G]}}p.search(undefined,true)
});var s='<div class="sp-grid-button-actions" style="display: none;"></div>';this.append(z+s+u+j+"</div>");
p.loadActions();g(w+" .sp-search-txt").val(p.q);p.search(p.q)}else{if(typeof(r)=="string"){var x=this.data("sapnsGrid");
var w="#"+x.name;if(r=="loadData"){x.loadData()}else{if(r=="search"){var h="";if(typeof(n)=="boolean"){h=x.q
}else{if(n){h=n}}if(x.with_search){g(w+" .sp-search-txt").val(h)}x.search(h,true,m)
}else{if(r=="getSelectedIds"){return x.getSelectedIds()}else{if(r=="setRp"){x.rp=n;
g(w+" .sp-grid-rp [value="+n+"]").attr("selected",true)}else{if(r=="selectAll"){x.selectAll()
}}}}}}}return this}})(jQuery);