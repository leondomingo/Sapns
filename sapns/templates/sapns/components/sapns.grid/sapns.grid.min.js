var __DEFAULT_FILTER="default";(function(g){function b(h){this.field=g.trim(h.field);
this.operator=h.operator;this.value=g.trim(h.value);this.active=h.active!==undefined?!!h.active:true
}function a(h){h=g.trim(h.toLowerCase());h=h.replace(/[áäà]/g,"a");h=h.replace(/[éëè]/g,"e");
h=h.replace(/[íïì]/g,"i");h=h.replace(/[óöò]/g,"o");h=h.replace(/[úüù]/g,"u");h=h.replace(/[^a-z0-9]/g,"");
return h}b.prototype={tip:function(){var h=this;return sprintf('&lt;%s&gt; %s "%s"',h.field,h.operator_title().toLowerCase(),h.value)
},operator_title:function(){var h={co:"{{_('Contains')}}",eq:"{{_('Equals to')}}",lt:"{{_('Less than')}}",gt:"{{_('Greater than')}}",let:"{{_('Less than or equals to')}}",get:"{{_('Greater than or equals to')}}",nco:"{{_('Does not contain')}}",neq:"{{_('Not equals to')}}"};
return h[this.operator]},toggle:function(){if(this.active){this.active=false}else{this.active=true
}},toString:function(){var i=this;var l=a(i.field);var j={co:"=",eq:"=",lt:"<",gt:">",let:"<=",get:">=",nco:"<>",neq:"<>"};
var m=j[i.operator];var h=i.value;if(i.operator=="eq"||i.operator=="neq"){if(h){h=sprintf('"%s"',h)
}else{if(i.operator=="eq"){return sprintf("!%s",l)}else{if(i.operator=="neq"){return sprintf("#%s",l)
}}}}else{if((i.operator=="co"||i.operator=="nco")&&!h){if(i.operator=="co"){return sprintf("!%s",l)
}else{if(i.operator=="nco"){return sprintf("#%s",l)}}}}return sprintf("%s%s%s",l,m,h)
},stringify:function(){return sprintf('%s"%s" %s "%s"',!this.active?"_":"",this.field,this.operator,this.value)
}};function f(o){var q=o.split(",");var p=[];for(var n=0,j=q.length;n<j;n++){var h=g.trim(q[n]).match('^(_)?"([^"]+)"\\s([a-z]{2,3})\\s"([^"]*)"$');
if(h){p.push(new b({field:h[2],operator:h[3],value:h[4],active:!h[1]}))}}return p
}function d(h){this.field=h.field;if(h.type=="+"){this.type="asc"}else{if(h.type=="-"){this.type="desc"
}else{this.type=h.type}}}d.prototype={toString:function(){var h=this;var j;if(h.type=="asc"){j="+"
}else{if(h.type=="desc"){j="-"}}var i=a(h.field);return sprintf("%s%s",j,i)},stringify:function(){var h=this;
var i;if(h.type=="asc"){i="+"}else{if(h.type=="desc"){i="-"}}return sprintf('%s"%s"',i,h.field)
}};function e(p){var q=p.split(",");var j=[];for(var o=0,n=q.length;o<n;o++){var h=g.trim(q[o]).match('^(\\+|\\-)"([^"]+)"$');
if(h){j.push(new d({field:h[2],type:h[1]}))}}return j}function c(o){var j=this;if(typeof(o.caption)==="function"){o.caption=o.caption()
}if(typeof(o.actions)==="function"){o.actions=o.actions()}var n=o.pager_options;if(!n){n=[{val:10,desc:"10",sel:false},{val:50,desc:"50",sel:false},{val:100,desc:"100",sel:false},{val:0,desc:"{{_('All')}}",sel:false}]
}if(o.rp===undefined){o.rp=10}var q=[];for(var m=0,h=n.length;m<h;m++){q.push(n[m].val)
}var m=g.inArray(o.rp*1,q);if(m===-1){n.push({val:o.rp*1,desc:o.rp,sel:true})}else{n[m].sel=true
}n.sort(function(i,l){if(i.val===0){return 1}else{if(l.val==0){return -1}else{return i.val-l.val
}}});var p=g.extend(true,{caption:"",name:"sapns_grid_"+Math.floor(Math.random()*999999),cls:"",with_search:true,with_filters:true,search_params:{},show_ids:false,link:"",q:"",user_filters:[],ch_attr:"",parent_id:"",cols:[],data:{},height:500,url_base:"",multiselect:false,allow_multiselect:true,actions:null,actions_inline:false,hide_check:false,hide_id:true,dblclick:null,select_first:false,shift_enabled:false,exportable:true,with_pager:true,pag_n:1,rp:10,onLoad:null,resize:{min_width:60,after:null},default_:{col_width:60,col_align:"center",empty_value:""}},o);
g.extend(true,j,p);j.exportable_formats=[{id:"excel",title:"Excel",url:"{{tg.url('/dashboard/to_xls/')}}",func_name:"to_xls",export_url:"{{tg.url('/dashboard/to_xls_/')}}",modal:true},{id:"csv",title:"CSV",url:"{{tg.url('/dashboard/to_csv/')}}"}];
if(o.exportable_formats){j.exportable_formats=o.exportable_formats}j.pager_options=n;
j.this_page=0;j.total_count=0;j.total_pag=0;j.ajx_data=JSON.stringify({});j.styles=[];
j.setQuery(j.q);j._new_default={name:"new",url:'{{tg.url("/dashboard/new/")}}',require_id:"false",type:"new"};
j._edit_default={name:"edit",url:'{{tg.url("/dashboard/edit/")}}',require_id:"true",type:"edit"};
j._delete_default={name:"delete",url:'{{tg.url("/dashboard/delete/")}}',require_id:"true",type:"delete"};
j._docs_default={name:"docs",url:'{{tg.url("/docs/")}}',require_id:"true",type:"docs"}
}c.prototype.setQuery=function(j){var h=this;var i=j.split("$$");h.q=i[0];h.filters=[];
if(i.length>1){h.filters=f(i[1])}h.order=[];if(i.length>2){h.order=e(i[2])}if(i.length>3){h.current_user_filter=i[3]
}else{h.current_user_filter=__DEFAULT_FILTER}};c.prototype.getSelectedIds=function(){var h=this;
var i=[];g("#"+h.name+" .sp-grid-row").each(function(){var j=g(this).find(".sp-grid-rowid");
if(j.prop("checked")){i.push(j.attr("id_row")*1)}});return i};c.prototype.getAction=function(o){var m=this;
for(var n=0,j=m.actions.length;n<j;n++){var h=m.actions[n];if(typeof(h.type)==="object"){if(h.type.id===o){return h
}}else{if(h.name===o){return h}}}};c.prototype.getRow=function(j){var h=this;var i=null;
g("#"+h.name+" .sp-grid-row").each(function(){var l=g(this).find(".sp-grid-rowid");
if(l.attr("id_row")===j){i=l.parent();return}});return i};c.prototype.loadData=function(Q){var t=this;
var y=t.cols;if(typeof(y)==="function"){y=y()}var z=23;if(t.hide_check){z=-6}var B=y.length*42;
if(y[0].title!="id"){t.hide_check=true;t.hide_id=true;t.actions_inline=false}if(!t.hide_check){B+=23
}if(!t.hide_id){B+=60}var w=905;if(B<w){B=w}var N="";for(var X=0,U=y.length;X<U;X++){var s=y[X];
if(s.title!="id"){N+='<option value="'+s.title+'">'+s.title+"</option>"}if(t.hide_id&&s.title==="id"){continue
}z+=(s.width+5)}g("#"+t.name+" .sp-grid-filter-field").html(N);var O='<div class="sp-grid" style="width:'+(z+200)+'px">';
var I='<div class="sp-grid-row" style="width:'+(z+150)+'px">';if(!t.hide_check){var M="";
if(!t.allow_multiselect){M="disabled"}I+='<div class="sp-col-title" style="width:23px">                <input class="sp-grid-select-all" type="checkbox" '+M+"></div>"
}if(t.actions_inline){I+='<div class="sp-col-title" style="%(actions_wd)s">*</div>'
}var C={};for(var X=0,U=t.order.length;X<U;X++){var S=t.order[X];S.index=X+1;C[t.order[X].field]=S
}for(var X=0,U=y.length;X<U;X++){var s=y[X];var q=s.width;if(!q){q=t.default_.col_width
}if(t.hide_id&&s.title==="id"){continue}var v="";var F="";var K="";if(C[s.title]){var S=C[s.title];
v="sp-grid-ordered-col";F=' order_type="'+S.type+'"';var H;if(S.type==="asc"){H="+"
}else{H="-"}K=" ("+S.index+H+")"}I+='<div class="sp-col-title sp-col-title-sortable '+v+'"'+F+' col_num="'+X+'" style="width:'+q+'px" col_title="'+s.title+'">'+s.title+K+"</div>"
}I+="</div>";var Z=t.data;if(typeof(Z)==="function"){Z=Z()}var Y=t.getAction("edit")!==undefined,R=t.getAction("delete")!==undefined,E=t.getAction("docs")!==undefined;
var aa="";if(t.actions_inline){var r=107;if(!t.nonstd){r=82}var V=25;var aa='<div class="sp-grid-cell" style="%(actions_wd)s">';
if(Y){aa+='<img class="inline_action edit_inline" title="{{_("Edit")}}"                    src="{{tg.url("/images/sapns/icons/edit.png")}}">'
}else{r-=V;aa+='<img class="inline_action edit_inline" title="{{_("Edit")}}"                    src="{{tg.url("/images/sapns/icons/edit_disabled.png")}}">'
}if(R){aa+='<img class="inline_action delete_inline" title="{{_("Delete")}}"                     src="{{tg.url("/images/sapns/icons/delete.png")}}">'
}else{aa+='<img class="inline_action delete_inline" title="{{_("Delete")}}"                     src="{{tg.url("/images/sapns/icons/delete_disabled.png")}}">'
}if(E){aa+='<img class="inline_action docs_inline" title="{{_("Docs")}}"                     src="{{tg.url("/images/sapns/icons/docs.png")}}">'
}else{aa+='<img class="inline_action docs_inline" title="{{_("Docs")}}"                     src="{{tg.url("/images/sapns/icons/docs_disabled.png")}}">'
}r=sprintf("width:%dpx",r);D+=sprintf(aa,{actions_wd:r})+t.nonstd+"</div>"}var P=Z.length;
if(P>0){for(var X=0;X<P;X++){var x=Z[X];var A="";if(t.styles.length&&t.styles.length>X){A=t.styles[X]
}var D='<div class="sp-grid-row" style="width:'+(z+150)+'px">';if(!t.hide_check){var m="";
if(X===P-1){m="border-radius:0 0 0 5px"}D+='<div class="sp-grid-cell" title="'+x[0]+'" style="width:23px;'+m+'"><input class="sp-grid-rowid" type="checkbox" id_row="'+x[0]+'"></div>'
}if(t.actions_inline){D+=sprintf(aa,{actions_wd:r})+t.nonstd+"</div>"}if(X===0){O+=sprintf(I,{actions_wd:r})
}for(var W=0,G=y.length;W<G;W++){var s=y[W];var u=s.align;if(!u){u=t.default_.col_align
}var q=s.width;if(!q){q=t.default_.col_width}var J=x[W];if(!J){J=t.default_.empty_value
}if(t.hide_id&&s.title=="id"){continue}var h="";if(q>0){h=" width:"+q+"px;"}var m="";
if((t.hide_check&&X==P-1)&&(!t.hide_id&&W==0||t.hide_id&&W==1)){m="border-radius:0 0 0 5px;"
}if(X==P-1&&W==G-1){m="border-radius:0 0 5px 0;"}D+='<div class="sp-grid-cell sp-grid-cell-tip clickable '+A+'"                         col_num="'+W+'" style="text-align:'+u+";"+h+m+'"';
if(J){D+=sprintf('title="%s"',J.replace(/"/gi,"''"))}else{D+='title="({{_("empty")}})"'
}D+=">"+J+"</div>"}D+="</div>";O+=D}}else{var T=1;var L=z;if(t.actions_inline){T=3;
L+=25}O+=sprintf(I,{actions_wd:r})+'<div class="sp-grid-row"><div class="sp-grid-cell sp-grid-noresults" title="{{_("No results")}}" style="width:'+L+'px" >{{_("No results")}}</div></div>'
}O+="</div>";g("#"+t.name).find(".sp-grid-parent").html(O);g(".sp-col-title-sortable").disableSelection();
if(t.select_first&&t.with_search&&t.q&&P<5&&P>0){g("#"+t.name+" .sp-grid-rowid:first").prop("checked",true)
}var p="#"+t.name;g(p+" .sp-col-title-sortable, "+p+" .sp-grid-cell-tip").resizable({handles:"e",minWidth:t.resize.min_width,resize:function(o,n){var j=n.element.width(),ab=n.element.attr("col_num"),l=g(p+" .sp-grid-row").width(),i=g(p+" .sp-grid-cell[col_num="+ab+"]").width();
g(p+" .sp-col-title-sortable[col_num="+ab+"]").width(j);g(p+" .sp-grid-cell[col_num="+ab+"]").width(j);
g(p+" .sp-grid-row").width(l+(j-i))},stop:function(l,j){var n=j.element.attr("col_num");
if(t.resize.after){t.resize.after(n*1)}else{var i=t.cols.length;if(t.cols[0].title==="id"){i-=1
}g.ajax({url:"{{tg.url('/dashboard/save_col_width/')}}",data:{cls:t.cls,length:i,col_num:n,width:j.element.width()},success:function(o){if(o.status){}}})
}}});if(Q){Q()}};c.prototype.query=function(){var h=this;var j=h.q;var i=g.map(h.filters,function(l){if(l.active){return l
}});if(i.length){if(j){j=j+", "+i.join(", ")}else{j=i.join(", ")}}if(h.order.length){if(j){j=j+", "+h.order.join(", ")
}else{j=h.order.join(", ")}}return j};c.prototype.query_=function(){var j=this,n=j.q+"$$";
for(var m=0,h=j.filters.length;m<h;m++){if(m>0){n+=", "}n+=j.filters[m].stringify()
}n+="$$";for(var m=0,h=j.order.length;m<h;m++){if(m>0){n+=", "}n+=j.order[m].stringify()
}if(j.current_user_filter!==__DEFAULT_FILTER){n+="$$"+j.current_user_filter}return n
};c.prototype.search=function(n,m,l){var j=this;if(m===undefined){m=false}if(n===undefined){n=j.q
}if(j.q!=n||m){j.pag_n=1}j.q=n;j.filters_tip();var n=j.query();var o=sprintf('<div class="sp-grid-loading" style="height:%(hg)dpx">{{_("Loading")}}...</div>',{hg:j.height-50});
g("#"+j.name).find(".sp-grid-parent").html(o);var i=g.extend(true,{url:"{{tg.url('/dashboard/grid/')}}",cache:false,data:{cls:j.cls,q:n,rp:j.rp,pag_n:j.pag_n,ch_attr:j.ch_attr,parent_id:j.parent_id},success:function(q){if(q.status){if(q.this_page){j.this_page=q.this_page
}if(q.total_count){j.total_count=q.total_count}if(q.total_pag){j.total_pag=q.total_pag
}if(q.cols){j.cols=q.cols}if(q.actions){j.actions=q.actions}if(q.styles){j.styles=q.styles
}var v=(j.pag_n-1)*j.rp*1;var u={curr_page:j.pag_n*1,total_page:j.total_pag*1,pos0:v+1,pos1:v+j.this_page};
var s=sprintf("{{_('Page %(curr_page)d of %(total_page)d / Showing rows %(pos0)d to %(pos1)d')}}",u);
g("#"+j.name+" .sp-grid-first-page").attr("title","{{_('page 1')}}");if(u.curr_page>1){var p=sprintf("{{_('page %(p)d')}}",{p:u.curr_page-1});
g("#"+j.name+" .sp-grid-page-back").attr("title",p).prop("disabled",false)}else{g("#"+j.name+" .sp-grid-page-back").prop("disabled",true)
}if(u.curr_page<u.total_page){var t=sprintf("{{_('page %(p)d')}}",{p:u.curr_page+1});
g("#"+j.name+" .sp-grid-page-forth").attr("title",t).prop("disabled",false)}else{g("#"+j.name+" .sp-grid-page-forth").prop("disabled",true)
}g("#"+j.name+" .sp-search-txt").focus();var r=sprintf("{{_('page %(p)d')}}",{p:u.total_page});
g("#"+j.name+" .sp-grid-last-page").attr("title",r);g("#"+j.name+" .sp-grid-current-page").val(j.pag_n);
j.data=q.data;j.loadData(function(){g(".sp-grid-cell-tip, .edit_inline, .delete_inline, .docs_inline, .new_inline, .sp-grid-save-filter").qtip({content:{text:true},position:{my:"top left",at:"bottom center"},style:"ui-tooltip-rounded"})
});if(l){l(q)}if(j.onLoad){j.onLoad(q)}}}},j.search_params);var h=JSON.stringify(i.data);
if(j.ajx_data){if(j.ajx_data===h&&!m){j.loadData()}else{g.ajax(i)}}j.ajx_data=h};
c.prototype.warningSelectedId=function(){var h=this;g("#grid-dialog_"+h.name).html("<p style='text-align:center;font-style:italic'>{{_('You must select a row before click on this action')}}</p>").dialog({title:h.caption,resizable:false,height:155,width:450,modal:true,draggable:false,buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+h.name).dialog("close")
}}});g(".ui-icon-closethick").hide()};c.prototype._loadActions=function(m){var w=this;
var u="";w.nonstd="";var q='<button id="%(id)s" class="sp-grid-button-action">%(title)s</button>';
var v='<option value="%(id)s">%(title)s</option>';if(m.length>0){u="";for(var n=0,h=m.length;
n<h;n++){var s=m[n];var o=s.require_id;if(o===undefined){o=true}if(typeof(s.type)==="string"&&s.type==="new"){var r='<img class="inline_action new_inline" title="{{_("New")}}" src="{{tg.url("/images/sapns/icons/new.png")}}">';
g("#"+w.name+" .sp-grid-search-box").append(r)}else{if(!w.actions_inline){g("#"+w.name+" .sp-grid-button-actions").show();
var y;if(typeof(s.type)=="object"){y={id:s.type.id,title:s.title}}else{y={id:s.name,title:s.title}
}g("#"+w.name+" .sp-grid-button-actions").append(sprintf(q,y))}else{if(w.actions_inline){if(typeof(s.type)==="string"&&(s.type=="edit"||s.type=="delete"||s.type=="docs")){continue
}else{var j;if(typeof(s.type)=="object"){j={id:s.type.id,title:s.title}}else{j={id:s.name,title:s.title}
}w.nonstd+=sprintf(v,j)}}}}}if(w.nonstd){w.nonstd='<select class="nonstd_actions"><option value=""></option>'+w.nonstd+"</select>"
}}if(w.exportable){var t=w.exportable_formats;if(typeof(w.exportable)=="object"){t=w.exportable.formats
}var h=t.length;if(h>0){var x="";for(var n=0;n<h;n++){x+='<option value="'+t[n].id+'">'+t[n].title+"</option>"
}var p='<div class="export">                    <select class="sp-button sp-grid-action">                    <option value="">({{_("Export")}})</option>'+x+"</select></div>";
g("#"+w.name+" .sp-grid-search-box").append(p)}}return u};c.prototype.complete_actions=function(){var m=this;
for(var n=0,j=m.actions.length;n<j;n++){var h=m.actions[n];if(typeof(h.type)==="string"){if(h.type==="new"){m.actions[n]=g.extend(m._new_default,h)
}else{if(h.type==="edit"){m.actions[n]=g.extend(m._edit_default,h)}else{if(h.type==="delete"){m.actions[n]=g.extend(m._delete_default,h)
}else{if(h.type==="docs"){m.actions[n]=g.extend(m._docs_default,h)}}}}}}};c.prototype.loadActions=function(j){var r=this;
var o="";var m=sprintf("#%s .actions",r.name);if(r.actions!=null){if(r.actions.length===undefined){var i=g.extend(true,{url:"{{tg.url('/dashboard/grid_actions/')}}",cache:false,data:{cls:r.cls},success:function(A){if(A.status){r.actions=A.actions
}g(m).html(r._loadActions(r.actions));if(j){j()}}},r.actions);g.ajax(i)}else{g(m).html(r._loadActions(r.actions));
if(j){j()}}}else{if(j){j()}}var l=sprintf("#%s .sp-grid-cell.clickable",r.name),s=sprintf("#%s .sp-grid-cell .sp-grid-rowid:checked",r.name);
g(document).off("click",l).on("click",l,function(B){var C=(B.ctrlKey||B.metaKey)&&r.allow_multiselect;
var A=g(this).parent().find(".sp-grid-rowid");if(!A.prop("checked")||C||(r.multiselect&&r.allow_multiselect)){g("#"+r.name+" .sp-grid-select-all").prop("checked",false);
g("#"+r.name+" .sp-grid-rowid").each(function(){if(g(this)!=A&&!r.multiselect&&!C){g(this).prop("checked",false);
g(this).parent().parent().removeClass("sp-grid-row-selected")}});if(A.prop("checked")){A.prop("checked",false);
g(this).parent().removeClass("sp-grid-row-selected")}else{A.prop("checked",true);
g(this).parent().addClass("sp-grid-row-selected")}}else{if(r.dblclick){p(A.attr("id_row")*1,r.dblclick,B.ctrlKey||B.metaKey,B.shiftKey)
}}});var t=sprintf("#%s .sp-grid-cell .sp-grid-rowid",r.name);g(document).off("click",t).on("click",t,function(){var A=g(this).prop("checked");
if(!r.allow_multiselect){g(t).prop("checked",false);g(this).prop("checked",A)}});
function h(D,E){var B=r.query_();B=encodeURI(B).replace("-","%2D","g").replace('"',"%22","g").replace("+","%2B","g").replace("#","%23","g");
var A="";if(E!="_blank"){var A=r.url_base+"?q="+B+"&rp="+r.rp+"&pag_n="+r.pag_n+"&ch_attr="+r.ch_attr+"&parent_id="+r.parent_id
}var C='<form type="post" action="'+D+'" target="'+E+'"><input type="hidden" name="came_from" value="'+A+'">';
if(r.ch_attr){C+='<input type="hidden" name="_'+r.ch_attr+'" value="'+r.parent_id+'">'
}C+="</form>";return C}function w(H,I,S,D,P){if(typeof(S.type)==="string"){if(P&&r.shift_enabled){if(S.type==="new"){S=r._new_default
}else{if(S.type==="edit"){S=r._edit_default}else{if(S.type==="delete"){S=r._delete_default
}else{if(S.type==="docs"){S=r._docs_default}}}}}var V=S.url;if(V[V.length-1]!="/"){V+="/"
}if(!S.data){var W="";if(D){W="_blank"}if(S.type==="process"){if(S.require_id){if(H){V+=H
}else{r.warningSelectedId();return}}else{if(H){V+=H}}}else{if(S.type==="new"){V+=sprintf("%s/",r.cls)
}else{if(S.require_id){if(H){V+=sprintf("%s/%s",r.cls,H)}else{r.warningSelectedId();
return}}else{if(H){V+=sprintf("%s/%s",r.cls,H)}else{V+=sprintf("%s/",r.cls)}}}}g(h(V,W)).appendTo("body").submit().remove()
}else{var X=JSON.parse(S.data),O=false;var T={};T[X.param_name]=H;T[X.param_name+"$"]=JSON.stringify(I);
var C="{{_('Ok')}}";if(X.button_title){C=X.button_title}var A=true;if(X.refresh!==undefined){A=X.refresh
}if(X.extra_params!==undefined){for(ep in X.extra_params){T[ep]=X.extra_params[ep]
}}var G=r.name+"_dialog";g("#"+G).remove();var R=g('<div id="'+G+'" style="display:none"></div>').appendTo("body");
var N=[];if(X.buttons===undefined){X.buttons=[{button_title:C,callback:X.callback,refresh:A}]
}var E=function(F){var Y=this;Y.b=F;Y.call=function(){if(!O){O=true;window[Y.b.callback](function(){if(Y.b.refresh){r.search(r.q,true)
}R.dialog("close")},function(){O=false})}}};for(var L=0,J=X.buttons.length;L<J;L++){var U=X.buttons[L],Q=new E(U);
N.push({text:U.button_title,click:Q.call})}N.push({text:"{{_('Cancel')}}",click:function(){if(!O){R.dialog("close")
}}});var B,M={title:S.title,modal:true,resizable:false,width:X.width||"auto",height:X.height||"auto",closeOnEscape:false,buttons:N};
if(X.json_load){B=function(F){if(F.status){R.html(F.content).dialog(M)}else{alert("Error!")
}}}else{B=function(F){R.html(F).dialog(M)}}g.ajax({url:V,data:T,success:B,error:function(){alert("Error!")
}})}}else{var K=I;if(S.require_id){if(K.length>0){S.type.f(K[0],K)}else{r.warningSelectedId();
return}}else{if(K.length>0){S.type.f(K[0],K)}else{S.type.f()}}}}function p(D,F,E,B){var A=r.getAction(F);
if(A!==undefined){if(typeof(D)!=="number"){var G=D.parent().parent().find(".sp-grid-rowid").attr("id_row")*1
}else{var G=D}var C=r.getSelectedIds();if(C.length==0){C=[G]}w(G,C,A,E,B)}}var q=sprintf("#%s .new_inline",r.name);
g(document).off("click",q).on("click",q,function(A){p(g(this),"new",A.ctrlKey||A.metaKey,A.shiftKey)
});if(r.actions_inline){var v=sprintf("#%s .edit_inline",r.name);g(document).off("click",v).on("click",v,function(A){p(g(this),"edit",A.ctrlKey||A.metaKey,A.shiftKey)
});var z=sprintf("#%s .delete_inline",r.name);g(document).off("click",z).on("click",z,function(A){p(g(this),"delete",false,false)
});var y=sprintf("#%s .docs_inline",r.name);g(document).off("click",y).on("click",y,function(A){p(g(this),"docs",false,A.shiftKey)
});var n=sprintf("#%s .nonstd_actions",r.name);g(document).off("change",n).on("change",n,function(B){var A=g(this).val();
if(A){p(g(this),A);g(n).val("")}})}else{var x=sprintf("#%s .sp-grid-button-action",r.name);
g(document).off("click",x).on("click",x,function(B){var A=r.getAction(g(this).attr("id"));
var C=r.getSelectedIds();w(C[0],C,A,B.ctrlKey||B.metaKey,B.shiftKey)})}var u=sprintf("#%s .export select",r.name);
g(document).on("change",u,function(){var B=g(u).val();if(B==""){return}var G=r.exportable_formats;
var E="";if(typeof(r.exportable)==="object"){G=r.exportable.formats;if(r.exportable.data){for(k in r.exportable.data){var I=r.exportable.data[k];
if(typeof(I)==="function"){I=I()}E+='<input type="hidden" name="'+k+'" value="'+I+'">'
}}}var A="",K;for(var F=0,C=G.length;F<C;F++){if(G[F].id==B){K=G[F];break}}if(K.modal){g(this).find("option:first").prop("selected",true);
var D=g.extend({cls:r.cls,q:r.query(),ch_attr:r.ch_attr,parent_id:r.parent_id,export_url:K.export_url,},K.data||{});
var E={};for(ep in K.data){var H=K.data[ep];if(typeof(H)==="function"){H=H()}E[ep]=H
}D.extra_params=JSON.stringify(E);g.ajax({url:K.url,data:D,success:function(M){var L=false;
if(M.status){g("#sp-grid-export-dialog").remove();g('<div id="sp-grid-export-dialog" style="display:none"></div>').appendTo("body");
g("#sp-grid-export-dialog").html(M.content).dialog({title:K.title,modal:true,resizable:false,width:K.width||700,height:K.height||"auto",buttons:{"{{_('Export')}}":function(){if(!L){L=true;
window[K.func_name](function(){L=false},function(){L=false})}},"{{_('Close')}}":function(){if(!L){g("#sp-grid-export-dialog").dialog("close")
}}}})}}})}else{var J='<form action="'+K.url+'" method="get">                    <input type="hidden" name="cls" value="'+r.cls+'">                    <input type="hidden" name="q" value="'+r.query()+'">                    <input type="hidden" name="ch_attr" value="'+r.ch_attr+'">                    <input type="hidden" name="parent_id" value="'+r.parent_id+'">'+E+"</form>";
g(J).appendTo("body").submit().remove();g(this).find("option:first").prop("selected",true)
}})};c.prototype.selectAll=function(h){var i=this;if(h===undefined){h=true}g("#"+i.name+" .sp-grid-rowid").prop("checked",h)
};c.prototype.filters_tip=function(){var h=this;g("#"+h.name+" .sp-search-btn").qtip({content:{text:function(){var n="";
if(h.filters.length){for(var m=0,j=h.filters.length;m<j;m++){if(!h.filters[m].active){n+='<font style="text-decoration:line-through">'+h.filters[m].tip()+"</font><br>"
}else{n+=h.filters[m].tip()+"<br>"}}}else{n="{{_('There are not filters')}}"}return n
}},position:{at:"top right",my:"bottom left"},style:"ui-tooltip-rounded"});if(h.filters.length){g("#"+h.name+" .sp-search-btn").css("border-color","orange")
}else{g("#"+h.name+" .sp-search-btn").css("border-color","")}};g.fn.sapnsGrid=function(B,z,x){if(typeof(B)==="object"){var N=new c(B);
this.data("sapnsGrid",N);var y="#"+N.name;this.append(sprintf('<div id="grid-dialog_%(name)s" class="sp-grid-dialog" style="display:none"></div>',{name:N.name}));
var I="";I+=sprintf('<div class="sp-grid-container" id="%(name)s" cls="%(cls)s">',{name:N.name,cls:N.cls});
if(N.caption){I+=sprintf('<div class="sp-grid-caption">%(caption)s</div>',{caption:N.caption})
}if(N.with_search){I+='<div><div class="sp-grid-search-box">                    <input class="sp-search-txt" name="q" type="text" value="">                    <img class="inline_action sp-search-btn"                         src="{{tg.url("/images/sapns/icons/search.png")}}" title="{{_("Search...")}}">';
if(N.with_filters){var m="";for(var K=0,H=N.user_filters.length;K<H;K++){var O=N.user_filters[K],E="";
if(N.current_user_filter==O.name){E=" selected"}m+='<option value="'+O.name+'"'+E+">"+O.name+"</option>"
}I+='<img class="inline_action sp-grid-save-filter"                             src="{{tg.url("/images/sapns/icons/filters.png")}}" title="{{_("Manage filter")}}">                        <select class="sp-grid-action sp-button sp-grid-select-filter">'+m+"</select>"
}I+="</div>";I+='<div class="sp-grid-filters" style="display:none"></div>';I+='<div class="sp-grid-edit-filter" style="display:none">                    <div style="float:left;height:40px;margin-right:5px">                        <div class="sp-grid-filter-label">{{_("Field")}}</div>                        <div><select class="sp-grid-filter-field"></select></div>                    </div>                    <div style="float:left;height:40px;margin-right:5px">                        <div class="sp-grid-filter-label">{{_("Operator")}}</div>                        <div><select class="sp-grid-filter-operator">                            <option value="co">{{_("Contains")}}</option>                            <option value="eq">{{_("Equals to")}}</option>                            <option value="lt">{{_("Less than")}}</option>                            <option value="gt">{{_("Greater than")}}</option>                            <option value="let">{{_("Less than or equals to")}}</option>                            <option value="get">{{_("Greater than or equals to")}}</option>                            <option value="nco">{{_("Does not contain")}}</option>                            <option value="neq">{{_("Not equals to")}}</option>                        </select></div>                    </div>                    <div style="float:left;height:40px">                        <div class="sp-grid-filter-label">{{_("Value")}}</div>                        <input class="sp-grid-filter-value" type="text">                        <select class="sp-grid-filter-functions">                            <option value="">({{_("date functions")}})</option>                            <option value="{today}">{{_("Today")}}</option>                            <option value="{today - 1}">{{_("Yesterday")}}</option>                            <option value="{today + 1}">{{_("Tomorrow")}}</option>                            <option value="{start_week}">{{_("Week start")}}</option>                            <option value="{end_week}">{{_("Week end")}}</option>                            <option value="{start_month}">{{_("Month start")}}</option>                            <option value="{end_month}">{{_("Month end")}}</option>                            <option value="{start_month - 1m}">{{_("Previous month start")}}</option>                            <option value="{end_month - 1m}">{{_("Previous month end")}}</option>                            <option value="{start_month + 1m}">{{_("Next month start")}}</option>                            <option value="{end_month + 1m}">{{_("Next month end")}}</option>                            <option value="{start_year}">{{_("Year start")}}</option>                            <option value="{end_year}">{{_("Year end")}}</option>                            <option value="{start_year - 1y}">{{_("Previous year start")}}</option>                            <option value="{end_year - 1y}">{{_("Previous year end")}}</option>                            <option value="{start_year + 1y}">{{_("Next year start")}}</option>                            <option value="{end_year + 1y}">{{_("Next year end")}}</option>                        </select>                    </div></div>';
var s=".sp-grid-activate-filter, .sp-grid-deactivate-filter";var j=".sp-grid-filter-value";
g(document).off("keypress",j).on("keypress",j,function(i){if(i.which===13){g(this).parents(".ui-dialog").find(".ui-dialog-buttonset button:first").click()
}});var j=".sp-grid-filter-functions";g(document).off("change",j).on("change",j,function(){var i=g(this).val();
g(this).parent().find(".sp-grid-filter-value").val(i)});var j=".sp-grid-row-filter button";
g(document).off("click",j).on("click",j,function(){var l=g(this).parent().attr("filter_order");
var q=N.filters[l];if(q.active){g(this).parent().removeClass("active").addClass("inactive");
g(this).text("{{_('Activate')}}")}else{g(this).parent().removeClass("inactive").addClass("active");
g(this).text("{{_('Deactivate')}}")}g(this).addClass("sp-grid-filter-changed");q.toggle()
});var P=y+" .sp-search-btn";g(document).off("click",P).on("click",P,function(){function l(){var U="",q=N.filters.length;
if(q){for(var S=0;S<q;S++){var V=N.filters[S];var R="",T="active";if(V.active){R='<button>{{_("Deactivate")}}</button>'
}else{T="inactive";R='<button>{{_("Activate")}}</button>'}U+='<div class="sp-grid-row-filter '+T+'" style="clear:left" filter_order="'+S+'">                                    <div style="float:left;margin-right:10px"><input class="sp-grid-check-filter" type="checkbox"></div>                                    <div class="sp-grid-filter-description"><span class="col">&lt;'+V.field+'&gt;</span>                                     <span class="operator">'+V.operator_title().toLowerCase()+'</span>                                    <span class="value">"'+V.value+'"</span></div>'+R+"</div>"
}}else{U='<p class="sp-grid-no-filters">{{_("There are not filters")}}</p>'}g(y+" .sp-grid-filters").html(U)
}l();function i(q,R){g("<div/>").html(g(y+" .sp-grid-edit-filter").html()).dialog({title:"{{_('Edit filter')}}",modal:true,resizable:false,width:700,height:"auto",open:function(){if(q){g(this).find(".sp-grid-filter-field").val(q.field);
g(this).find(".sp-grid-filter-operator").val(q.operator);g(this).find(".sp-grid-filter-value").val(q.value)
}},buttons:{"{{_('Ok')}}":function(){var S=this;if(!q){q=new b({field:g(this).find(".sp-grid-filter-field").val(),operator:g(this).find(".sp-grid-filter-operator").val(),value:g(this).find(".sp-grid-filter-value").val()});
N.filters.push(q)}else{q.field=g(this).find(".sp-grid-filter-field").val();q.operator=g(this).find(".sp-grid-filter-operator").val();
q.value=g(this).find(".sp-grid-filter-value").val()}N.search(g(y+" .sp-search-txt").val(),true);
g(this).dialog("destroy").remove();if(R){R()}},"{{_('Cancel')}}":function(){g(this).dialog("destroy").remove()
}}})}g("<div/>").html(g(y+" .sp-grid-filters").html()).dialog({title:"Filtros",modal:true,resizable:false,width:600,height:300,closeOnEscape:false,open:function(){var q=g(this);
i(null,function(){q.dialog("destroy").remove()})},buttons:{"{{_('Add')}}":function(){var q=g(this);
i(null,function(){q.dialog("destroy").remove()})},"{{_('Edit')}}":function(){var q=g(this).find(".sp-grid-row-filter input[type=checkbox]:visible:checked:first").parent().parent().attr("filter_order");
var R=g(this);i(N.filters[q],function(){R.dialog("destroy").remove()});N.search(g(y+" .sp-search-txt").val(),true)
},"{{_('Remove')}}":function(){var S=[];g(this).find(".sp-grid-row-filter input[type=checkbox]:visible:checked").each(function(){S.push(g(this).parent().parent().attr("filter_order")*1)
});S=S.reverse();for(var R=0,q=S.length;R<q;R++){N.filters.splice(S[R],1)}N.search(g(y+" .sp-search-txt").val(),true);
g(this).dialog("destroy").remove()},"{{_('Remove all')}}":function(){N.filters=[];
N.search(g(y+" .sp-search-txt").val(),true);g(this).dialog("destroy").remove()},"{{_('Close')}}":function(){if(g(".sp-grid-filter-changed").length){g(".sp-grid-filter-changed").removeClass("sp-grid-filter-changed");
N.search(g(y+" .sp-search-txt").val(),true)}g(this).dialog("destroy").remove()}}})
});var F=y+" .sp-search-txt";g(document).off("keypress",F).on("keypress",F,function(i){if(i.which===13){N.search(g(this).val())
}});var n=y+" .sp-grid-select-filter";g(document).off("change",n).on("change",n,function(){var U=g(this).val(),T="";
for(var R=0,q=N.user_filters.length;R<q;R++){var S=N.user_filters[R];if(S.name===U){N.setQuery((N.q||"")+S.query);
N.current_user_filter=U;N.search(N.query_().split("$$")[0],true);return}}});var J=y+" .sp-grid-save-filter";
g(document).off("click",J).on("click",J,function(){var q=N.query_(),l=g(n).val(),i=false,R='<div id="sp-grid-save-filter-dialog" style="display:none">                            <div class="sp-field-row">                                <div class="sp-field">                                    <div class="label">{{_("Filter name")}}</div>                                    <input class="sp-grid-filter-name" grid-id="'+y+'" type="text" value="'+l+'">                                </div>                            </div>                        </div>';
g("#sp-grid-save-filter-dialog").remove();g(R).appendTo("body").dialog({title:"{{_('Save filter')}}",modal:true,resizable:false,width:400,height:"auto",buttons:{"{{_('Create or Modify')}}":function(){if(!i){i=true;
var S=g(".sp-grid-filter-name[grid-id="+y+"]").val().replace(/(á|ä|à|â)/g,"a").replace(/(Á|Ä|À|Â)/g,"A").replace(/(é|ë|è|ê)/g,"e").replace(/(É|Ë|È|Ê)/g,"E").replace(/(í|ï|ì|î)/g,"i").replace(/(Í|Ï|Ì|Î)/g,"I").replace(/(ó|ö|ò|ô)/g,"o").replace(/(Ó|Ö|Ò|Ô)/g,"O").replace(/(ú|ü|ù|û)/g,"u").replace(/(Ú|Ü|Ù|Û)/g,"U").replace(/ñ/g,"n").replace(/Ñ/g,"N").replace(/[^A-Za-z0-9_]/g,"_");
g.ajax({url:"{{tg.url('/dashboard/save_user_filter/')}}",data:{cls:N.cls,filter_name:S,query:q},success:function(V){if(V.status){var W=false;
for(var U=0,T=N.user_filters.length;U<T;U++){var X=N.user_filters[U];if(X.name===S){X.query=q;
W=true}}if(!W){N.user_filters.push({name:S,query:q});g(n).append('<option value="'+S+'">'+S+"</option>");
g(n).val(S)}g("#sp-grid-save-filter-dialog").dialog("close")}else{if(V.msg){}i=false;
alert("Error!")}},error:function(){i=false;alert("Error!")}})}},"{{_('Delete')}}":function(){if(!i){var S=g(".sp-grid-filter-name[grid-id="+y+"]").val();
i=true;g.ajax({url:"{{tg.url('/dashboard/delete_user_filter/')}}",data:{cls:N.cls,filter_name:S},success:function(W){if(W.status){g(n).val("default").change();
g(n+" option[value="+S+"]").remove();var V=[];for(var U=0,T=N.user_filters.length;
U<T;U++){var X=N.user_filters[U];if(X.name!==S){V.push(X)}}N.user_filters=V;g("#sp-grid-save-filter-dialog").dialog("close")
}else{i=false;alert("Error!")}},error:function(){i=false;alert("Error!")}})}},"{{_('Cancel')}}":function(){if(!i){g("#sp-grid-save-filter-dialog").dialog("close")
}}}})});I+="</div>"}var Q=".sp-grid-filter-name[grid-id="+y+"]";g(document).off("keypress",Q).on("keypress",Q,function(i){if(i.which===13){g(this).parents(".ui-dialog").find(".ui-dialog-buttonset button:first").click()
}});var M='<div class="sp-grid-parent" style="overflow:auto;clear:left;height:'+(N.height+5)+'px;background-color:transparent"></div>';
var v="";if(N.with_pager){v+='<div class="sp-grid-pager">                    <div class="sp-grid-pager-desc"></div>';
var G="";for(var K=0,H=N.pager_options.length;K<H;K++){var A=N.pager_options[K];var E="";
if(A.sel){E=" selected "}G+='<option value="'+A.val+'"'+E+">"+A.desc+"</option>"}v+='<div style="float:left;clear:right;height:25px;margin-top:2px"><select class="sp-button sp-grid-rp">'+G+'</select><button class="sp-button sp-grid-first-page" style="float:left">|&lt;&lt;</button><button class="sp-button sp-grid-page-back" style="float:left">&lt;&lt;</button><input class="sp-grid-current-page" type="text" style="text-align:center;font-size:11px;margin-top:3px" readonly><button class="sp-button sp-grid-page-forth" style="float:left">&gt;&gt</button>';
v+="</div>";var t=sprintf("%s .sp-grid-rp",y),r=sprintf("%s .sp-grid-first-page",y),p=sprintf("%s .sp-grid-page-back",y),o=sprintf("%s .sp-grid-page-forth",y),h=sprintf("%s .sp-grid-last-page",y);
g(document).off("change",t).on("change",t,function(){N.rp=g(this).val();N.pag_n=1;
N.search(N.q)});g(document).off("click",r).on("click",r,function(){N.pag_n=1;N.search(N.q)
});g(document).off("click",p).on("click",p,function(){if(N.pag_n>1){N.pag_n-=1;N.search(N.q)
}});g(document).off("click",o).on("click",o,function(){if(N.pag_n<N.total_pag){N.pag_n*=1;
N.pag_n+=1;N.search(N.q)}});g(document).off("click",h).on("click",h,function(){N.pag_n=N.total_pag;
N.search(N.q)})}var w=sprintf("%s .sp-grid-select-all",y);g(document).off("click",w).on("click",w,function(){var i=g(this).prop("checked");
N.selectAll(i)});var L=y+" .sp-col-title-sortable";g(document).off("click",L).on("click",L,function(U){var W=g(this).attr("col_title");
var R=U.shiftKey;var V=U.ctrlKey||U.metaKey;if(g(this).hasClass("sp-grid-ordered-col")){var T;
if(g(this).attr("order_type")=="asc"){T="desc"}else{T="asc"}if(R){for(var S=0,q=N.order.length;
S<q;S++){if(N.order[S].field===W){break}}N.order[S].type=T}else{if(!V){if(N.order.length>1){T="asc"
}var X=new d({field:W,type:T});N.order=[X]}else{for(var S=0,q=N.order.length;S<q;
S++){if(N.order[S].field===W){break}}N.order.splice(S,1);g(this).removeClass("sp-grid-ordered-col")
}}}else{var X=new d({field:W,type:"asc"});if(R){N.order.push(X)}else{N.order=[X]}}N.search(undefined,true)
});var u='<div class="sp-grid-button-actions" style="display:none"></div>';this.append(I+u+M+v+"</div>");
N.loadActions(function(){g(y+" .sp-search-txt").val(N.q);N.search(N.q)})}else{if(typeof(B)=="string"){var D=this.data("sapnsGrid");
var y="#"+D.name;if(B=="loadData"){D.loadData()}else{if(B=="search"){var C="";if(typeof(z)=="boolean"){C=D.q
}else{if(z){C=z}}if(D.with_search){g(y+" .sp-search-txt").val(C)}D.search(C,true,x)
}else{if(B=="getSelectedIds"){return D.getSelectedIds()}else{if(B=="setRp"){D.rp=z;
g(y+" .sp-grid-rp [value="+z+"]").prop("selected",true)}else{if(B=="selectAll"){D.selectAll()
}else{if(B==="getQuery"){return D.query_()}else{if(B==="setQuery"){D.setQuery(z)}}}}}}}}}return this
}})(jQuery);