function load_script(src){var fileref=document.createElement("script");fileref.setAttribute("type","text/javascript");
fileref.setAttribute("src",src);document.getElementsByTagName("head")[0].appendChild(fileref)
}function load_css(href){var fileref=document.createElement("link");fileref.setAttribute("rel","stylesheet");
fileref.setAttribute("type","text/css");fileref.setAttribute("href",href)}try{sprintf
}catch(e){load_script("{{tg.url('/js/sprintf.min.js')}}")}(function($){function SapnsGrid(settings){function set(this_object,key,value,obj){if(obj==undefined){obj=settings
}if(obj[key]==undefined){this_object[key]=value}else{this_object[key]=obj[key]}return
}set(this,"caption","");if(typeof(this.caption)=="function"){this.caption=this.caption()
}set(this,"name","grid_"+Math.floor(Math.random()*999999));set(this,"cls","");set(this,"with_search",true);
set(this,"search_params",{});set(this,"show_ids",false);set(this,"link","");set(this,"q","");
set(this,"ch_attr","");set(this,"parent_id","");set(this,"cols",[]);set(this,"data",{});
set(this,"height",500);set(this,"url_base","");set(this,"multiselect",false);set(this,"default_",{});
set(this.default_,"col_width",60,this.default_);set(this.default_,"col_align","center",this.default_);
set(this.default_,"empty_value","",this.default_);set(this,"actions",null);if(typeof(this.actions)=="function"){this.actions=this.actions()
}set(this,"exportable",true);set(this,"with_pager",true);set(this,"pag_n",1);set(this,"rp",10);
set(this,"this_page",0);set(this,"total_count",0);set(this,"total_pag",0);this.ajx_data="{}"
}SapnsGrid.prototype.getSelectedIds=function(){var self=this;var selected_ids=[];
$("#"+self.name+" .sp-grid-row").each(function(){var rowid=$(this).find(".sp-grid-rowid");
if(rowid.attr("checked")==true){selected_ids.push(rowid.attr("id_row")*1)}});return selected_ids
};SapnsGrid.prototype.getRow=function(id){var self=this;var row=null;$("#"+self.name+" .sp-grid-row").each(function(){var rowid=$(this).find(".sp-grid-rowid");
if(rowid.attr("id_row")==id){row=rowid.parent();return}});return row};SapnsGrid.prototype.loadData=function(){var self=this;
var g_table='<table class="sp-grid"><tr><td class="sp-col-title">#</td>';var cols=self.cols;
if(typeof(cols)=="function"){cols=cols()}for(var i=0,l=cols.length;i<l;i++){var col=cols[i];
var wd=col.width;if(!wd){wd=self.default_.col_width}g_table+='<td class="sp-col-title" style="width: '+wd+'px;">'+col.title+"</td>"
}g_table+="</tr>";var data=self.data;if(typeof(data)=="function"){data=data()}var ld=data.length;
if(ld>0){for(var i=0;i<ld;i++){var row=data[i];g_table+='<tr class="sp-grid-row"><td title="'+(i+1)+'"><input class="sp-grid-rowid" type="checkbox" id_row="'+row[0]+'"></td>';
for(var j=0,lr=cols.length;j<lr;j++){var col=cols[j];var al=col.align;if(!al){al=self.default_.col_align
}var wd=col.width;if(!wd){wd=self.default_.col_width}var cell=row[j];if(!cell){cell=self.default_.empty_value
}g_table+='<td class="sp-grid-cell" style="text-align: '+al+"; width: "+wd+'px;"';
if(cell){g_table+='title="'+cell+'"'}else{g_table+='title="({{_("empty")}})"'}g_table+='clickable="true">';
if(cell.length>30){g_table+=(cell+"").substr(0,30)+"..."}else{g_table+=cell}g_table+="</td>"
}g_table+="</tr>"}}else{g_table+='<tr class="sp-grid-row" style="width: 100%;"><td class="sp-grid-cell sp-grid-noresults" colspan="'+(cols.length+1)+'">{{_("No results")}}</td></tr>'
}$("#"+self.name).find(".sp-grid-parent").html(g_table)};SapnsGrid.prototype.search=function(q,force){var self=this;
if(force==undefined){force=false}if(q==undefined){q=self.q}if(self.q!=q||force){self.pag_n=1
}self.q=q;var loading='<div style="padding: 10px; font-size: 15px; font-weight: bold; color: gray;">{{_("Loading")}}...</div>';
$("#"+self.name).find(".sp-grid-parent").html(loading);var ajx=$.extend(true,{url:"{{tg.url('/dashboard/grid/')}}",data:{cls:self.cls,q:self.q,rp:self.rp,pag_n:self.pag_n,ch_attr:self.ch_attr,parent_id:self.parent_id},success:function(response){if(response.status){if(response.this_page){self.this_page=response.this_page
}if(response.total_count){self.total_count=response.total_count}if(response.total_pag){self.total_pag=response.total_pag
}if(response.cols){self.cols=response.cols}if(response.actions){self.actions=response.actions
}var pos=(self.pag_n-1)*self.rp*1;var params={curr_page:self.pag_n*1,total_page:self.total_pag*1,pos0:pos+1,pos1:pos+self.this_page};
var pag_desc=sprintf("{{_('Page %(curr_page)d of %(total_page)d / Showing rows %(pos0)d to %(pos1)d')}}",params);
$("#"+self.name+" .first-page").attr("title","{{_('page 1')}}");if(params.curr_page>1){var prev_page=sprintf("{{_('page %(p)d')}}",{p:params.curr_page-1});
$("#"+self.name+" .page-back").attr("title",prev_page).attr("disabled",false)}else{$("#"+self.name+" .page-back").attr("disabled",true)
}if(params.curr_page<params.total_page){var next_page=sprintf("{{_('page %(p)d')}}",{p:params.curr_page+1});
$("#"+self.name+" .page-forth").attr("title",next_page).attr("disabled",false)}else{$("#"+self.name+" .page-forth").attr("disabled",true)
}var last_page=sprintf("{{_('page %(p)d')}}",{p:params.total_page});$("#"+self.name+" .last-page").attr("title",last_page);
$("#"+self.name+" .sp-grid-pager-desc").html(pag_desc);$("#"+self.name+" .sp-grid-current-page").val(self.pag_n);
try{$(".sp-grid-cell").qtip({content:{text:true},position:{my:"left top",at:"bottom center"},style:"ui-tooltip-dark ui-tooltip-rounded"})
}catch(e){}self.data=response.data;self.loadData()}}},self.search_params);var curr_ajx_data=JSON.stringify(ajx.data);
if(self.ajx_data){if(self.ajx_data===curr_ajx_data&&!force){self.loadData()}else{$.ajax(ajx)
}}self.ajx_data=curr_ajx_data};SapnsGrid.prototype.warningSelectedId=function(){var self=this;
$("#grid-dialog_"+self.name).html("<p style='text-align: center; font-style: italic;'>{{_('You must select a row before click on this action')}}</p>").dialog({title:self.caption,resizable:false,height:155,width:450,modal:true,draggable:false,buttons:{"{{_('Close')}}":function(){$("#grid-dialog_"+self.name).dialog("close")
}}});$(".ui-icon-closethick").hide()};SapnsGrid.prototype._loadActions=function(actions){var self=this;
var g_actions="";if(actions.length>0){g_actions+='<div class="sp-grid-actions-title">{{_("Actions")}}:</div>';
for(var i=0,l=actions.length;i<l;i++){var act=actions[i];var req_id=act.require_id;
if(req_id===undefined){req_id=true}if(typeof(act.type)==="string"){g_actions+='<div style="float: left;">';
g_actions+='<button class="sp-button sp-grid-action standard_action"  title="'+act.url+'" url="'+act.url+'" action-type="'+act.type+'" require_id="'+req_id+'" >'+act.title+"</button></div>"
}else{g_actions+='<div style="float: left;"><button id="'+act.type.id+'" class="sp-button sp-grid-action"  require_id="'+req_id+'" >'+act.title+"</button></div>"
}}}if(self.exportable){g_actions+='<div id="grid-export_'+self.name+'" style="background-color: none; height: 25px; margin-left: 0px;"><select id="select-export" class="sp-button sp-grid-action" style="height: 20px;"><option value="">({{_("Export")}})</option><option value="csv">CSV</option><option value="excel">Excel</option></select></div>'
}else{g_actions+='<div id="grid-export_'+self.name+'" style="background-color: none; height: 25px; margin-left: 0px;"></div>'
}return g_actions};SapnsGrid.prototype.loadActions=function(){var self=this;var g_actions="";
if(self.actions!=null){if(self.actions.length===undefined){var ajx=$.extend(true,{url:"{{tg.url('/dashboard/grid_actions/')}}",type:"post",data:{cls:self.cls},success:function(response){if(response.status){self.actions=response.actions
}$("#"+self.name+" .actions").html(self._loadActions(self.actions))}},self.actions);
$.ajax(ajx)}else{$("#"+self.name+" .actions").html(self._loadActions(self.actions));
for(var i=0,l=self.actions.length;i<l;i++){var act=self.actions[i];if(typeof(act.type)=="object"){$("#"+act.type.id).data("_func",act.type.f);
$("#"+act.type.id).live("click",function(){if($(this).attr("require_id")=="true"){var selected_ids=self.getSelectedIds();
if(selected_ids.length>0){$(this).data("_func")(selected_ids[0],selected_ids)}else{self.warningSelectedId()
}}else{var selected_ids=self.getSelectedIds();if(selected_ids.length>0){$(this).data("_func")(selected_ids[0],selected_ids)
}else{$(this).data("_func")()}}})}}}}$("#"+self.name+" .sp-grid-cell").live("click",function(event){if($(this).attr("clickable")=="true"){var row_id=$(this).parent().find(".sp-grid-rowid");
$("#"+self.name+" .sp-grid-rowid").each(function(){if($(this)!=row_id&&!self.multiselect&&!event.ctrlKey){$(this).attr("checked",false)
}});if(row_id.attr("checked")==true){row_id.attr("checked",false)}else{row_id.attr("checked",true)
}}});$("#"+self.name+" .standard_action").live("click",function(event){function form(action,target){var came_from="";
if(target!="_blank"){var came_from=self.url_base+"?q="+encodeURI(self.q).replace("-","%2D","g").replace('"',"%22","g").replace("+","%2B","g").replace("#","%23","g")+"&rp="+self.rp+"&pag_n="+self.pag_n+"&ch_attr="+self.ch_attr+"&parent_id="+self.parent_id
}var f='<form type="post" action="'+action+'" target="'+target+'"><input type="hidden" name="came_from" value="'+came_from+'">';
if(self.ch_attr){f+='<input type="hidden" name="_'+self.ch_attr+'" value="'+self.parent_id+'">'
}f+="</form>";return f}var ch_attr=self.ch_attr;var target="";if(event.ctrlKey){target="_blank"
}var url=$(this).attr("url");var action_type=$(this).attr("action-type");var _func=$(this).attr("_func");
if(!_func){var a=$(this).attr("url");if(a[a.length-1]!="/"){a+="/"}var selected_ids=self.getSelectedIds();
if($(this).attr("require_id")=="true"){if(selected_ids.length>0){if(action_type=="delete"){self.std_delete(selected_ids,url)
}else{if(action_type=="process"){if(selected_ids.length==1){a+=selected_ids[0];$(form(a,target)).appendTo("body").submit().remove()
}else{var a0=a;for(var i=0,l=selected_ids.length;i<l;i++){$(form(a0+selected_ids[i],"_blank")).appendTo("body").submit().remove()
}}}else{if(selected_ids.length==1){a+=sprintf("%s/%s",self.cls,selected_ids[0]+"");
$(form(a,target)).appendTo("body").submit().remove()}else{a+=sprintf("%s/",self.cls);
var a0=a;for(var i=0,l=selected_ids.length;i<l;i++){$(form(a0+selected_ids[i],"_blank")).appendTo("body").submit().remove()
}}}}}else{self.warningSelectedId()}}else{if(action_type=="new"){a+=sprintf("%s/",self.cls);
$(form(a,target)).appendTo("body").submit().remove()}else{if(action_type=="process"){if(selected_ids.length==1){a+=sprintf("%s/",selected_ids[0]+"");
$(form(a,target)).appendTo("body").submit().remove()}else{if(selected_ids.length>1){var a0=a;
for(var i=0,l=selected_ids.length;i<l;i++){$(form(a0+selected_ids[i],"_blank")).appendTo("body").submit().remove()
}}else{$(form(a,target)).appendTo("body").submit().remove()}}}}}}else{_func()}});
$("#grid-export_"+self.name).live("change",function(){var fmt=$("#grid-export_"+self.name+" option:selected").val();
if(fmt==""){return}if(fmt=="csv"){var url="/dashboard/tocsv"}else{if(fmt=="excel"){var url="/dashboard/toxls"
}}var form_html='<form action="'+url+'" method="get" ><input type="hidden" name="cls" value="'+self.cls+'"><input type="hidden" name="q" value="'+self.q+'"><input type="hidden" name="ch_attr" value="'+self.ch_attr+'"><input type="hidden" name="parent_id" value="'+self.parent_id+'"></form>';
$(form_html).appendTo("body").submit().remove();$(this).find("option:first").attr("selected",true)
})};SapnsGrid.prototype.std_delete=function(ids,url){var self=this;var cls=self.cls;
var id=ids[0];var delete_html="<p id='delete-question'>{{_('Do you really want to delete this record?')}}</p><p id='object-title'></p>";
var error_html="<p id='delete-error-title'>{{_('Oops, something went wrong...')}}</p><div id='delete-error-message'></div>";
$("#grid-dialog_"+self.name).html(delete_html);var title="";$.ajax({url:"/dashboard/title",type:"get",dataType:"json",data:{cls:cls,id:id,},success:function(res){if(res.status){$("#grid-dialog_"+self.name+" #object-title").html(res.title)
}},error:function(){}});$("#grid-dialog_"+self.name).dialog({width:650,height:210,resizable:false,modal:true,title:"{{_('Delete')}}",buttons:{"{{_('Ok')}}":function(){$.ajax({url:url,type:"get",dataType:"json",data:{cls:cls,id_:id,},success:function(res){if(res.status){self.search(self.q,true);
$("#grid-dialog_"+self.name).dialog("close")}else{$("#grid-dialog_"+self.name).dialog("close");
var message="<p style='color: gray;'>"+res.message+"</p>";if(res.rel_tables!=undefined&&res.rel_tables.length>0){message+="<div>{{_('For your information this object is related with other objects in the following classes:')}}</div>";
message+="<ul>";for(var i=0;i<res.rel_tables.length;i++){var title=res.rel_tables[i].class_title;
var attr_title=res.rel_tables[i].attr_title;message+='<li><span style="font-weight: bold;">'+title+'</span> (<span style="color: gray;">'+attr_title+"</span>)</li>"
}message+="</ul>"}$("#grid-dialog_"+self.name).html(error_html).find("#delete-error-message").html(message);
$("#grid-dialog_"+self.name).dialog({width:700,height:250,buttons:{"{{_('Close')}}":function(){$("#grid-dialog_"+self.name).dialog("close")
}}})}},error:function(){$("#grid-dialog_"+self.name).dialog("close");$("#grid-dialog_"+self.name).html(error_html).dialog({buttons:{"{{_('Close')}}":function(){$("#grid-dialog_"+self.name).dialog("close")
}}})},})},"{{_('Cancel')}}":function(){$("#grid-dialog_"+self.name).dialog("close")
}}})};$.fn.sapnsGrid=function(arg1,arg2,arg3){if(typeof(arg1)=="object"){var g=new SapnsGrid(arg1);
this.data("sapnsGrid",g);this.append('<div id="grid-dialog_'+g.name+'" style="display: none;"></div>');
var g_content="";g_content+='<div class="sp-grid-container" id="'+g.name+'" cls="'+g.cls+'">';
if(g.caption){g_content+='<div class="sp-grid-caption">'+g.caption+"</div>"}if(g.with_search){g_content+='<div><div style="float: left;"><input class="sp-search-txt" name="q" type="text" value=""><button class="sp-button sp-search-btn">{{_("Search...")}}</button></div>';
$("#"+g.name+" .sp-search-btn").live("click",function(){g.search($("#"+g.name+" .sp-search-txt").val())
});$("#"+g.name+" .sp-search-txt").live("keypress",function(event){if(event.which==13){g.search($(this).val())
}});if(g.link){g_content+="<div style=\"padding-left: 20px;\"><button id='link-shortcut' class='sp-button' style='float: left;'>{{_('Create a shortcut')}}</button><div style=\"font-size: 9px; margin-top: 7px; width: 100px; float: left;\"><a id='this-search' href='"+g.link+"' target='_blank'>[{{_('this search')}}]</a></div><div id=\"link-shortcut-dialog\" style=\"display: none;\"><p>{{_('Do you want to create a shortcut for this search?')}}</p><label>{{_('Shortcut title')}}:</label><input id='link-shortcut-title' type='text' value='({{_('title')}})'></div></div>"
}g_content+="</div>"}var g_table='<div class="sp-grid-parent" style="overflow: auto; clear: left; height: '+g.height+'px; background-color: transparent;"></div>';
var g_pager="";if(g.with_pager){g_pager+='<div class="sp-grid-pager">';g_pager+='<div class="sp-grid-pager-desc"></div>';
var sel_10="",sel_50="",sel_100="",sel_all="";var sel=" selected";var another_value="";
if(g.rp==10){sel_10=sel}else{if(g.rp==50){sel_50=sel}else{if(g.rp==100){sel_100=sel
}else{if(g.rp==0){sel_all=sel}else{another_value='<option value="'+g.rp+'" selected>'+g.rp+"</option>"
}}}}g_pager+='<select class="sp-button sp-grid-rp">'+another_value+'<option value="10"'+sel_10+'>10</option><option value="50"'+sel_50+'>50</option><option value="100"'+sel_100+'>100</option><option value="0"'+sel_all+'>{{_("All")}}</option></select><button class="sp-button first-page" style="float: left;">|&lt;&lt;</button><button class="sp-button page-back" style="float: left;">&lt;&lt;</button><div><input class="sp-grid-current-page" type="text" style="text-align: center;" readonly></div><button class="sp-button page-forth" style="float: left;">&gt;&gt</button><button class="sp-button last-page" style="float: left;">&gt;&gt|</button>';
g_pager+="</div>";$("#"+g.name+" .sp-grid-rp").live("change",function(){g.rp=$(this).val();
g.pag_n=1;g.search(g.q)});$("#"+g.name+" .first-page").live("click",function(){g.pag_n=1;
g.search(g.q)});$("#"+g.name+" .page-back").live("click",function(){if(g.pag_n>1){g.pag_n-=1;
g.search(g.q)}});$("#"+g.name+" .page-forth").live("click",function(){if(g.pag_n<g.total_pag){g.pag_n*=1;
g.pag_n+=1;g.search(g.q)}});$("#"+g.name+" .last-page").live("click",function(){g.pag_n=g.total_pag;
g.search(g.q)})}this.append(g_content+g_table+g_pager+'<div class="actions"></div></div>');
g.loadActions();$("#"+g.name+" .sp-search-txt").val(g.q);g.search(g.q)}else{if(typeof(arg1)=="string"){var self=this.data("sapnsGrid");
if(arg1=="loadData"){self.loadData()}else{if(arg1=="search"){var q="";if(typeof(arg2)=="boolean"){q=self.q
}else{if(arg2){q=arg2}}if(self.with_search){$("#"+self.name+" .sp-search-txt").val(q)
}self.search(q,true)}else{if(arg1=="getSelectedIds"){return self.getSelectedIds()
}}}}}return this}})(jQuery);