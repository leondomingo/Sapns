(function(g){function b(h){this.field=g.trim(h.field);this.operator=h.operator;this.value=g.trim(h.value);
this.active=h.active!==undefined?!!h.active:true}function a(h){h=g.trim(h.toLowerCase());
h=h.replace(/[áäà]/g,"a");h=h.replace(/[éëè]/g,"e");h=h.replace(/[íïì]/g,"i");h=h.replace(/[óöò]/g,"o");
h=h.replace(/[úüù]/g,"u");h=h.replace(/[^a-z]/g,"");return h}b.prototype={tip:function(){var h=this;
return sprintf('&lt;%s&gt; %s "%s"',h.field,h.operator_title().toLowerCase(),h.value)
},operator_title:function(){var h={co:"{{_('Contains')}}",eq:"{{_('Equals to')}}",lt:"{{_('Less than')}}",gt:"{{_('Greater than')}}",let:"{{_('Less than or equals to')}}",get:"{{_('Greater than or equals to')}}",nco:"{{_('Does not contain')}}",neq:"{{_('Not equals to')}}"};
return h[this.operator]},toggle:function(){if(this.active){this.active=false}else{this.active=true
}},toString:function(){var i=this;var l=a(i.field);var j={co:"=",eq:"=",lt:"<",gt:">",let:"<=",get:">=",nco:"<>",neq:"<>"};
var m=j[i.operator];var h=i.value;if(i.operator=="eq"||i.operator=="neq"){if(h){h=sprintf('"%s"',h)
}else{if(i.operator=="eq"){return sprintf("!%s",l)}else{if(i.operator=="neq"){return sprintf("#%s",l)
}}}}else{if((i.operator=="co"||i.operator=="nco")&&!h){if(i.operator=="co"){return sprintf("!%s",l)
}else{if(i.operator=="nco"){return sprintf("#%s",l)}}}}return sprintf("%s%s%s",l,m,h)
},stringify:function(){return sprintf('%s"%s" %s "%s"',!this.active?"_":"",this.field,this.operator,this.value)
}};function f(o){var q=o.split(",");var p=[];for(var n=0,j=q.length;n<j;n++){var h=g.trim(q[n]).match('^(_)?"([^"]+)"\\s([a-z]{2,3})\\s"([^"]*)"$');
if(h){p.push(new b({field:h[2],operator:h[3],value:h[4],active:!h[1]}))}}return p
}function d(h){this.field=h.field;if(h.type=="+"){this.type="asc"}else{if(h.type=="-"){this.type="desc"
}else{this.type=h.type}}}d.prototype={toString:function(){var h=this;var j;if(h.type=="asc"){j="+"
}else{if(h.type=="desc"){j="-"}}var i=a(h.field);return sprintf("%s%s",j,i)},stringify:function(){var h=this;
var i;if(h.type=="asc"){i="+"}else{if(h.type=="desc"){i="-"}}return sprintf('%s"%s"',i,h.field)
}};function e(p){var q=p.split(",");var j=[];for(var o=0,n=q.length;o<n;o++){var h=g.trim(q[o]).match('^(\\+|\\-)"([^"]+)"$');
if(h){j.push(new d({field:h[2],type:h[1]}))}}return j}function c(l){var i=this;if(typeof(l.caption)==="function"){l.caption=l.caption()
}if(typeof(l.actions)==="function"){l.actions=l.actions()}var h=[{id:"csv",title:"CSV",url:"{{tg.url('/dashboard/tocsv/')}}"},{id:"excel",title:"Excel",url:"{{tg.url('/dashboard/toxls/')}}"}];
var m=g.extend(true,{caption:"",name:"sapns_grid_"+Math.floor(Math.random()*999999),cls:"",with_search:true,search_params:{},show_ids:false,link:"",q:"",ch_attr:"",parent_id:"",cols:[],data:{},height:500,url_base:"",multiselect:false,actions:null,actions_inline:false,hide_check:false,hide_id:true,dblclick:null,select_first:false,shift_enabled:false,exportable:true,exportable_formats:h,with_pager:true,pag_n:1,rp:10,onLoad:null,default_:{col_width:60,col_align:"center",empty_value:""}},l);
g.extend(true,i,m);i.this_page=0;i.total_count=0;i.total_pag=0;i.ajx_data=JSON.stringify({});
i.styles=[];var j=i.q.split("$$");i.q=j[0];i.filters=[];if(j.length>1){i.filters=f(j[1])
}i.order=[];if(j.length>2){i.order=e(j[2])}i._new_default={name:"new",url:'{{tg.url("/dashboard/new/")}}',require_id:"false",type:"new"};
i._edit_default={name:"edit",url:'{{tg.url("/dashboard/edit/")}}',require_id:"true",type:"edit"};
i._delete_default={name:"delete",url:'{{tg.url("/dashboard/delete/")}}',require_id:"true",type:"delete"};
i._docs_default={name:"docs",url:'{{tg.url("/docs/")}}',require_id:"true",type:"docs"}
}c.prototype.getSelectedIds=function(){var h=this;var i=[];g("#"+h.name+" .sp-grid-row").each(function(){var j=g(this).find(".sp-grid-rowid");
if(j.prop("checked")){i.push(j.attr("id_row")*1)}});return i};c.prototype.getAction=function(o){var m=this;
for(var n=0,j=m.actions.length;n<j;n++){var h=m.actions[n];if(typeof(h.type)==="object"){if(h.type.id===o){return h
}}else{if(h.name===o){return h}}}};c.prototype.getRow=function(j){var h=this;var i=null;
g("#"+h.name+" .sp-grid-row").each(function(){var l=g(this).find(".sp-grid-rowid");
if(l.attr("id_row")===j){i=l.parent();return}});return i};c.prototype.loadData=function(u){var E=this;
var C=E.cols;if(typeof(C)==="function"){C=C()}var w=23;if(E.hide_check){w=-6}var t=C.length*42;
if(!E.hide_check){t+=23}if(!E.hide_id){t+=60}var m=905;if(t<m){t=m}var A="";for(var O=0,K=C.length;
O<K;O++){var v=C[O];if(v.title!="id"){A+='<option value="'+v.title+'">'+v.title+"</option>"
}if(E.hide_id&&v.title==="id"){continue}w+=(v.width+5)}g("#"+E.name+" .sp-grid-filter-field").html(A);
var P='<div class="sp-grid" style="width:'+(w+200)+'px">';var p='<div class="sp-grid-row" style="width:'+(w+150)+'px">';
if(!E.hide_check){p+='<div class="sp-col-title" style="width:23px">                <input class="sp-grid-select-all" type="checkbox"></div>'
}if(E.actions_inline){p+='<div class="sp-col-title" style="%(actions_wd)s">*</div>'
}var F={};for(var O=0,K=E.order.length;O<K;O++){var H=E.order[O];H.index=O+1;F[E.order[O].field]=H
}for(var O=0,K=C.length;O<K;O++){var v=C[O];var B=v.width;if(!B){B=E.default_.col_width
}if(E.hide_id&&v.title==="id"){continue}var s="";var T="";var D="";if(F[v.title]){var H=F[v.title];
s="sp-grid-ordered-col";T=' order_type="'+H.type+'"';var y;if(H.type==="asc"){y="+"
}else{y="-"}D=" ("+H.index+y+")"}p+='<div class="sp-col-title sp-col-title-sortable '+s+'"'+T+' style="width:'+B+'px" col_title="'+v.title+'">'+v.title+D+"</div>"
}p+="</div>";var U=E.data;if(typeof(U)==="function"){U=U()}var G=U.length;if(G>0){for(var O=0;
O<G;O++){var x=U[O];var S="";if(E.styles.length&&E.styles.length>O){S=E.styles[O]
}var r='<div class="sp-grid-row" style="width:'+(w+150)+'px">';if(!E.hide_check){var N="";
if(O===G-1){N="border-radius:0 0 0 5px"}r+='<div class="sp-grid-cell" title="'+x[0]+'" style="width:23px;'+N+'"><input class="sp-grid-rowid" type="checkbox" id_row="'+x[0]+'"></div>'
}if(E.actions_inline){var h="width:107px";if(!E.nonstd){h="width:82px"}var R='<div class="sp-grid-cell" style="%(actions_wd)s">                        <img class="inline_action edit_inline" title="{{_("Edit")}}"                             src="{{tg.url("/images/sapns/icons/edit.png")}}">                        <img class="inline_action delete_inline" title="{{_("Delete")}}"                             src="{{tg.url("/images/sapns/icons/delete.png")}}">                        <img class="inline_action docs_inline" title="{{_("Docs")}}"                             src="{{tg.url("/images/sapns/icons/docs.png")}}">';
r+=sprintf(R,{actions_wd:h})+E.nonstd+"</div>"}if(O===0){P+=sprintf(p,{actions_wd:h})
}for(var M=0,z=C.length;M<z;M++){var v=C[M];var L=v.align;if(!L){L=E.default_.col_align
}var B=v.width;if(!B){B=E.default_.col_width}var q=x[M];if(!q){q=E.default_.empty_value
}if(E.hide_id&&v.title=="id"){continue}var J="";if(B>0){J=" width:"+B+"px;"}var N="";
if((E.hide_check&&O==G-1)&&(!E.hide_id&&M==0||E.hide_id&&M==1)){N="border-radius:0 0 0 5px;"
}if(O==G-1&&M==z-1){N="border-radius:0 0 5px 0;"}r+='<div class="sp-grid-cell sp-grid-cell-tip clickable '+S+'"                         style="text-align:'+L+";"+J+N+'"';
if(q){r+=sprintf('title="%s"',q.replace(/"/gi,"''"))}else{r+='title="({{_("empty")}})"'
}r+=">"+q+"</div>"}r+="</div>";P+=r}}else{var I=1;var Q=w;if(E.actions_inline){I=3;
Q+=25}P+=sprintf(p,{actions_wd:h})+'<div class="sp-grid-row"><div class="sp-grid-cell sp-grid-noresults" title="{{_("No results")}}" style="width:'+Q+'px" >{{_("No results")}}</div></div>'
}P+="</div>";g("#"+E.name).find(".sp-grid-parent").html(P);g(".sp-col-title-sortable").disableSelection();
if(E.select_first&&E.with_search&&E.q&&G<5&&G>0){g("#"+E.name+" .sp-grid-rowid:first").prop("checked",true)
}if(u){u()}};c.prototype.query=function(){var h=this;var j=h.q;var i=g.map(h.filters,function(l){if(l.active){return l
}});if(i.length){if(j){j=j+", "+i.join(", ")}else{j=i.join(", ")}}if(h.order.length){if(j){j=j+", "+h.order.join(", ")
}else{j=h.order.join(", ")}}return j};c.prototype.search=function(n,m,l){var j=this;
if(m===undefined){m=false}if(n===undefined){n=j.q}if(j.q!=n||m){j.pag_n=1}j.q=n;j.filters_tip();
var n=j.query();var o=sprintf('<div class="sp-grid-loading" style="height:%(hg)dpx">{{_("Loading")}}...</div>',{hg:j.height-50});
g("#"+j.name).find(".sp-grid-parent").html(o);var i=g.extend(true,{url:"{{tg.url('/dashboard/grid/')}}",data:{cls:j.cls,q:n,rp:j.rp,pag_n:j.pag_n,ch_attr:j.ch_attr,parent_id:j.parent_id},success:function(q){if(q.status){if(q.this_page){j.this_page=q.this_page
}if(q.total_count){j.total_count=q.total_count}if(q.total_pag){j.total_pag=q.total_pag
}if(q.cols){j.cols=q.cols}if(q.actions){j.actions=q.actions}if(q.styles){j.styles=q.styles
}var v=(j.pag_n-1)*j.rp*1;var u={curr_page:j.pag_n*1,total_page:j.total_pag*1,pos0:v+1,pos1:v+j.this_page};
var s=sprintf("{{_('Page %(curr_page)d of %(total_page)d / Showing rows %(pos0)d to %(pos1)d')}}",u);
g("#"+j.name+" .sp-grid-first-page").attr("title","{{_('page 1')}}");if(u.curr_page>1){var p=sprintf("{{_('page %(p)d')}}",{p:u.curr_page-1});
g("#"+j.name+" .sp-grid-page-back").attr("title",p).prop("disabled",false)}else{g("#"+j.name+" .sp-grid-page-back").prop("disabled",true)
}if(u.curr_page<u.total_page){var t=sprintf("{{_('page %(p)d')}}",{p:u.curr_page+1});
g("#"+j.name+" .sp-grid-page-forth").attr("title",t).prop("disabled",false)}else{g("#"+j.name+" .sp-grid-page-forth").prop("disabled",true)
}g("#"+j.name+" .sp-search-txt").focus();var r=sprintf("{{_('page %(p)d')}}",{p:u.total_page});
g("#"+j.name+" .sp-grid-last-page").attr("title",r);g("#"+j.name+" .sp-grid-current-page").val(j.pag_n);
j.data=q.data;j.loadData(function(){g(".sp-grid-cell-tip, .edit_inline, .delete_inline, .docs_inline, .new_inline").qtip({content:{text:true},position:{my:"top left",at:"bottom center"},style:"ui-tooltip-rounded"})
});if(l){l(q)}if(j.onLoad){j.onLoad(q)}}}},j.search_params);var h=JSON.stringify(i.data);
if(j.ajx_data){if(j.ajx_data===h&&!m){j.loadData()}else{g.ajax(i)}}j.ajx_data=h};
c.prototype.warningSelectedId=function(){var h=this;g("#grid-dialog_"+h.name).html("<p style='text-align:center;font-style:italic'>{{_('You must select a row before click on this action')}}</p>").dialog({title:h.caption,resizable:false,height:155,width:450,modal:true,draggable:false,buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+h.name).dialog("close")
}}});g(".ui-icon-closethick").hide()};c.prototype._loadActions=function(m){var w=this;
var u="";w.nonstd="";var q='<button id="%(id)s" class="sp-grid-button-action">%(title)s</button>';
var v='<option value="%(id)s">%(title)s</option>';if(m.length>0){u="";for(var n=0,h=m.length;
n<h;n++){var s=m[n];var o=s.require_id;if(o===undefined){o=true}if(typeof(s.type)==="string"&&s.type==="new"){var r='<img class="inline_action new_inline" title="{{_("New")}}" src="{{tg.url("/images/sapns/icons/new.png")}}">';
g("#"+w.name+" .sp-grid-search-box").append(r)}else{if(!w.actions_inline){g("#"+w.name+" .sp-grid-button-actions").show();
var y;if(typeof(s.type)=="object"){y={id:s.type.id,title:s.title}}else{y={id:s.name,title:s.title}
}g("#"+w.name+" .sp-grid-button-actions").append(sprintf(q,y))}else{if(w.actions_inline){if(typeof(s.type)==="string"&&(s.type=="edit"||s.type=="delete"||s.type=="docs")){continue
}else{var j;if(typeof(s.type)=="object"){j={id:s.type.id,title:s.title}}else{j={id:s.name,title:s.title}
}w.nonstd+=sprintf(v,j)}}}}}if(w.nonstd){w.nonstd='<select class="nonstd_actions"><option value=""></option>'+w.nonstd+"</select>"
}}if(w.exportable){var t=w.exportable_formats;if(typeof(w.exportable)=="object"){t=w.exportable.formats
}var h=t.length;if(h>0){var x="";for(var n=0;n<h;n++){x+='<option value="'+t[n].id+'">'+t[n].title+"</option>"
}var p='<div class="export" style="height:25px;float:left"><select class="sp-button sp-grid-action" style="height:20px"><option value="">({{_("Export")}})</option>'+x+"</select></div>";
g("#"+w.name+" .sp-grid-search-box").append(p)}}return u};c.prototype.complete_actions=function(){var m=this;
for(var n=0,j=m.actions.length;n<j;n++){var h=m.actions[n];if(typeof(h.type)==="string"){if(h.type==="new"){m.actions[n]=g.extend(m._new_default,h)
}else{if(h.type==="edit"){m.actions[n]=g.extend(m._edit_default,h)}else{if(h.type==="delete"){m.actions[n]=g.extend(m._delete_default,h)
}else{if(h.type==="docs"){m.actions[n]=g.extend(m._docs_default,h)}}}}}}};c.prototype.loadActions=function(u){var v=this;
var r="";var j=sprintf("#%s .actions",v.name);if(v.actions!=null){if(v.actions.length===undefined){var x=g.extend(true,{url:"{{tg.url('/dashboard/grid_actions/')}}",cache:false,data:{cls:v.cls},success:function(y){if(y.status){v.actions=y.actions
}g(j).html(v._loadActions(v.actions));if(u){u()}}},v.actions);g.ajax(x)}else{g(j).html(v._loadActions(v.actions));
if(u){u()}}}else{if(u){u()}}var p=sprintf("#%s .sp-grid-cell.clickable",v.name);g(document).off("click",p).on("click",p,function(z){var A=z.ctrlKey||z.metaKey;
var y=g(this).parent().find(".sp-grid-rowid");if(!y.prop("checked")||A||v.multiselect){g("#"+v.name+" .sp-grid-select-all").prop("checked",false);
g("#"+v.name+" .sp-grid-rowid").each(function(){if(g(this)!=y&&!v.multiselect&&!A){g(this).prop("checked",false);
g(this).parent().parent().removeClass("sp-grid-row-selected")}});if(y.prop("checked")){y.prop("checked",false);
g(this).parent().removeClass("sp-grid-row-selected")}else{y.prop("checked",true);
g(this).parent().addClass("sp-grid-row-selected")}}else{if(v.dblclick){n(y.attr("id_row")*1,v.dblclick,z.ctrlKey||z.metaKey,z.shiftKey)
}}});function h(D,E){var B=v.q+"$$";for(var A=0,y=v.filters.length;A<y;A++){if(A>0){B+=", "
}B+=v.filters[A].stringify()}B+="$$";for(var A=0,y=v.order.length;A<y;A++){if(A>0){B+=", "
}B+=v.order[A].stringify()}B=encodeURI(B).replace("-","%2D","g").replace('"',"%22","g").replace("+","%2B","g").replace("#","%23","g");
var z="";if(E!="_blank"){var z=v.url_base+"?q="+B+"&rp="+v.rp+"&pag_n="+v.pag_n+"&ch_attr="+v.ch_attr+"&parent_id="+v.parent_id
}var C='<form type="post" action="'+D+'" target="'+E+'"><input type="hidden" name="came_from" value="'+z+'">';
if(v.ch_attr){C+='<input type="hidden" name="_'+v.ch_attr+'" value="'+v.parent_id+'">'
}C+="</form>";return C}function q(F,B,A,C,z){if(typeof(A.type)==="string"){if(z&&v.shift_enabled){if(A.type==="new"){A=v._new_default
}else{if(A.type==="edit"){A=v._edit_default}else{if(A.type==="delete"){A=v._delete_default
}else{if(A.type==="docs"){A=v._docs_default}}}}}var y=A.url;if(y[y.length-1]!="/"){y+="/"
}var D="";if(C){D="_blank"}if(A.type==="process"){if(A.require_id){if(F){y+=F}else{v.warningSelectedId();
return}}else{if(F){y+=F}}}else{if(A.type==="new"){y+=sprintf("%s/",v.cls)}else{if(A.type==="delete"){v.std_delete(B,A.url);
return}else{if(A.require_id){if(F){y+=sprintf("%s/%s",v.cls,F)}else{v.warningSelectedId();
return}}else{if(F){y+=sprintf("%s/%s",v.cls,F)}else{y+=sprintf("%s/",v.cls)}}}}}g(h(y,D)).appendTo("body").submit().remove()
}else{var E=B;if(A.require_id){if(E.length>0){A.type.f(E[0],E)}else{v.warningSelectedId();
return}}else{if(E.length>0){A.type.f(E[0],E)}else{A.type.f()}}}}function n(A,C,B,z){var y=v.getAction(C);
if(typeof(A)!=="number"){var D=A.parent().parent().find(".sp-grid-rowid").attr("id_row")
}else{var D=A}q(D,[],y,B,z)}var i=sprintf("#%s .new_inline",v.name);g(document).off("click",i).on("click",i,function(y){n(g(this),"new",y.ctrlKey||y.metaKey,y.shiftKey)
});if(v.actions_inline){var s=sprintf("#%s .edit_inline",v.name);g(document).off("click",s).on("click",s,function(y){n(g(this),"edit",y.ctrlKey||y.metaKey,y.shiftKey)
});var m=sprintf("#%s .delete_inline",v.name);g(document).off("click",m).on("click",m,function(A){var z=v.getSelectedIds();
if(z.length==0){var B=g(this).parent().parent().find(".sp-grid-rowid").attr("id_row");
z=[B]}var y=v.getAction("delete");v.std_delete(z,y.url)});var l=sprintf("#%s .docs_inline",v.name);
g(document).off("click",l).on("click",l,function(y){n(g(this),"docs",false,y.shiftKey)
});var w=sprintf("#%s .nonstd_actions",v.name);g(document).off("change",w).on("change",w,function(z){var y=g(this).val();
if(y){n(g(this),y)}})}else{var o=sprintf("#%s .sp-grid-button-action",v.name);g(document).off("click",o).on("click",o,function(z){var y=v.getAction(g(this).attr("id"));
var A=v.getSelectedIds();q(A[0],A,y,z.ctrlKey||z.metaKey,z.shiftKey)})}var t=sprintf("#%s .export select",v.name);
g(document).off("change","export_sel").on("change",t,function(){var A=g(t).val();
if(A==""){return}var y=v.exportable_formats;var F="";if(typeof(v.exportable)==="object"){y=v.exportable.formats;
if(v.exportable.data){for(k in v.exportable.data){var B=v.exportable.data[k];if(typeof(B)==="function"){B=B()
}F+='<input type="hidden" name="'+k+'" value="'+B+'">'}}}var D="";for(var E=0,z=y.length;
E<z;E++){if(y[E].id==A){D=y[E].url;break}}var C='<form action="'+D+'" method="get">                <input type="hidden" name="cls" value="'+v.cls+'">                <input type="hidden" name="q" value="'+v.query()+'">                <input type="hidden" name="ch_attr" value="'+v.ch_attr+'">                <input type="hidden" name="parent_id" value="'+v.parent_id+'">'+F+"</form>";
g(C).appendTo("body").submit().remove();g(this).find("option:first").prop("selected",true)
})};c.prototype.std_delete=function(m,l){var j=this;var i=j.cls;var p=JSON.stringify(m);
var n="<p id='delete-question'>{{_('Do you really want to delete this record?')}}</p><p id='object-title'></p>";
var h="<p id='delete-error-title'>{{_('Oops, something went wrong...')}}</p><div id='delete-error-message'></div>";
g("#grid-dialog_"+j.name).html(n);var o="";g.ajax({url:"{{tg.url('/dashboard/title/')}}",data:{cls:i,id:p},success:function(q){if(q.status){var r;
if(typeof(q.title)==="string"){r=q.title}else{r=q.title.join(" | ")}g("#grid-dialog_"+j.name+" #object-title").html(r)
}},error:function(){}});g("#grid-dialog_"+j.name).dialog({width:650,height:210,resizable:false,modal:true,title:"{{_('Delete')}}",buttons:{"{{_('Ok')}}":function(){g.ajax({url:l,data:{cls:i,id_:p},dataType:"json",success:function(r){if(r.status){j.search(j.q,true);
g("#grid-dialog_"+j.name).dialog("close")}else{g("#grid-dialog_"+j.name).dialog("close");
var s="<p style='color:gray'>"+r.message+"</p>";if(r.rel_tables!=undefined&&r.rel_tables.length>0){s+="<div>{{_('For your information this object is related with other objects in the following classes:')}}</div>";
s+="<ul>";for(var q=0;q<r.rel_tables.length;q++){var u=r.rel_tables[q].class_title;
var t=r.rel_tables[q].attr_title;s+='<li><span style="font-weight:bold">'+u+'</span> (<span style="color:#777">'+t+"</span>)</li>"
}s+="</ul>"}g("#grid-dialog_"+j.name).html(h).find("#delete-error-message").html(s);
g("#grid-dialog_"+j.name).dialog({width:700,height:250,buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+j.name).dialog("close")
}}})}},error:function(){g("#grid-dialog_"+j.name).dialog("close");g("#grid-dialog_"+j.name).html(h).dialog({buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+j.name).dialog("close")
}}})}})},"{{_('Cancel')}}":function(){g("#grid-dialog_"+j.name).dialog("close")}}})
};c.prototype.selectAll=function(h){var i=this;if(h===undefined){h=true}g("#"+i.name+" .sp-grid-rowid").prop("checked",h)
};c.prototype.filters_tip=function(){var h=this;g("#"+h.name+" .sp-search-btn").qtip({content:{text:function(){var n="";
if(h.filters.length){for(var m=0,j=h.filters.length;m<j;m++){if(!h.filters[m].active){n+='<font style="text-decoration:line-through">'+h.filters[m].tip()+"</font><br>"
}else{n+=h.filters[m].tip()+"<br>"}}}else{n="No hay filtros"}return n}},position:{at:"top right",my:"bottom left"},style:"ui-tooltip-rounded"});
if(h.filters.length){g("#"+h.name+" .sp-search-btn").css("border-color","orange")
}else{g("#"+h.name+" .sp-search-btn").css("border-color","")}};g.fn.sapnsGrid=function(y,x,v){if(typeof(y)=="object"){var I=new c(y);
this.data("sapnsGrid",I);var w="#"+I.name;this.append(sprintf('<div id="grid-dialog_%(name)s" style="display:none"></div>',{name:I.name}));
var E="";E+=sprintf('<div class="sp-grid-container" id="%(name)s" cls="%(cls)s">',{name:I.name,cls:I.cls});
if(I.caption){E+=sprintf('<div class="sp-grid-caption">%(caption)s</div>',{caption:I.caption})
}if(I.with_search){E+='<div><div class="sp-grid-search-box"><input class="sp-search-txt" style="float:left" name="q" type="text" value=""><img class="inline_action sp-search-btn" src="{{tg.url("/images/sapns/icons/search.png")}}" titlee="{{_("Search...")}}"></div>';
E+='<div class="sp-grid-filters" style="display:none"></div>';E+='<div class="sp-grid-edit-filter" style="display:none">                    <div style="float:left;height:40px;margin-right:5px">                        <div class="sp-grid-filter-label">{{_("Field")}}</div>                        <div><select class="sp-grid-filter-field"></select></div>                    </div>                    <div style="float:left;height:40px;margin-right:5px">                        <div class="sp-grid-filter-label">{{_("Operator")}}</div>                        <div><select class="sp-grid-filter-operator">                            <option value="co">{{_("Contains")}}</option>                            <option value="eq">{{_("Equals to")}}</option>                            <option value="lt">{{_("Less than")}}</option>                            <option value="gt">{{_("Greater than")}}</option>                            <option value="let">{{_("Less than or equals to")}}</option>                            <option value="get">{{_("Greater than or equals to")}}</option>                            <option value="nco">{{_("Does not contain")}}</option>                            <option value="neq">{{_("Not equals to")}}</option>                        </select></div>                    </div>                    <div style="float:left;height:40px">                        <div class="sp-grid-filter-label">{{_("Value")}}</div>                        <input class="sp-grid-filter-value" type="text">                    </div></div>';
var p=".sp-grid-activate-filter, .sp-grid-deactivate-filter";g(document).off("keypress",".sp-grid-filter-value").on("keypress",".sp-grid-filter-value",function(q){if(q.which===13){g(this).parents(".ui-dialog").find(".ui-dialog-buttonset button:first").click()
}});g(document).off("click",".sp-grid-row-filter button").on("click",".sp-grid-row-filter button",function(){var q=g(this).parent().attr("filter_order");
var K=I.filters[q];if(K.active){g(this).parent().removeClass("active").addClass("inactive");
g(this).text("{{_('Activate')}}")}else{g(this).parent().removeClass("inactive").addClass("active");
g(this).text("{{_('Deactivate')}}")}g(this).addClass("sp-grid-filter-changed");K.toggle()
});var J=w+" .sp-search-btn";g(document).off("click",J).on("click",J,function(){function K(){var P="",L=I.filters.length;
if(L){for(var N=0;N<L;N++){var Q=I.filters[N];var M="",O="active";if(Q.active){M='<button>{{_("Deactivate")}}</button>'
}else{O="inactive";M='<button>{{_("Activate")}}</button>'}P+='<div class="sp-grid-row-filter '+O+'" style="clear:left" filter_order="'+N+'">                                    <div style="float:left;margin-right:10px"><input class="sp-grid-check-filter" type="checkbox"></div>                                    <div class="sp-grid-filter-description"><span class="col">&lt;'+Q.field+'&gt;</span>                                     <span class="operator">'+Q.operator_title().toLowerCase()+'</span>                                    <span class="value">"'+Q.value+'"</span></div>'+M+"</div>"
}}else{P='<p class="sp-grid-no-filters">{{_("There are no filters")}}</p>'}g(w+" .sp-grid-filters").html(P)
}K();function q(L,M){g("<div/>").html(g(w+" .sp-grid-edit-filter").html()).dialog({title:"{{_('Edit filter')}}",modal:true,resizable:false,width:700,height:150,open:function(){if(L){g(this).find(".sp-grid-filter-field").val(L.field);
g(this).find(".sp-grid-filter-operator").val(L.operator);g(this).find(".sp-grid-filter-value").val(L.value)
}},buttons:{"{{_('Ok')}}":function(){var N=this;if(!L){L=new b({field:g(this).find(".sp-grid-filter-field").val(),operator:g(this).find(".sp-grid-filter-operator").val(),value:g(this).find(".sp-grid-filter-value").val()});
I.filters.push(L)}else{L.field=g(this).find(".sp-grid-filter-field").val();L.operator=g(this).find(".sp-grid-filter-operator").val();
L.value=g(this).find(".sp-grid-filter-value").val()}I.search(g(w+" .sp-search-txt").val(),true);
g(this).dialog("destroy").remove();if(M){M()}},"{{_('Cancel')}}":function(){g(this).dialog("destroy").remove()
}}})}g("<div/>").html(g(w+" .sp-grid-filters").html()).dialog({title:"Filtros",modal:true,resizable:false,width:600,height:300,closeOnEscape:false,open:function(){var L=g(this);
q(null,function(){L.dialog("destroy").remove()})},buttons:{"{{_('Add')}}":function(){var L=g(this);
q(null,function(){L.dialog("destroy").remove()})},"{{_('Edit')}}":function(){var L=g(this).find(".sp-grid-row-filter input[type=checkbox]:visible:checked:first").parent().parent().attr("filter_order");
var M=g(this);q(I.filters[L],function(){M.dialog("destroy").remove()});I.search(g(w+" .sp-search-txt").val(),true)
},"{{_('Remove')}}":function(){var N=[];g(this).find(".sp-grid-row-filter input[type=checkbox]:visible:checked").each(function(){N.push(g(this).parent().parent().attr("filter_order")*1)
});N=N.reverse();for(var M=0,L=N.length;M<L;M++){I.filters.splice(N[M],1)}I.search(g(w+" .sp-search-txt").val(),true);
g(this).dialog("destroy").remove()},"{{_('Remove all')}}":function(){I.filters=[];
I.search(g(w+" .sp-search-txt").val(),true);g(this).dialog("destroy").remove()},"{{_('Close')}}":function(){if(g(".sp-grid-filter-changed").length){g(".sp-grid-filter-changed").removeClass("sp-grid-filter-changed");
I.search(g(w+" .sp-search-txt").val(),true)}g(this).dialog("destroy").remove()}}})
});var C=w+" .sp-search-txt";g(document).off("keypress",C).on("keypress",C,function(q){if(q.which===13){I.search(g(this).val())
}});E+="</div>"}var H='<div class="sp-grid-parent" style="overflow:auto;clear:left;height:'+(I.height+5)+'px;background-color:transparent"></div>';
var t="";if(I.with_pager){t+='<div class="sp-grid-pager">                    <div class="sp-grid-pager-desc"></div>';
var F="",i="",B="",n="";var D=" selected";var j="";if(I.rp==10){F=D}else{if(I.rp==50){i=D
}else{if(I.rp==100){B=D}else{if(I.rp==0){n=D}else{j='<option value="'+I.rp+'" selected>'+I.rp+"</option>"
}}}}t+='<div style="float:left;clear:right;height:25px;margin-top:2px"><select class="sp-button sp-grid-rp">'+j+'<option value="10"'+F+'>10</option><option value="50"'+i+'>50</option><option value="100"'+B+'>100</option><option value="0"'+n+'>{{_("All")}}</option></select><button class="sp-button sp-grid-first-page" style="float:left">|&lt;&lt;</button><button class="sp-button sp-grid-page-back" style="float:left">&lt;&lt;</button><input class="sp-grid-current-page" type="text" style="text-align:center;font-size:11px;margin-top:3px" readonly><button class="sp-button sp-grid-page-forth" style="float:left">&gt;&gt</button>';
t+="</div>";var u=w+" .sp-grid-select-all",r=w+" .sp-grid-rp",o=w+" .sp-grid-first-page",m=w+" .sp-grid-page-back",l=w+" .sp-grid-page-forth",h=w+" .sp-grid-last-page";
g(document).off("click",u).on("click",u,function(){var q=g(this).prop("checked");
I.selectAll(q)});g(document).off("change",r).on("change",r,function(){I.rp=g(this).val();
I.pag_n=1;I.search(I.q)});g(document).off("click",o).on("click",o,function(){I.pag_n=1;
I.search(I.q)});g(document).off("click",m).on("click",m,function(){if(I.pag_n>1){I.pag_n-=1;
I.search(I.q)}});g(document).off("click",l).on("click",l,function(){if(I.pag_n<I.total_pag){I.pag_n*=1;
I.pag_n+=1;I.search(I.q)}});g(document).off("click",h).on("click",h,function(){I.pag_n=I.total_pag;
I.search(I.q)})}var G=w+" .sp-col-title-sortable";g(document).off("click",G).on("click",G,function(N){var P=g(this).attr("col_title");
var K=N.shiftKey;var O=N.ctrlKey||N.metaKey;if(g(this).hasClass("sp-grid-ordered-col")){var M;
if(g(this).attr("order_type")=="asc"){M="desc"}else{M="asc"}if(K){for(var L=0,q=I.order.length;
L<q;L++){if(I.order[L].field===P){break}}I.order[L].type=M}else{if(!O){if(I.order.length>1){M="asc"
}var Q=new d({field:P,type:M});I.order=[Q]}else{for(var L=0,q=I.order.length;L<q;
L++){if(I.order[L].field===P){break}}I.order.splice(L,1);g(this).removeClass("sp-grid-ordered-col")
}}}else{var Q=new d({field:P,type:"asc"});if(K){I.order.push(Q)}else{I.order=[Q]}}I.search(undefined,true)
});var s='<div class="sp-grid-button-actions" style="display:none"></div>';this.append(E+s+H+t+"</div>");
I.loadActions(function(){g(w+" .sp-search-txt").val(I.q);I.search(I.q)})}else{if(typeof(y)=="string"){var A=this.data("sapnsGrid");
var w="#"+A.name;if(y=="loadData"){A.loadData()}else{if(y=="search"){var z="";if(typeof(x)=="boolean"){z=A.q
}else{if(x){z=x}}if(A.with_search){g(w+" .sp-search-txt").val(z)}A.search(z,true,v)
}else{if(y=="getSelectedIds"){return A.getSelectedIds()}else{if(y=="setRp"){A.rp=x;
g(w+" .sp-grid-rp [value="+x+"]").prop("selected",true)}else{if(y=="selectAll"){A.selectAll()
}}}}}}}return this}})(jQuery);