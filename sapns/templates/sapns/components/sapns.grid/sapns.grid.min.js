function load_script(b){var a=document.createElement("script");a.setAttribute("type","text/javascript");
a.setAttribute("src",b);document.getElementsByTagName("head")[0].appendChild(a)}function load_css(a){var b=document.createElement("link");
b.setAttribute("rel","stylesheet");b.setAttribute("type","text/css");b.setAttribute("href",a)
}try{sprintf}catch(e){load_script("{{tg.url('/js/sprintf.min.js')}}")}(function(b){function a(d){function f(g,h,i,j){if(j==undefined){j=d
}if(j[h]==undefined){g[h]=i}else{g[h]=j[h]}return}f(this,"caption","");if(typeof(this.caption)=="function"){this.caption=this.caption()
}f(this,"name","grid_"+Math.floor(Math.random()*999999));f(this,"cls","");f(this,"with_search",true);
f(this,"search_params",{});f(this,"show_ids",false);f(this,"link","");f(this,"q","");
f(this,"ch_attr","");f(this,"parent_id","");f(this,"cols",[]);f(this,"data",{});f(this,"height",500);
f(this,"url_base","");f(this,"multiselect",false);f(this,"actions_inline",false);
f(this,"hide_check",false);f(this,"hide_id",false);f(this,"dblclick",null);f(this,"select_first",false);
f(this,"onLoad",null);f(this,"default_",{});f(this.default_,"col_width",60,this.default_);
f(this.default_,"col_align","center",this.default_);f(this.default_,"empty_value","",this.default_);
f(this,"actions",null);if(typeof(this.actions)=="function"){this.actions=this.actions()
}f(this,"exportable",true);var c=[{id:"csv",title:"CSV",url:"/dashboard/tocsv"},{id:"excel",title:"Excel",url:"/dashboard/toxls"}];
f(this,"exportable_formats",c);f(this,"with_pager",true);f(this,"pag_n",1);f(this,"rp",10);
f(this,"this_page",0);f(this,"total_count",0);f(this,"total_pag",0);this.ajx_data="{}"
}a.prototype.getSelectedIds=function(){var c=this;var d=[];b("#"+c.name+" .sp-grid-row").each(function(){var f=b(this).find(".sp-grid-rowid");
if(f.attr("checked")==true){d.push(f.attr("id_row")*1)}});return d};a.prototype.getRow=function(f){var c=this;
var d=null;b("#"+c.name+" .sp-grid-row").each(function(){var g=b(this).find(".sp-grid-rowid");
if(g.attr("id_row")==f){d=g.parent();return}});return d};a.prototype.loadData=function(){var q=this;
var p=q.cols;if(typeof(p)=="function"){p=p()}var f=20;for(var x=0,u=p.length;x<u;
x++){var d=p[x];f+=(d.width+8)}var y='<div class="sp-grid" style="width: '+f+'px;">';
if(!q.hide_check){y+='<div class="sp-grid-row"><div class="sp-col-title">#</div>'
}if(q.actions_inline){y+='<div class="sp-col-title">*</div>'}for(var x=0,u=p.length;
x<u;x++){var d=p[x];var o=d.width;if(!o){o=q.default_.col_width}if(q.hide_id&&d.title=="id"){continue
}y+='<div class="sp-col-title" style="width: '+o+'px;">'+d.title+"</div>"}y+="</div>";
var z=q.data;if(typeof(z)=="function"){z=z()}var r=z.length;if(r>0){for(var x=0;x<r;
x++){var g=z[x];y+='<div class="sp-grid-row">';if(!q.hide_check){y+='<div class="sp-grid-cell" title="'+(x+1)+'"><input class="sp-grid-rowid" type="checkbox" id_row="'+g[0]+'"></div>'
}if(q.actions_inline){var h='style="padding: 2px; margin-left: 5px; margin-right: 5px; border: 1px solid lightgray;"';
y+='<div class="sp-grid-cell" style="font-size: 10px; width: 35px;"><a class="edit_inline" href="#" title="edit" '+h+'>E</a><a class="delete_inline" href="#" title="delete" '+h+'>D</a><a class="docs_inline" href="#" title="docs" '+h+">D</a></div>"
}for(var w=0,m=p.length;w<m;w++){var d=p[w];var v=d.align;if(!v){v=q.default_.col_align
}var o=d.width;if(!o){o=q.default_.col_width}var c=g[w];if(!c){c=q.default_.empty_value
}if(q.hide_id&&d.title=="id"){continue}var t="";if(o>0){t=" width: "+o+"px;"}y+='<div class="sp-grid-cell" style="text-align: '+v+";"+t+'"';
if(c){y+='title="'+c.replace(/"/gi,"''")+'"'}else{y+='title="({{_("empty")}})"'}y+='clickable="true">'+c+"</div>"
}y+="</div>"}}else{var s=1;if(q.actions_inline){s=3}y+='<div class="sp-grid-row"><div class="sp-grid-cell sp-grid-noresults" style="width: '+(f-p.length*4)+'px;" >{{_("No results")}}</div></div>'
}y+="</div>";b("#"+q.name).find(".sp-grid-parent").html(y);if(q.select_first&&q.with_search&&q.q&&r<5&&r>0){b("#"+q.name+" .sp-grid-row input[type=checkbox]:first").attr("checked",true)
}};a.prototype.search=function(i,h,g){var f=this;if(h==undefined){h=false}if(i==undefined){i=f.q
}if(f.q!=i||h){f.pag_n=1}f.q=i;var j='<div style="padding: 10px; font-size: 15px; font-weight: bold; color: gray;">{{_("Loading")}}...</div>';
b("#"+f.name).find(".sp-grid-parent").html(j);var d=b.extend(true,{url:"{{tg.url('/dashboard/grid/')}}",data:{cls:f.cls,q:f.q,rp:f.rp,pag_n:f.pag_n,ch_attr:f.ch_attr,parent_id:f.parent_id},success:function(m){if(m.status){if(m.this_page){f.this_page=m.this_page
}if(m.total_count){f.total_count=m.total_count}if(m.total_pag){f.total_pag=m.total_pag
}if(m.cols){f.cols=m.cols}if(m.actions){f.actions=m.actions}var s=(f.pag_n-1)*f.rp*1;
var r={curr_page:f.pag_n*1,total_page:f.total_pag*1,pos0:s+1,pos1:s+f.this_page};
var o=sprintf("{{_('Page %(curr_page)d of %(total_page)d / Showing rows %(pos0)d to %(pos1)d')}}",r);
b("#"+f.name+" .first-page").attr("title","{{_('page 1')}}");if(r.curr_page>1){var l=sprintf("{{_('page %(p)d')}}",{p:r.curr_page-1});
b("#"+f.name+" .page-back").attr("title",l).attr("disabled",false)}else{b("#"+f.name+" .page-back").attr("disabled",true)
}if(r.curr_page<r.total_page){var p=sprintf("{{_('page %(p)d')}}",{p:r.curr_page+1});
b("#"+f.name+" .page-forth").attr("title",p).attr("disabled",false)}else{b("#"+f.name+" .page-forth").attr("disabled",true)
}var n=sprintf("{{_('page %(p)d')}}",{p:r.total_page});b("#"+f.name+" .last-page").attr("title",n);
b("#"+f.name+" .sp-grid-pager-desc").html(o);b("#"+f.name+" .sp-grid-current-page").val(f.pag_n);
try{b(".sp-grid-cell").qtip({content:{text:true},position:{my:"left top",at:"bottom center"},style:"ui-tooltip-dark ui-tooltip-rounded"})
}catch(q){}f.data=m.data;f.loadData();if(g){g(m)}if(f.onLoad){f.onLoad(m)}}}},f.search_params);
var c=JSON.stringify(d.data);if(f.ajx_data){if(f.ajx_data===c&&!h){f.loadData()}else{b.ajax(d)
}}f.ajx_data=c};a.prototype.warningSelectedId=function(){var c=this;b("#grid-dialog_"+c.name).html("<p style='text-align: center; font-style: italic;'>{{_('You must select a row before click on this action')}}</p>").dialog({title:c.caption,resizable:false,height:155,width:450,modal:true,draggable:false,buttons:{"{{_('Close')}}":function(){b("#grid-dialog_"+c.name).dialog("close")
}}});b(".ui-icon-closethick").hide()};a.prototype._loadActions=function(d){var o=this;
var m="";if(d.length>0){m="";for(var f=0,c=d.length;f<c;f++){var h=d[f];var g=h.require_id;
if(g===undefined){g=true}if(typeof(h.type)==="string"){var n='<div style="float: left;">';
n+='<button class="sp-button sp-grid-action standard_action"  id="'+o.name+"_"+h.name+'" title="'+h.url+'" url="'+h.url+'" action-type="'+h.type+'" require_id="'+g+'" >'+h.title+"</button></div>";
if(h.type==="new"){b("#search_box").append(n)}else{m+=n}}else{m+='<div style="float: left;"><button id="'+h.type.id+'" class="sp-button sp-grid-action"  require_id="'+g+'" >'+h.title+"</button></div>"
}}}if(o.exportable){var j=o.exportable_formats;if(typeof(o.exportable)=="object"){j=o.exportable.formats
}var c=j.length;if(c>0){var p="";for(var f=0;f<c;f++){p+='<option value="'+j[f].id+'">'+j[f].title+"</option>"
}m+='<div id="grid-export_'+o.name+'" style="position: absolute; background-color: none; height: 25px; right: 0px;"><select id="select-export" class="sp-button sp-grid-action" style="height: 20px;"><option value="">({{_("Export")}})</option>'+p+"</select></div>"
}}return m};a.prototype.loadActions=function(){var h=this;var g="";if(h.actions!=null){if(h.actions.length===undefined){var c=b.extend(true,{url:"{{tg.url('/dashboard/grid_actions/')}}",type:"post",data:{cls:h.cls},success:function(i){if(i.status){h.actions=i.actions
}b("#"+h.name+" .actions").html(h._loadActions(h.actions))}},h.actions);b.ajax(c)
}else{b("#"+h.name+" .actions").html(h._loadActions(h.actions));if(h.actions.length==0&&!h.exportable){b("#"+h.name+" .actions").css("min-height","0px")
}for(var j=0,f=h.actions.length;j<f;j++){var d=h.actions[j];if(typeof(d.type)=="object"){b("#"+d.type.id).data("_func",d.type.f);
b("#"+d.type.id).live("click",function(){if(b(this).attr("require_id")=="true"){var i=h.getSelectedIds();
if(i.length>0){b(this).data("_func")(i[0],i)}else{h.warningSelectedId()}}else{var i=h.getSelectedIds();
if(i.length>0){b(this).data("_func")(i[0],i)}else{b(this).data("_func")()}}})}}}}b("#"+h.name+" .sp-grid-cell").live("click",function(l){if(b(this).attr("clickable")=="true"){var i=b(this).parent().find(".sp-grid-rowid");
b("#"+h.name+" .sp-grid-rowid").each(function(){var m=l.ctrlKey||l.metaKey;if(b(this)!=i&&!h.multiselect&&!m){b(this).attr("checked",false)
}});if(i.attr("checked")==true){i.attr("checked",false)}else{i.attr("checked",true)
}}});b("#"+h.name+" .standard_action").live("click",function(m){function o(y,z){var i="";
if(z!="_blank"){var i=h.url_base+"?q="+encodeURI(h.q).replace("-","%2D","g").replace('"',"%22","g").replace("+","%2B","g").replace("#","%23","g")+"&rp="+h.rp+"&pag_n="+h.pag_n+"&ch_attr="+h.ch_attr+"&parent_id="+h.parent_id
}var l='<form type="post" action="'+y+'" target="'+z+'"><input type="hidden" name="came_from" value="'+i+'">';
if(h.ch_attr){l+='<input type="hidden" name="_'+h.ch_attr+'" value="'+h.parent_id+'">'
}l+="</form>";return l}var x=h.ch_attr;var t="";if(m.ctrlKey||m.metaKey){t="_blank"
}var n=b(this).attr("url");var v=b(this).attr("action-type");var w=b(this).attr("_func");
if(!w){var u=b(this).attr("url");if(u[u.length-1]!="/"){u+="/"}var q=h.getSelectedIds();
if(b(this).attr("require_id")=="true"){if(q.length>0){if(v=="delete"){h.std_delete(q,n)
}else{if(v=="process"){if(q.length==1){u+=q[0];b(o(u,t)).appendTo("body").submit().remove()
}else{var p=u;for(var s=0,r=q.length;s<r;s++){b(o(p+q[s],"_blank")).appendTo("body").submit().remove()
}}}else{if(q.length==1){u+=sprintf("%s/%s",h.cls,q[0]+"");b(o(u,t)).appendTo("body").submit().remove()
}else{u+=sprintf("%s/",h.cls);var p=u;for(var s=0,r=q.length;s<r;s++){b(o(p+q[s],"_blank")).appendTo("body").submit().remove()
}}}}}else{h.warningSelectedId()}}else{if(v=="new"){u+=sprintf("%s/",h.cls);b(o(u,t)).appendTo("body").submit().remove()
}else{if(v=="process"){if(q.length==1){u+=sprintf("%s/",q[0]+"");b(o(u,t)).appendTo("body").submit().remove()
}else{if(q.length>1){var p=u;for(var s=0,r=q.length;s<r;s++){b(o(p+q[s],"_blank")).appendTo("body").submit().remove()
}}else{b(o(u,t)).appendTo("body").submit().remove()}}}}}}else{w()}});b("#grid-export_"+h.name).live("change",function(){var o=b("#grid-export_"+h.name+" option:selected").val();
if(o==""){return}var m=h.exportable_formats;var t="";if(typeof(h.exportable)=="object"){m=h.exportable.formats;
if(h.exportable.data){for(k in h.exportable.data){var p=h.exportable.data[k];if(typeof(p)=="function"){p=p()
}t+='<input type="hidden" name="'+k+'" value="'+p+'">'}}}var r="";for(var s=0,n=m.length;
s<n;s++){if(m[s].id==o){r=m[s].url;break}}var q='<form action="'+r+'" method="get" ><input type="hidden" name="cls" value="'+h.cls+'"><input type="hidden" name="q" value="'+h.q+'"><input type="hidden" name="ch_attr" value="'+h.ch_attr+'"><input type="hidden" name="parent_id" value="'+h.parent_id+'">'+t+"</form>";
b(q).appendTo("body").submit().remove();b(this).find("option:first").attr("selected",true)
})};a.prototype.std_delete=function(h,g){var f=this;var d=f.cls;var l=JSON.stringify(h);
var i="<p id='delete-question'>{{_('Do you really want to delete this record?')}}</p><p id='object-title'></p>";
var c="<p id='delete-error-title'>{{_('Oops, something went wrong...')}}</p><div id='delete-error-message'></div>";
b("#grid-dialog_"+f.name).html(i);var j="";b.ajax({url:"/dashboard/title",type:"get",dataType:"json",data:{cls:d,id:l},success:function(m){if(m.status){var n;
if(typeof(m.title)=="string"){n=m.title}else{n=m.title.join(" | ")}b("#grid-dialog_"+f.name+" #object-title").html(n)
}},error:function(){}});b("#grid-dialog_"+f.name).dialog({width:650,height:210,resizable:false,modal:true,title:"{{_('Delete')}}",buttons:{"{{_('Ok')}}":function(){b.ajax({url:g,type:"get",dataType:"json",data:{cls:d,id_:l},success:function(n){if(n.status){f.search(f.q,true);
b("#grid-dialog_"+f.name).dialog("close")}else{b("#grid-dialog_"+f.name).dialog("close");
var o="<p style='color: gray;'>"+n.message+"</p>";if(n.rel_tables!=undefined&&n.rel_tables.length>0){o+="<div>{{_('For your information this object is related with other objects in the following classes:')}}</div>";
o+="<ul>";for(var m=0;m<n.rel_tables.length;m++){var q=n.rel_tables[m].class_title;
var p=n.rel_tables[m].attr_title;o+='<li><span style="font-weight: bold;">'+q+'</span> (<span style="color: gray;">'+p+"</span>)</li>"
}o+="</ul>"}b("#grid-dialog_"+f.name).html(c).find("#delete-error-message").html(o);
b("#grid-dialog_"+f.name).dialog({width:700,height:250,buttons:{"{{_('Close')}}":function(){b("#grid-dialog_"+f.name).dialog("close")
}}})}},error:function(){b("#grid-dialog_"+f.name).dialog("close");b("#grid-dialog_"+f.name).html(c).dialog({buttons:{"{{_('Close')}}":function(){b("#grid-dialog_"+f.name).dialog("close")
}}})}})},"{{_('Cancel')}}":function(){b("#grid-dialog_"+f.name).dialog("close")}}})
};b.fn.sapnsGrid=function(n,j,i){if(typeof(n)=="object"){var m=new a(n);this.data("sapnsGrid",m);
this.append('<div id="grid-dialog_'+m.name+'" style="display: none;"></div>');var u="";
u+='<div class="sp-grid-container" id="'+m.name+'" cls="'+m.cls+'">';if(m.caption){u+='<div class="sp-grid-caption">'+m.caption+"</div>"
}if(m.with_search){u+='<div><div id="search_box" style="float: left;"><input class="sp-search-txt" style="float: left;" name="q" type="text" value=""><button class="sp-button sp-search-btn" style="float: left;">{{_("Search...")}}</button></div>';
b("#"+m.name+" .sp-search-btn").live("click",function(){m.search(b("#"+m.name+" .sp-search-txt").val())
});b("#"+m.name+" .sp-search-txt").live("keypress",function(g){if(g.which==13){m.search(b(this).val())
}});if(m.link){u+="<div style=\"padding-left: 20px;\"><button id='link-shortcut' class='sp-button' style='float: left;'>{{_('Create a shortcut')}}</button><div style=\"font-size: 9px; margin-top: 7px; width: 100px; float: left;\"><a id='this-search' href='"+m.link+"' target='_blank'>[{{_('this search')}}]</a></div><div id=\"link-shortcut-dialog\" style=\"display: none;\"><p>{{_('Do you want to create a shortcut for this search?')}}</p><label>{{_('Shortcut title')}}:</label><input id='link-shortcut-title' type='text' value='({{_('title')}})'></div></div>"
}u+="</div>"}var p='<div class="sp-grid-parent" style="overflow: auto; clear: left; height: '+(m.height+5)+'px; background-color: transparent;"></div>';
var f="";if(m.with_pager){f+='<div class="sp-grid-pager">';f+='<div class="sp-grid-pager-desc"></div>';
var o="",h="",t="",r="";var d=" selected";var l="";if(m.rp==10){o=d}else{if(m.rp==50){h=d
}else{if(m.rp==100){t=d}else{if(m.rp==0){r=d}else{l='<option value="'+m.rp+'" selected>'+m.rp+"</option>"
}}}}f+='<select class="sp-button sp-grid-rp">'+l+'<option value="10"'+o+'>10</option><option value="50"'+h+'>50</option><option value="100"'+t+'>100</option><option value="0"'+r+'>{{_("All")}}</option></select><button class="sp-button first-page" style="float: left;">|&lt;&lt;</button><button class="sp-button page-back" style="float: left;">&lt;&lt;</button><div><input class="sp-grid-current-page" type="text" style="text-align: center;" readonly></div><button class="sp-button page-forth" style="float: left;">&gt;&gt</button><button class="sp-button last-page" style="float: left;">&gt;&gt|</button>';
f+="</div>";b("#"+m.name+" .sp-grid-rp").live("change",function(){m.rp=b(this).val();
m.pag_n=1;m.search(m.q)});b("#"+m.name+" .first-page").live("click",function(){m.pag_n=1;
m.search(m.q)});b("#"+m.name+" .page-back").live("click",function(){if(m.pag_n>1){m.pag_n-=1;
m.search(m.q)}});b("#"+m.name+" .page-forth").live("click",function(){if(m.pag_n<m.total_pag){m.pag_n*=1;
m.pag_n+=1;m.search(m.q)}});b("#"+m.name+" .last-page").live("click",function(){m.pag_n=m.total_pag;
m.search(m.q)})}this.append(u+'<div class="actions" style="clear: left; position: relative; min-height: 20px;"></div>'+p+f+"</div>");
m.loadActions();b("#"+m.name+" .sp-search-txt").val(m.q);m.search(m.q)}else{if(typeof(n)=="string"){var s=this.data("sapnsGrid");
if(n=="loadData"){s.loadData()}else{if(n=="search"){var c="";if(typeof(j)=="boolean"){c=s.q
}else{if(j){c=j}}if(s.with_search){b("#"+s.name+" .sp-search-txt").val(c)}s.search(c,true,i)
}else{if(n=="getSelectedIds"){return s.getSelectedIds()}else{if(n=="setRp"){s.rp=j;
b("#"+s.name+" .sp-grid-rp [value="+j+"]").attr("selected",true)}}}}}}return this
}})(jQuery);