var __DEFAULT_FILTER="default";(function(g){function b(h){this.field=g.trim(h.field);
this.operator=h.operator;this.value=g.trim(h.value);this.active=h.active!==undefined?!!h.active:true
}function a(h){h=g.trim(h.toLowerCase());h=h.replace(/[áäà]/g,"a");h=h.replace(/[éëè]/g,"e");
h=h.replace(/[íïì]/g,"i");h=h.replace(/[óöò]/g,"o");h=h.replace(/[úüù]/g,"u");h=h.replace(/[^a-z]/g,"");
return h}b.prototype={tip:function(){var h=this;return sprintf('&lt;%s&gt; %s "%s"',h.field,h.operator_title().toLowerCase(),h.value)
},operator_title:function(){var h={co:"{{_('Contains')}}",eq:"{{_('Equals to')}}",lt:"{{_('Less than')}}",gt:"{{_('Greater than')}}",let:"{{_('Less than or equals to')}}",get:"{{_('Greater than or equals to')}}",nco:"{{_('Does not contain')}}",neq:"{{_('Not equals to')}}"};
return h[this.operator]},toggle:function(){if(this.active){this.active=false}else{this.active=true
}},toString:function(){var i=this;var l=a(i.field);var j={co:"=",eq:"=",lt:"<",gt:">",let:"<=",get:">=",nco:"<>",neq:"<>"};
var m=j[i.operator];var h=i.value;if(i.operator=="eq"||i.operator=="neq"){if(h){h=sprintf('"%s"',h)
}else{if(i.operator=="eq"){return sprintf("!%s",l)}else{if(i.operator=="neq"){return sprintf("#%s",l)
}}}}else{if((i.operator=="co"||i.operator=="nco")&&!h){if(i.operator=="co"){return sprintf("!%s",l)
}else{if(i.operator=="nco"){return sprintf("#%s",l)}}}}return sprintf("%s%s%s",l,m,h)
},stringify:function(){return sprintf('%s"%s" %s "%s"',!this.active?"_":"",this.field,this.operator,this.value)
}};function f(o){var q=o.split(",");var p=[];for(var n=0,j=q.length;n<j;n++){var h=g.trim(q[n]).match('^(_)?"([^"]+)"\\s([a-z]{2,3})\\s"([^"]*)"$');
if(h){p.push(new b({field:h[2],operator:h[3],value:h[4],active:!h[1]}))}}return p
}function d(h){this.field=h.field;if(h.type=="+"){this.type="asc"}else{if(h.type=="-"){this.type="desc"
}else{this.type=h.type}}}d.prototype={toString:function(){var h=this;var j;if(h.type=="asc"){j="+"
}else{if(h.type=="desc"){j="-"}}var i=a(h.field);return sprintf("%s%s",j,i)},stringify:function(){var h=this;
var i;if(h.type=="asc"){i="+"}else{if(h.type=="desc"){i="-"}}return sprintf('%s"%s"',i,h.field)
}};function e(p){var q=p.split(",");var j=[];for(var o=0,n=q.length;o<n;o++){var h=g.trim(q[o]).match('^(\\+|\\-)"([^"]+)"$');
if(h){j.push(new d({field:h[2],type:h[1]}))}}return j}function c(l){var i=this;if(typeof(l.caption)==="function"){l.caption=l.caption()
}if(typeof(l.actions)==="function"){l.actions=l.actions()}var h=[{id:"csv",title:"CSV",url:"{{tg.url('/dashboard/tocsv/')}}"},{id:"excel",title:"Excel",url:"{{tg.url('/dashboard/toxls/')}}"}];
var j=l.pager_options;if(!j){j=[{val:10,desc:"10",sel:false},{val:50,desc:"50",sel:false},{val:100,desc:"100",sel:false},{val:0,desc:"{{_('All')}}",sel:false}]
}if(g.inArray(l.rp*1,[10,50,100,0])===-1){j.push({val:l.rp*1,desc:l.rp,sel:true})
}else{j[0].sel=true}j.sort(function(n,o){return n.val-o.val});var m=g.extend(true,{caption:"",name:"sapns_grid_"+Math.floor(Math.random()*999999),cls:"",with_search:true,with_filters:true,search_params:{},show_ids:false,link:"",q:"",user_filters:[],ch_attr:"",parent_id:"",cols:[],data:{},height:500,url_base:"",multiselect:false,allow_multiselect:true,actions:null,actions_inline:false,hide_check:false,hide_id:true,dblclick:null,select_first:false,shift_enabled:false,exportable:true,exportable_formats:h,with_pager:true,pag_n:1,rp:10,onLoad:null,resize:{min_width:90,after:null},default_:{col_width:60,col_align:"center",empty_value:""}},l);
g.extend(true,i,m);i.pager_options=j;i.this_page=0;i.total_count=0;i.total_pag=0;
i.ajx_data=JSON.stringify({});i.styles=[];i.setQuery(i.q);i._new_default={name:"new",url:'{{tg.url("/dashboard/new/")}}',require_id:"false",type:"new"};
i._edit_default={name:"edit",url:'{{tg.url("/dashboard/edit/")}}',require_id:"true",type:"edit"};
i._delete_default={name:"delete",url:'{{tg.url("/dashboard/delete/")}}',require_id:"true",type:"delete"};
i._docs_default={name:"docs",url:'{{tg.url("/docs/")}}',require_id:"true",type:"docs"}
}c.prototype.setQuery=function(j){var h=this;var i=j.split("$$");h.q=i[0];h.filters=[];
if(i.length>1){h.filters=f(i[1])}h.order=[];if(i.length>2){h.order=e(i[2])}if(i.length>3){h.current_user_filter=i[3]
}else{h.current_user_filter=__DEFAULT_FILTER}};c.prototype.getSelectedIds=function(){var h=this;
var i=[];g("#"+h.name+" .sp-grid-row").each(function(){var j=g(this).find(".sp-grid-rowid");
if(j.prop("checked")){i.push(j.attr("id_row")*1)}});return i};c.prototype.getAction=function(o){var m=this;
for(var n=0,j=m.actions.length;n<j;n++){var h=m.actions[n];if(typeof(h.type)==="object"){if(h.type.id===o){return h
}}else{if(h.name===o){return h}}}};c.prototype.getRow=function(j){var h=this;var i=null;
g("#"+h.name+" .sp-grid-row").each(function(){var l=g(this).find(".sp-grid-rowid");
if(l.attr("id_row")===j){i=l.parent();return}});return i};c.prototype.loadData=function(Q){var u=this;
var z=u.cols;if(typeof(z)==="function"){z=z()}var A=23;if(u.hide_check){A=-6}var C=z.length*42;
if(z[0].title!="id"){u.hide_check=true;u.hide_id=true;u.actions_inline=false}if(!u.hide_check){C+=23
}if(!u.hide_id){C+=60}var x=905;if(C<x){C=x}var N="";for(var V=0,T=z.length;V<T;V++){var t=z[V];
if(t.title!="id"){N+='<option value="'+t.title+'">'+t.title+"</option>"}if(u.hide_id&&t.title==="id"){continue
}A+=(t.width+5)}g("#"+u.name+" .sp-grid-filter-field").html(N);var O='<div class="sp-grid" style="width:'+(A+200)+'px">';
var I='<div class="sp-grid-row" style="width:'+(A+150)+'px">';if(!u.hide_check){var M="";
if(!u.allow_multiselect){M="disabled"}I+='<div class="sp-col-title" style="width:23px">                <input class="sp-grid-select-all" type="checkbox" '+M+"></div>"
}if(u.actions_inline){I+='<div class="sp-col-title" style="%(actions_wd)s">*</div>'
}var D={};for(var V=0,T=u.order.length;V<T;V++){var R=u.order[V];R.index=V+1;D[u.order[V].field]=R
}for(var V=0,T=z.length;V<T;V++){var t=z[V];var q=t.width;if(!q){q=u.default_.col_width
}if(u.hide_id&&t.title==="id"){continue}var w="";var F="";var K="";if(D[t.title]){var R=D[t.title];
w="sp-grid-ordered-col";F=' order_type="'+R.type+'"';var H;if(R.type==="asc"){H="+"
}else{H="-"}K=" ("+R.index+H+")"}I+='<div class="sp-col-title sp-col-title-sortable '+w+'"'+F+' col_num="'+V+'" style="width:'+q+'px" col_title="'+t.title+'">'+t.title+K+"</div>"
}I+="</div>";var W=u.data;if(typeof(W)==="function"){W=W()}var P=W.length;if(P>0){for(var V=0;
V<P;V++){var y=W[V];var B="";if(u.styles.length&&u.styles.length>V){B=u.styles[V]
}var E='<div class="sp-grid-row" style="width:'+(A+150)+'px">';if(!u.hide_check){var m="";
if(V===P-1){m="border-radius:0 0 0 5px"}E+='<div class="sp-grid-cell" title="'+y[0]+'" style="width:23px;'+m+'"><input class="sp-grid-rowid" type="checkbox" id_row="'+y[0]+'"></div>'
}if(u.actions_inline){var r="width:107px";if(!u.nonstd){r="width:82px"}var s='<div class="sp-grid-cell" style="%(actions_wd)s">                        <img class="inline_action edit_inline" title="{{_("Edit")}}"                             src="{{tg.url("/images/sapns/icons/edit.png")}}">                        <img class="inline_action delete_inline" title="{{_("Delete")}}"                             src="{{tg.url("/images/sapns/icons/delete.png")}}">                        <img class="inline_action docs_inline" title="{{_("Docs")}}"                             src="{{tg.url("/images/sapns/icons/docs.png")}}">';
E+=sprintf(s,{actions_wd:r})+u.nonstd+"</div>"}if(V===0){O+=sprintf(I,{actions_wd:r})
}for(var U=0,G=z.length;U<G;U++){var t=z[U];var v=t.align;if(!v){v=u.default_.col_align
}var q=t.width;if(!q){q=u.default_.col_width}var J=y[U];if(!J){J=u.default_.empty_value
}if(u.hide_id&&t.title=="id"){continue}var h="";if(q>0){h=" width:"+q+"px;"}var m="";
if((u.hide_check&&V==P-1)&&(!u.hide_id&&U==0||u.hide_id&&U==1)){m="border-radius:0 0 0 5px;"
}if(V==P-1&&U==G-1){m="border-radius:0 0 5px 0;"}E+='<div class="sp-grid-cell sp-grid-cell-tip clickable '+B+'"                         col_num="'+U+'" style="text-align:'+v+";"+h+m+'"';
if(J){E+=sprintf('title="%s"',J.replace(/"/gi,"''"))}else{E+='title="({{_("empty")}})"'
}E+=">"+J+"</div>"}E+="</div>";O+=E}}else{var S=1;var L=A;if(u.actions_inline){S=3;
L+=25}O+=sprintf(I,{actions_wd:r})+'<div class="sp-grid-row"><div class="sp-grid-cell sp-grid-noresults" title="{{_("No results")}}" style="width:'+L+'px" >{{_("No results")}}</div></div>'
}O+="</div>";g("#"+u.name).find(".sp-grid-parent").html(O);g(".sp-col-title-sortable").disableSelection();
if(u.select_first&&u.with_search&&u.q&&P<5&&P>0){g("#"+u.name+" .sp-grid-rowid:first").prop("checked",true)
}var p="#"+u.name;g(p+" .sp-col-title-sortable").resizable({handles:"e",minWidth:u.resize.min_width,resize:function(o,n){var j=n.element.width(),X=n.element.attr("col_num"),l=g(p+" .sp-grid-row").width(),i=g(p+" .sp-grid-cell[col_num="+X+"]").width();
g(p+" .sp-grid-cell[col_num="+X+"]").width(j);g(p+" .sp-grid-row").width(l+(j-i))
},stop:function(l,j){var n=j.element.attr("col_num");if(u.resize.after){u.resize.after(n*1)
}else{var i=u.cols.length;if(u.cols[0].title==="id"){i-=1}g.ajax({url:"{{tg.url('/dashboard/save_col_width/')}}",data:{cls:u.cls,length:i,col_num:n,width:j.element.width()},success:function(o){if(o.status){}}})
}}});if(Q){Q()}};c.prototype.query=function(){var h=this;var j=h.q;var i=g.map(h.filters,function(l){if(l.active){return l
}});if(i.length){if(j){j=j+", "+i.join(", ")}else{j=i.join(", ")}}if(h.order.length){if(j){j=j+", "+h.order.join(", ")
}else{j=h.order.join(", ")}}return j};c.prototype.query_=function(){var j=this,n=j.q+"$$";
for(var m=0,h=j.filters.length;m<h;m++){if(m>0){n+=", "}n+=j.filters[m].stringify()
}n+="$$";for(var m=0,h=j.order.length;m<h;m++){if(m>0){n+=", "}n+=j.order[m].stringify()
}if(j.current_user_filter!==__DEFAULT_FILTER){n+="$$"+j.current_user_filter}return n
};c.prototype.search=function(n,m,l){var j=this;if(m===undefined){m=false}if(n===undefined){n=j.q
}if(j.q!=n||m){j.pag_n=1}j.q=n;j.filters_tip();var n=j.query();var o=sprintf('<div class="sp-grid-loading" style="height:%(hg)dpx">{{_("Loading")}}...</div>',{hg:j.height-50});
g("#"+j.name).find(".sp-grid-parent").html(o);var i=g.extend(true,{url:"{{tg.url('/dashboard/grid/')}}",cache:false,data:{cls:j.cls,q:n,rp:j.rp,pag_n:j.pag_n,ch_attr:j.ch_attr,parent_id:j.parent_id},success:function(q){if(q.status){if(q.this_page){j.this_page=q.this_page
}if(q.total_count){j.total_count=q.total_count}if(q.total_pag){j.total_pag=q.total_pag
}if(q.cols){j.cols=q.cols}if(q.actions){j.actions=q.actions}if(q.styles){j.styles=q.styles
}var v=(j.pag_n-1)*j.rp*1;var u={curr_page:j.pag_n*1,total_page:j.total_pag*1,pos0:v+1,pos1:v+j.this_page};
var s=sprintf("{{_('Page %(curr_page)d of %(total_page)d / Showing rows %(pos0)d to %(pos1)d')}}",u);
g("#"+j.name+" .sp-grid-first-page").attr("title","{{_('page 1')}}");if(u.curr_page>1){var p=sprintf("{{_('page %(p)d')}}",{p:u.curr_page-1});
g("#"+j.name+" .sp-grid-page-back").attr("title",p).prop("disabled",false)}else{g("#"+j.name+" .sp-grid-page-back").prop("disabled",true)
}if(u.curr_page<u.total_page){var t=sprintf("{{_('page %(p)d')}}",{p:u.curr_page+1});
g("#"+j.name+" .sp-grid-page-forth").attr("title",t).prop("disabled",false)}else{g("#"+j.name+" .sp-grid-page-forth").prop("disabled",true)
}g("#"+j.name+" .sp-search-txt").focus();var r=sprintf("{{_('page %(p)d')}}",{p:u.total_page});
g("#"+j.name+" .sp-grid-last-page").attr("title",r);g("#"+j.name+" .sp-grid-current-page").val(j.pag_n);
j.data=q.data;j.loadData(function(){g(".sp-grid-cell-tip, .edit_inline, .delete_inline, .docs_inline, .new_inline, .sp-grid-save-filter").qtip({content:{text:true},position:{my:"top left",at:"bottom center"},style:"ui-tooltip-rounded"})
});if(l){l(q)}if(j.onLoad){j.onLoad(q)}}}},j.search_params);var h=JSON.stringify(i.data);
if(j.ajx_data){if(j.ajx_data===h&&!m){j.loadData()}else{g.ajax(i)}}j.ajx_data=h};
c.prototype.warningSelectedId=function(){var h=this;g("#grid-dialog_"+h.name).html("<p style='text-align:center;font-style:italic'>{{_('You must select a row before click on this action')}}</p>").dialog({title:h.caption,resizable:false,height:155,width:450,modal:true,draggable:false,buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+h.name).dialog("close")
}}});g(".ui-icon-closethick").hide()};c.prototype._loadActions=function(m){var w=this;
var u="";w.nonstd="";var q='<button id="%(id)s" class="sp-grid-button-action">%(title)s</button>';
var v='<option value="%(id)s">%(title)s</option>';if(m.length>0){u="";for(var n=0,h=m.length;
n<h;n++){var s=m[n];var o=s.require_id;if(o===undefined){o=true}if(typeof(s.type)==="string"&&s.type==="new"){var r='<img class="inline_action new_inline" title="{{_("New")}}" src="{{tg.url("/images/sapns/icons/new.png")}}">';
g("#"+w.name+" .sp-grid-search-box").append(r)}else{if(!w.actions_inline){g("#"+w.name+" .sp-grid-button-actions").show();
var y;if(typeof(s.type)=="object"){y={id:s.type.id,title:s.title}}else{y={id:s.name,title:s.title}
}g("#"+w.name+" .sp-grid-button-actions").append(sprintf(q,y))}else{if(w.actions_inline){if(typeof(s.type)==="string"&&(s.type=="edit"||s.type=="delete"||s.type=="docs")){continue
}else{var j;if(typeof(s.type)=="object"){j={id:s.type.id,title:s.title}}else{j={id:s.name,title:s.title}
}w.nonstd+=sprintf(v,j)}}}}}if(w.nonstd){w.nonstd='<select class="nonstd_actions"><option value=""></option>'+w.nonstd+"</select>"
}}if(w.exportable){var t=w.exportable_formats;if(typeof(w.exportable)=="object"){t=w.exportable.formats
}var h=t.length;if(h>0){var x="";for(var n=0;n<h;n++){x+='<option value="'+t[n].id+'">'+t[n].title+"</option>"
}var p='<div class="export">                    <select class="sp-button sp-grid-action">                    <option value="">({{_("Export")}})</option>'+x+"</select></div>";
g("#"+w.name+" .sp-grid-search-box").append(p)}}return u};c.prototype.complete_actions=function(){var m=this;
for(var n=0,j=m.actions.length;n<j;n++){var h=m.actions[n];if(typeof(h.type)==="string"){if(h.type==="new"){m.actions[n]=g.extend(m._new_default,h)
}else{if(h.type==="edit"){m.actions[n]=g.extend(m._edit_default,h)}else{if(h.type==="delete"){m.actions[n]=g.extend(m._delete_default,h)
}else{if(h.type==="docs"){m.actions[n]=g.extend(m._docs_default,h)}}}}}}};c.prototype.loadActions=function(j){var r=this;
var o="";var m=sprintf("#%s .actions",r.name);if(r.actions!=null){if(r.actions.length===undefined){var i=g.extend(true,{url:"{{tg.url('/dashboard/grid_actions/')}}",cache:false,data:{cls:r.cls},success:function(A){if(A.status){r.actions=A.actions
}g(m).html(r._loadActions(r.actions));if(j){j()}}},r.actions);g.ajax(i)}else{g(m).html(r._loadActions(r.actions));
if(j){j()}}}else{if(j){j()}}var l=sprintf("#%s .sp-grid-cell.clickable",r.name),s=sprintf("#%s .sp-grid-cell .sp-grid-rowid:checked",r.name);
g(document).off("click",l).on("click",l,function(B){var C=(B.ctrlKey||B.metaKey)&&r.allow_multiselect;
var A=g(this).parent().find(".sp-grid-rowid");if(!A.prop("checked")||C||(r.multiselect&&r.allow_multiselect)){g("#"+r.name+" .sp-grid-select-all").prop("checked",false);
g("#"+r.name+" .sp-grid-rowid").each(function(){if(g(this)!=A&&!r.multiselect&&!C){g(this).prop("checked",false);
g(this).parent().parent().removeClass("sp-grid-row-selected")}});if(A.prop("checked")){A.prop("checked",false);
g(this).parent().removeClass("sp-grid-row-selected")}else{A.prop("checked",true);
g(this).parent().addClass("sp-grid-row-selected")}}else{if(r.dblclick){p(A.attr("id_row")*1,r.dblclick,B.ctrlKey||B.metaKey,B.shiftKey)
}}});var t=sprintf("#%s .sp-grid-cell .sp-grid-rowid",r.name);g(document).off("click",t).on("click",t,function(){var A=g(this).prop("checked");
if(!r.allow_multiselect){g(t).prop("checked",false);g(this).prop("checked",A)}});
function h(D,E){var B=r.query_();B=encodeURI(B).replace("-","%2D","g").replace('"',"%22","g").replace("+","%2B","g").replace("#","%23","g");
var A="";if(E!="_blank"){var A=r.url_base+"?q="+B+"&rp="+r.rp+"&pag_n="+r.pag_n+"&ch_attr="+r.ch_attr+"&parent_id="+r.parent_id
}var C='<form type="post" action="'+D+'" target="'+E+'"><input type="hidden" name="came_from" value="'+A+'">';
if(r.ch_attr){C+='<input type="hidden" name="_'+r.ch_attr+'" value="'+r.parent_id+'">'
}C+="</form>";return C}function w(G,H,P,C,N){if(typeof(P.type)==="string"){if(N&&r.shift_enabled){if(P.type==="new"){P=r._new_default
}else{if(P.type==="edit"){P=r._edit_default}else{if(P.type==="delete"){P=r._delete_default
}else{if(P.type==="docs"){P=r._docs_default}}}}}var S=P.url;if(S[S.length-1]!="/"){S+="/"
}if(!P.data){var T="";if(C){T="_blank"}if(P.type==="process"){if(P.require_id){if(G){S+=G
}else{r.warningSelectedId();return}}else{if(G){S+=G}}}else{if(P.type==="new"){S+=sprintf("%s/",r.cls)
}else{if(P.type==="delete"){r.std_delete(H,P.url);return}else{if(P.require_id){if(G){S+=sprintf("%s/%s",r.cls,G)
}else{r.warningSelectedId();return}}else{if(G){S+=sprintf("%s/%s",r.cls,G)}else{S+=sprintf("%s/",r.cls)
}}}}}g(h(S,T)).appendTo("body").submit().remove()}else{var U=JSON.parse(P.data),M=false;
var Q={};Q[U.param_name]=G;var B="{{_('Ok')}}";if(U.button_title){B=U.button_title
}var A=true;if(U.refresh!==undefined){A=U.refresh}var E=r.name+"_dialog";g("#"+E).remove();
g('<div id="'+E+'" style="display:none"></div>').appendTo("body");var L=[];if(U.buttons===undefined){U.buttons=[{button_title:B,callback:U.callback,refresh:A}]
}var D=function(F){var V=this;V.b=F;V.call=function(){if(!M){M=true;window[V.b.callback](function(){if(V.b.refresh){r.search(r.q,true)
}g("#"+E).dialog("close")},function(){M=false})}}};for(var K=0,I=U.buttons.length;
K<I;K++){var R=U.buttons[K],O=new D(R);L.push({text:R.button_title,click:O.call})
}L.push({text:"{{_('Cancel')}}",click:function(){if(!M){g("#"+E).dialog("close")}}});
g.ajax({url:S,data:Q,success:function(F){g("#"+E).html(F).dialog({title:P.title,modal:true,resizable:false,width:U.width,height:U.height,closeOnEscape:false,buttons:L,})
}})}}else{var J=H;if(P.require_id){if(J.length>0){P.type.f(J[0],J)}else{r.warningSelectedId();
return}}else{if(J.length>0){P.type.f(J[0],J)}else{P.type.f()}}}}function p(C,E,D,B){var A=r.getAction(E);
if(typeof(C)!=="number"){var F=C.parent().parent().find(".sp-grid-rowid").attr("id_row")
}else{var F=C}w(F,[],A,D,B)}var q=sprintf("#%s .new_inline",r.name);g(document).off("click",q).on("click",q,function(A){p(g(this),"new",A.ctrlKey||A.metaKey,A.shiftKey)
});if(r.actions_inline){var v=sprintf("#%s .edit_inline",r.name);g(document).off("click",v).on("click",v,function(A){p(g(this),"edit",A.ctrlKey||A.metaKey,A.shiftKey)
});var z=sprintf("#%s .delete_inline",r.name);g(document).off("click",z).on("click",z,function(C){var B=r.getSelectedIds();
if(B.length==0){var D=g(this).parent().parent().find(".sp-grid-rowid").attr("id_row");
B=[D]}var A=r.getAction("delete");r.std_delete(B,A.url)});var y=sprintf("#%s .docs_inline",r.name);
g(document).off("click",y).on("click",y,function(A){p(g(this),"docs",false,A.shiftKey)
});var n=sprintf("#%s .nonstd_actions",r.name);g(document).off("change",n).on("change",n,function(B){var A=g(this).val();
if(A){p(g(this),A);g(n).val("")}})}else{var x=sprintf("#%s .sp-grid-button-action",r.name);
g(document).off("click",x).on("click",x,function(B){var A=r.getAction(g(this).attr("id"));
var C=r.getSelectedIds();w(C[0],C,A,B.ctrlKey||B.metaKey,B.shiftKey)})}var u=sprintf("#%s .export select",r.name);
g(document).on("change",u,function(){var C=g(u).val();if(C==""){return}var A=r.exportable_formats;
var H="";if(typeof(r.exportable)==="object"){A=r.exportable.formats;if(r.exportable.data){for(k in r.exportable.data){var D=r.exportable.data[k];
if(typeof(D)==="function"){D=D()}H+='<input type="hidden" name="'+k+'" value="'+D+'">'
}}}var F="";for(var G=0,B=A.length;G<B;G++){if(A[G].id==C){F=A[G].url;break}}var E='<form action="'+F+'" method="get">                <input type="hidden" name="cls" value="'+r.cls+'">                <input type="hidden" name="q" value="'+r.query()+'">                <input type="hidden" name="ch_attr" value="'+r.ch_attr+'">                <input type="hidden" name="parent_id" value="'+r.parent_id+'">'+H+"</form>";
g(E).appendTo("body").submit().remove();g(this).find("option:first").prop("selected",true)
})};c.prototype.std_delete=function(i,j){var p=this,q=p.cls,o=false;var l=JSON.stringify(i);
var h="<p id='delete-question'>{{_('Do you really want to delete this record?')}}</p><p id='object-title'></p><div class='wait-message' style='display:none'>{{_('Wait, please')}}...</div>";
var m="<p id='delete-error-title'>{{_('Oops, something went wrong...')}}</p><div id='delete-error-message'></div>";
g("#grid-dialog_"+p.name).html(h);var n="";g.ajax({url:"{{tg.url('/dashboard/title/')}}",data:{cls:q,id:l},success:function(r){if(r.status){var s;
if(typeof(r.title)==="string"){s=r.title}else{s=r.title.join(" | ")}g("#grid-dialog_"+p.name+" #object-title").html(s)
}},error:function(){}});g("#grid-dialog_"+p.name).dialog({title:"{{_('Delete')}}",modal:true,resizable:false,closeOnEscape:false,width:650,height:210,buttons:{"{{_('Ok')}}":function(){if(!o){o=true;
g("#grid-dialog_"+p.name+" .wait-message").fadeIn();g.ajax({url:j,data:{cls:q,id_:l},dataType:"json",success:function(s){o=false;
g("#grid-dialog_"+p.name+" .wait-message").fadeOut();if(s.status){p.search(p.q,true);
g("#grid-dialog_"+p.name).dialog("close")}else{g("#grid-dialog_"+p.name).dialog("close");
var t="<p style='color:#777'>"+s.message+"</p>";if(s.rel_tables!=undefined&&s.rel_tables.length>0){t+="<div>{{_('For your information this object is related with other objects in the following classes:')}}</div>";
t+="<ul>";for(var r=0;r<s.rel_tables.length;r++){var v=s.rel_tables[r].class_title;
var u=s.rel_tables[r].attr_title;t+='<li><span style="font-weight:bold">'+v+'</span> (<span style="color:#777">'+u+"</span>)</li>"
}t+="</ul>"}g("#grid-dialog_"+p.name).html(m).find("#delete-error-message").html(t);
g("#grid-dialog_"+p.name).dialog({width:700,height:250,buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+p.name).dialog("close")
}}})}},error:function(){o=false;g("#grid-dialog_"+p.name).dialog("close");g("#grid-dialog_"+p.name).html(m).dialog({buttons:{"{{_('Close')}}":function(){g("#grid-dialog_"+p.name).dialog("close")
}}})}})}},"{{_('Cancel')}}":function(){if(!o){g("#grid-dialog_"+p.name).dialog("close")
}}}})};c.prototype.selectAll=function(h){var i=this;if(h===undefined){h=true}g("#"+i.name+" .sp-grid-rowid").prop("checked",h)
};c.prototype.filters_tip=function(){var h=this;g("#"+h.name+" .sp-search-btn").qtip({content:{text:function(){var n="";
if(h.filters.length){for(var m=0,j=h.filters.length;m<j;m++){if(!h.filters[m].active){n+='<font style="text-decoration:line-through">'+h.filters[m].tip()+"</font><br>"
}else{n+=h.filters[m].tip()+"<br>"}}}else{n="No hay filtros"}return n}},position:{at:"top right",my:"bottom left"},style:"ui-tooltip-rounded"});
if(h.filters.length){g("#"+h.name+" .sp-search-btn").css("border-color","orange")
}else{g("#"+h.name+" .sp-search-btn").css("border-color","")}};g.fn.sapnsGrid=function(B,z,x){if(typeof(B)==="object"){var N=new c(B);
this.data("sapnsGrid",N);var y="#"+N.name;this.append(sprintf('<div id="grid-dialog_%(name)s" class="sp-grid-dialog" style="display:none"></div>',{name:N.name}));
var I="";I+=sprintf('<div class="sp-grid-container" id="%(name)s" cls="%(cls)s">',{name:N.name,cls:N.cls});
if(N.caption){I+=sprintf('<div class="sp-grid-caption">%(caption)s</div>',{caption:N.caption})
}if(N.with_search){I+='<div><div class="sp-grid-search-box">                    <input class="sp-search-txt" name="q" type="text" value="">                    <img class="inline_action sp-search-btn"                         src="{{tg.url("/images/sapns/icons/search.png")}}" title="{{_("Search...")}}">';
if(N.with_filters){var m="";for(var K=0,H=N.user_filters.length;K<H;K++){var O=N.user_filters[K],E="";
if(N.current_user_filter==O.name){E=" selected"}m+='<option value="'+O.name+'"'+E+">"+O.name+"</option>"
}I+='<img class="inline_action sp-grid-save-filter"                             src="{{tg.url("/images/sapns/icons/filters.png")}}" title="{{_("Manage filter")}}">                        <select class="sp-grid-action sp-button sp-grid-select-filter">'+m+"</select>"
}I+="</div>";I+='<div class="sp-grid-filters" style="display:none"></div>';I+='<div class="sp-grid-edit-filter" style="display:none">                    <div style="float:left;height:40px;margin-right:5px">                        <div class="sp-grid-filter-label">{{_("Field")}}</div>                        <div><select class="sp-grid-filter-field"></select></div>                    </div>                    <div style="float:left;height:40px;margin-right:5px">                        <div class="sp-grid-filter-label">{{_("Operator")}}</div>                        <div><select class="sp-grid-filter-operator">                            <option value="co">{{_("Contains")}}</option>                            <option value="eq">{{_("Equals to")}}</option>                            <option value="lt">{{_("Less than")}}</option>                            <option value="gt">{{_("Greater than")}}</option>                            <option value="let">{{_("Less than or equals to")}}</option>                            <option value="get">{{_("Greater than or equals to")}}</option>                            <option value="nco">{{_("Does not contain")}}</option>                            <option value="neq">{{_("Not equals to")}}</option>                        </select></div>                    </div>                    <div style="float:left;height:40px">                        <div class="sp-grid-filter-label">{{_("Value")}}</div>                        <input class="sp-grid-filter-value" type="text">                        <select class="sp-grid-filter-functions">                            <option value="">({{_("date functions")}})</option>                            <option value="{today}">{{_("Today")}}</option>                            <option value="{today - 1}">{{_("Yesterday")}}</option>                            <option value="{today + 1}">{{_("Tomorrow")}}</option>                            <option value="{start_week}">{{_("Start week")}}</option>                            <option value="{end_week}">{{_("End week")}}</option>                            <option value="{start_month}">{{_("Start month")}}</option>                            <option value="{end_month}">{{_("End month")}}</option>                            <option value="{start_year}">{{_("Start year")}}</option>                            <option value="{end_year}">{{_("End year")}}</option>                        </select>                    </div></div>';
var s=".sp-grid-activate-filter, .sp-grid-deactivate-filter";var j=".sp-grid-filter-value";
g(document).off("keypress",j).on("keypress",j,function(i){if(i.which===13){g(this).parents(".ui-dialog").find(".ui-dialog-buttonset button:first").click()
}});var j=".sp-grid-filter-functions";g(document).off("change",j).on("change",j,function(){var i=g(this).val();
g(this).parent().find(".sp-grid-filter-value").val(i)});var j=".sp-grid-row-filter button";
g(document).off("click",j).on("click",j,function(){var l=g(this).parent().attr("filter_order");
var q=N.filters[l];if(q.active){g(this).parent().removeClass("active").addClass("inactive");
g(this).text("{{_('Activate')}}")}else{g(this).parent().removeClass("inactive").addClass("active");
g(this).text("{{_('Deactivate')}}")}g(this).addClass("sp-grid-filter-changed");q.toggle()
});var P=y+" .sp-search-btn";g(document).off("click",P).on("click",P,function(){function l(){var T="",q=N.filters.length;
if(q){for(var R=0;R<q;R++){var U=N.filters[R];var Q="",S="active";if(U.active){Q='<button>{{_("Deactivate")}}</button>'
}else{S="inactive";Q='<button>{{_("Activate")}}</button>'}T+='<div class="sp-grid-row-filter '+S+'" style="clear:left" filter_order="'+R+'">                                    <div style="float:left;margin-right:10px"><input class="sp-grid-check-filter" type="checkbox"></div>                                    <div class="sp-grid-filter-description"><span class="col">&lt;'+U.field+'&gt;</span>                                     <span class="operator">'+U.operator_title().toLowerCase()+'</span>                                    <span class="value">"'+U.value+'"</span></div>'+Q+"</div>"
}}else{T='<p class="sp-grid-no-filters">{{_("There are no filters")}}</p>'}g(y+" .sp-grid-filters").html(T)
}l();function i(q,Q){g("<div/>").html(g(y+" .sp-grid-edit-filter").html()).dialog({title:"{{_('Edit filter')}}",modal:true,resizable:false,width:700,height:150,open:function(){if(q){g(this).find(".sp-grid-filter-field").val(q.field);
g(this).find(".sp-grid-filter-operator").val(q.operator);g(this).find(".sp-grid-filter-value").val(q.value)
}},buttons:{"{{_('Ok')}}":function(){var R=this;if(!q){q=new b({field:g(this).find(".sp-grid-filter-field").val(),operator:g(this).find(".sp-grid-filter-operator").val(),value:g(this).find(".sp-grid-filter-value").val()});
N.filters.push(q)}else{q.field=g(this).find(".sp-grid-filter-field").val();q.operator=g(this).find(".sp-grid-filter-operator").val();
q.value=g(this).find(".sp-grid-filter-value").val()}N.search(g(y+" .sp-search-txt").val(),true);
g(this).dialog("destroy").remove();if(Q){Q()}},"{{_('Cancel')}}":function(){g(this).dialog("destroy").remove()
}}})}g("<div/>").html(g(y+" .sp-grid-filters").html()).dialog({title:"Filtros",modal:true,resizable:false,width:600,height:300,closeOnEscape:false,open:function(){var q=g(this);
i(null,function(){q.dialog("destroy").remove()})},buttons:{"{{_('Add')}}":function(){var q=g(this);
i(null,function(){q.dialog("destroy").remove()})},"{{_('Edit')}}":function(){var q=g(this).find(".sp-grid-row-filter input[type=checkbox]:visible:checked:first").parent().parent().attr("filter_order");
var Q=g(this);i(N.filters[q],function(){Q.dialog("destroy").remove()});N.search(g(y+" .sp-search-txt").val(),true)
},"{{_('Remove')}}":function(){var R=[];g(this).find(".sp-grid-row-filter input[type=checkbox]:visible:checked").each(function(){R.push(g(this).parent().parent().attr("filter_order")*1)
});R=R.reverse();for(var Q=0,q=R.length;Q<q;Q++){N.filters.splice(R[Q],1)}N.search(g(y+" .sp-search-txt").val(),true);
g(this).dialog("destroy").remove()},"{{_('Remove all')}}":function(){N.filters=[];
N.search(g(y+" .sp-search-txt").val(),true);g(this).dialog("destroy").remove()},"{{_('Close')}}":function(){if(g(".sp-grid-filter-changed").length){g(".sp-grid-filter-changed").removeClass("sp-grid-filter-changed");
N.search(g(y+" .sp-search-txt").val(),true)}g(this).dialog("destroy").remove()}}})
});var F=y+" .sp-search-txt";g(document).off("keypress",F).on("keypress",F,function(i){if(i.which===13){N.search(g(this).val())
}});var n=y+" .sp-grid-select-filter";g(document).off("change",n).on("change",n,function(){var T=g(this).val(),S="";
for(var Q=0,q=N.user_filters.length;Q<q;Q++){var R=N.user_filters[Q];if(R.name===T){N.setQuery(R.query);
N.current_user_filter=T;N.search(N.query_().split("$$")[0],true);return}}});var J=y+" .sp-grid-save-filter";
g(document).off("click",J).on("click",J,function(){var q=N.query_(),l=g(n).val(),i=false,Q='<div id="sp-grid-save-filter-dialog" style="display:none">                            <div class="sp-field-row">                                <div class="sp-field">                                    <div class="label">{{_("Filter name")}}</div>                                    <input id="sp-grid-filter-name" type="text" value="'+l+'">                                </div>                            </div>                        </div>';
g("#sp-grid-save-filter-dialog").remove();g(Q).appendTo("body").dialog({title:"{{_('Save filter')}}",modal:true,resizable:false,width:400,height:"auto",buttons:{"{{_('Create or Modify')}}":function(){if(!i){i=true;
var R=g("#sp-grid-filter-name").val().replace(/[^A-Za-z0-9_]/g,"_");g.ajax({url:"{{tg.url('/dashboard/save_user_filter/')}}",data:{cls:N.cls,filter_name:R,query:q},success:function(U){if(U.status){var V=false;
for(var T=0,S=N.user_filters.length;T<S;T++){var W=N.user_filters[T];if(W.name===R){W.query=q;
V=true}}if(!V){N.user_filters.push({name:R,query:q});g(n).append('<option value="'+R+'">'+R+"</option>");
g(n).val(R)}g("#sp-grid-save-filter-dialog").dialog("close")}else{if(U.msg){console.log(U.msg)
}i=false;alert("Error!")}},error:function(){i=false;alert("Error!")}})}},"{{_('Delete')}}":function(){if(!i){var R=g("#sp-grid-filter-name").val();
i=true;g.ajax({url:"{{tg.url('/dashboard/delete_user_filter/')}}",data:{cls:N.cls,filter_name:R},success:function(V){if(V.status){g(n).val("default").change();
g(n+" option[value="+R+"]").remove();var U=[];for(var T=0,S=N.user_filters.length;
T<S;T++){var W=N.user_filters[T];if(W.name!==R){U.push(W)}}N.user_filters=U;g("#sp-grid-save-filter-dialog").dialog("close")
}else{i=false;alert("Error!")}},error:function(){i=false;alert("Error!")}})}},"{{_('Cancel')}}":function(){if(!i){g("#sp-grid-save-filter-dialog").dialog("close")
}}}})});I+="</div>"}var M='<div class="sp-grid-parent" style="overflow:auto;clear:left;height:'+(N.height+5)+'px;background-color:transparent"></div>';
var v="";if(N.with_pager){v+='<div class="sp-grid-pager">                    <div class="sp-grid-pager-desc"></div>';
var G="";for(var K=0,H=N.pager_options.length;K<H;K++){var A=N.pager_options[K];var E="";
if(A.sel){E=" selected "}G+='<option value="'+A.val+'"'+E+">"+A.desc+"</option>"}v+='<div style="float:left;clear:right;height:25px;margin-top:2px"><select class="sp-button sp-grid-rp">'+G+'</select><button class="sp-button sp-grid-first-page" style="float:left">|&lt;&lt;</button><button class="sp-button sp-grid-page-back" style="float:left">&lt;&lt;</button><input class="sp-grid-current-page" type="text" style="text-align:center;font-size:11px;margin-top:3px" readonly><button class="sp-button sp-grid-page-forth" style="float:left">&gt;&gt</button>';
v+="</div>";var w=y+" .sp-grid-select-all",t=y+" .sp-grid-rp",r=y+" .sp-grid-first-page",p=y+" .sp-grid-page-back",o=y+" .sp-grid-page-forth",h=y+" .sp-grid-last-page";
g(document).off("click",w).on("click",w,function(){var i=g(this).prop("checked");
N.selectAll(i)});g(document).off("change",t).on("change",t,function(){N.rp=g(this).val();
N.pag_n=1;N.search(N.q)});g(document).off("click",r).on("click",r,function(){N.pag_n=1;
N.search(N.q)});g(document).off("click",p).on("click",p,function(){if(N.pag_n>1){N.pag_n-=1;
N.search(N.q)}});g(document).off("click",o).on("click",o,function(){if(N.pag_n<N.total_pag){N.pag_n*=1;
N.pag_n+=1;N.search(N.q)}});g(document).off("click",h).on("click",h,function(){N.pag_n=N.total_pag;
N.search(N.q)})}var L=y+" .sp-col-title-sortable";g(document).off("click",L).on("click",L,function(T){var V=g(this).attr("col_title");
var Q=T.shiftKey;var U=T.ctrlKey||T.metaKey;if(g(this).hasClass("sp-grid-ordered-col")){var S;
if(g(this).attr("order_type")=="asc"){S="desc"}else{S="asc"}if(Q){for(var R=0,q=N.order.length;
R<q;R++){if(N.order[R].field===V){break}}N.order[R].type=S}else{if(!U){if(N.order.length>1){S="asc"
}var W=new d({field:V,type:S});N.order=[W]}else{for(var R=0,q=N.order.length;R<q;
R++){if(N.order[R].field===V){break}}N.order.splice(R,1);g(this).removeClass("sp-grid-ordered-col")
}}}else{var W=new d({field:V,type:"asc"});if(Q){N.order.push(W)}else{N.order=[W]}}N.search(undefined,true)
});var u='<div class="sp-grid-button-actions" style="display:none"></div>';this.append(I+u+M+v+"</div>");
N.loadActions(function(){g(y+" .sp-search-txt").val(N.q);N.search(N.q)})}else{if(typeof(B)=="string"){var D=this.data("sapnsGrid");
var y="#"+D.name;if(B=="loadData"){D.loadData()}else{if(B=="search"){var C="";if(typeof(z)=="boolean"){C=D.q
}else{if(z){C=z}}if(D.with_search){g(y+" .sp-search-txt").val(C)}D.search(C,true,x)
}else{if(B=="getSelectedIds"){return D.getSelectedIds()}else{if(B=="setRp"){D.rp=z;
g(y+" .sp-grid-rp [value="+z+"]").prop("selected",true)}else{if(B=="selectAll"){D.selectAll()
}else{if(B==="getQuery"){return D.query_()}else{if(B==="setQuery"){D.setQuery(z)}}}}}}}}}return this
}})(jQuery);